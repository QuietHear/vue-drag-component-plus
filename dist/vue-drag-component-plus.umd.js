(function(t,L){typeof exports=="object"&&typeof module<"u"?module.exports=L(require("vue")):typeof define=="function"&&define.amd?define(["vue"],L):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=L(t.Vue))})(this,function(t){"use strict";const L={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(E){return(P,it)=>{const R=t.resolveComponent("el-icon");return E.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(E.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},E.iconObj.attrs)),null,16)):E.iconObj.type==="el"?(t.openBlock(),t.createBlock(R,t.normalizeProps(t.mergeProps({key:1},E.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(E.iconObj.icon)))]),_:1},16)):E.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+E.iconObj.icon]},E.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:E.iconObj.type},E.iconObj.attrs),t.toDisplayString(E.iconObj.icon),17))}}},Qt="",Et=["onMousedown"],mt={class:"com-item-content"},Bt=["title"],Dt=["onClick"],vt=["onClick"],Ct=["onClick"],Ot=["onClick"],Vt=["onClick"],St=["onClick"],Gt=["onClick"],zt=["onMousedown"],Nt=["onMousedown"],Pt=["onMousedown"],Ht=["onMousedown"],Wt=["onMousedown"],Tt=["onMousedown"],It=["onMousedown"],Yt=["onMousedown"],Xt={key:1,class:"com-empty"},bt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(E,P){return E>=0}},itemMinWidth:{type:Number,default:15,validator(E,P){return E>=15}},itemMinHeight:{type:Number,default:15,validator(E,P){return E>=15}},ySpace:{type:Number,default:7,validator(E,P){return E>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1}},emits:["showGroup","updateChecked","showTitPop"],setup(E,{expose:P,emit:it}){const R=it,k=E,v=l=>{let r=l instanceof Array?[]:{};for(let e in l)r[e]=typeof l[e]=="object"?v(l[e]):l[e];return r},nt=()=>{k.insertResizeKeys.forEach(l=>{k.excludeResizeKeys.indexOf(l)===-1&&N.value.push(l)})};t.watch(()=>[k.insertResizeKeys,k.excludeResizeKeys],()=>{nt()});const N=t.ref([]);nt();const G=t.ref(null);let H=null,st=null;const Lt=t.ref(null),K=t.ref(0),c=t.ref([]),Rt=(l,r)=>{let e=l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector;for(;l&&!e.call(l,r);)l=l.parentElement;return l};let B=null,at=null,ct=null;const C=t.ref({}),$t=(l,r)=>{F(),B=r,C.value=v(c.value[B]),c.value[B].move=!0;const e=Rt(l.target,".com-item");at=l.clientX-e.offsetLeft,ct=l.clientY-e.offsetTop,window.addEventListener("mousemove",ht),window.addEventListener("mouseup",dt)},ht=l=>{const r=l.clientX-at,e=l.clientY-ct,i=r<=W("left")?W("left"):r>=W("right")?W("right"):r,o=e<=W("top")?W("top"):e>=W("bottom")?W("bottom"):e,x=i-c.value[B].x,p=o-c.value[B].y,M=`${x>0?"right":x<0?"left":""}_${p>0?"bottom":p<0?"top":""}`;c.value[B].x=i,c.value[B].y=o;let y=v(c.value.filter(g=>g.move!==!0).filter(g=>g.x<i&&g.x+g.width>i||g.x===i||g.x>i&&g.x<i+c.value[B].width).filter(g=>g.y<o&&g.y+g.height>o||g.y===o||g.y>o&&g.y<o+c.value[B].height));if(y.length===0)C.value.x=i,C.value.y=o;else{if(M.indexOf("top")!==-1){y=y.filter(d=>d.y<C.value.y);const g=Math.min(...y.map(d=>d.y+d.height));y.forEach(d=>{Math.abs(d.y+d.height-g)<5&&(d.y=g-d.height)});let h=C.value.y-o,n=!0,a=[...y];const s=d=>{v(c.value.filter(u=>u.move!==!0&&u.y+u.height-d.y<=h+3&&u.y+u.height-d.y>=0).filter(u=>u.x<d.x&&u.x+u.width>d.x||u.x>=d.x&&u.x<d.x+d.width)).forEach(u=>{u.y+u.height!==d.y&&(u.y=d.y-u.height),a.findIndex(D=>D.id===u.id)===-1&&(a.push(u),s(u))})};if(y.forEach(d=>{s(d)}),a.sort((d,w)=>{const u=d.y,D=w.y;return u-D}),(a.length===0||a.filter(d=>d.y===0).length>0)&&(n=!1),n){let d=0;a.filter(u=>u.y===a[0].y).forEach(u=>{v(c.value.filter(V=>V.move!==!0&&V.y+V.height<u.y).filter(V=>V.x<u.x&&V.x+V.width>u.x||V.x>=u.x&&V.x<u.x+u.width)).forEach(V=>{V.y+V.height>d&&(d=V.y+V.height)})}),d=a[0].y-d,d<h&&(h=d),a.forEach(u=>{u.y-=h,c.value.filter(D=>D.id===u.id)[0].y=u.y}),C.value.x=i,C.value.y=c.value.filter(u=>u.id===a[a.length-1].id)[0].y+c.value.filter(u=>u.id===a[a.length-1].id)[0].height}else{const d=Math.min(...y.map(w=>w.y));d-o>=-7&&d-o<7&&(y.filter(w=>w.y<C.value.y).forEach(w=>{w.y+=c.value[B].height,c.value.filter(D=>D.id===w.id)[0].y=w.y;const u=D=>{c.value.filter(O=>O.move!==!0&&O.id!==D.id).filter(O=>O.x<D.x&&O.x+O.width>D.x||O.x===D.x||O.x>D.x&&O.x<D.x+D.width).filter(O=>O.y<D.y&&O.y+O.height>D.y||O.y===D.y||O.y>D.y&&O.y<D.y+D.height).forEach(O=>{O.y=D.y+D.height,u(O)})};u(w)}),C.value.x=i,C.value.y=d)}y=v(c.value.filter(d=>d.move!==!0).filter(d=>d.x<i&&d.x+d.width>i||d.x===i||d.x>i&&d.x<i+c.value[B].width).filter(d=>d.y<o&&d.y+d.height>o||d.y===o||d.y>o&&d.y<o+c.value[B].height))}if(M.indexOf("bottom")!==-1){const g=Math.max(...y.map(h=>h.y+h.height));if(g-(o+c.value[B].height)>=-7&&g-(o+c.value[B].height)<7){let h=!0;y.filter(n=>n.y>C.value.y).forEach(n=>{n.y-=c.value[B].height,c.value.filter(s=>s.id===n.id)[0].y=n.y;const a=c.value.filter(s=>s.move!==!0&&s.id!==n.id).filter(s=>s.x<n.x&&s.x+s.width>n.x||s.x===n.x||s.x>n.x&&s.x<n.x+n.width).filter(s=>s.y<n.y&&s.y+s.height>n.y||s.y===n.y||s.y>n.y&&s.y<n.y+n.height);if(a.length>0){n.y=Math.max(...a.map(d=>d.y+d.height)),c.value.filter(d=>d.id===n.id)[0].y=n.y;const s=d=>{c.value.filter(u=>u.id!==d.id).filter(u=>u.x<d.x&&u.x+u.width>d.x||u.x===d.x||u.x>d.x&&u.x<d.x+d.width).filter(u=>u.y<d.y&&u.y+u.height>d.y||u.y===d.y||u.y>d.y&&u.y<d.y+d.height).forEach(u=>{u.y=d.y+d.height,u.move===!0&&(C.value.y=u.y,h=!1),s(u)})};s(n)}}),C.value.x=i,h&&(C.value.y=g-c.value[B].height),y=v(c.value.filter(n=>n.move!==!0).filter(n=>n.x<i&&n.x+n.width>i||n.x===i||n.x>i&&n.x<i+c.value[B].width).filter(n=>n.y<o&&n.y+n.height>o||n.y===o||n.y>o&&n.y<o+c.value[B].height))}}if(((M.indexOf("top")!==-1||M.indexOf("bottom")!==-1)&&(M.indexOf("right")!==-1||M.indexOf("left")!==-1)&&Math.abs(x)>8||M.indexOf("top")===-1&&M.indexOf("bottom")===-1&&(M.indexOf("right")!==-1||M.indexOf("left")!==-1))&&y.length>0){y.sort((h,n)=>{const a=h.y,s=n.y;return a-s});let g=!0;for(let h=0;h<y.length;h++){if(g){const n=v(c.value);for(let a=0;a<=h;a++){let s=null;const d=n.filter(w=>w.move!==!0&&w.y<y[a].y).filter(w=>w.x<y[a].x&&w.x+w.width>y[a].x||w.x===y[a].x||w.x>y[a].x&&w.x<y[a].x+y[a].width);if(d.length===0?s=0:s=Math.max(...d.map(w=>w.y+w.height)),a===h){if(y[a].y-(y[a].y+y[a].height-o)<s){g=!1;break}}else if(y[a].y-y[h].height<s){g=!1;break}else n.filter(w=>w.id===y[a].id)[0].y-=y[h].height}}if(g){y[h].y-=y[h].y+y[h].height-o,c.value.filter(n=>n.id===y[h].id)[0].y=y[h].y;for(let n=h;n>0;n--)y[h-1].y-=y[h].height,c.value.filter(a=>a.id===y[h-1].id)[0].y=y[h-1].y}else y.filter(n=>n.id===y[h].id).forEach(n=>{n.y+=c.value[B].y+c.value[B].height-n.y,c.value.filter(s=>s.id===n.id)[0].y=n.y;const a=s=>{c.value.filter(w=>w.move!==!0&&w.id!==s.id).filter(w=>w.x<s.x&&w.x+w.width>s.x||w.x===s.x||w.x>s.x&&w.x<s.x+s.width).filter(w=>w.y<s.y&&w.y+w.height>s.y||w.y===s.y||w.y>s.y&&w.y<s.y+s.height).forEach(w=>{w.y=s.y+s.height,a(w)})};a(n)})}C.value.x=i}}S(!1)},dt=()=>{window.removeEventListener("mousemove",ht),window.removeEventListener("mouseup",dt),delete c.value[B].move,c.value[B].x=C.value.x,c.value[B].y=C.value.y,B=null,S()},W=l=>{switch(l){case"top":return 0;case"right":return H-c.value[B].width;case"bottom":return 999999999;case"left":return 0}};let f=null,ot="",U=0,J=0,I=0,Y=0,X=0,b=0,$=0,Q=0,_=0,Z=0;const T=(l,r,e)=>{F(),f=r,ot=e,U=l.clientX,J=l.clientY,I=r.width,Y=r.height,X=r.y,b=r.x,f.drag=!0;const i=c.value.filter(g=>g.static===!0&&(g.x<r.x?g.x+g.width>=r.x:g.x<=r.x+r.width)),o=c.value.filter(g=>g.static===!0&&(g.y<r.y?g.y+g.height>=r.y:g.y<=r.y+r.height)),x=i.filter(g=>g.y+g.height<=r.y).map(g=>g.y+g.height);x.length>0?$=Math.max(...x):$=0;const p=i.filter(g=>g.y>=r.y+r.height).map(g=>g.y);p.length>0?Q=Math.min(...p):Q=0;const M=o.filter(g=>g.x+g.width<=r.x).map(g=>g.x+g.width);M.length>0?_=Math.max(...M):_=0;const y=o.filter(g=>g.x>=r.x+r.width).map(g=>g.x);y.length>0?Z=Math.min(...y):Z=0,window.addEventListener("mousemove",pt),window.addEventListener("mouseup",gt)},pt=l=>{const r=I+(l.clientX-U),e=Y+(l.clientY-J),i=I-(l.clientX-U),o=Y-(l.clientY-J),x=X+(l.clientY-J),p=b+(l.clientX-U),M=getComputedStyle(G.value),y=parseInt(M.getPropertyValue("--com-item-border-width").trim()),g=parseInt(M.getPropertyValue("--group-tit-height").trim());switch(ot){case"top-left":if(f.height=o<k.itemMinHeight?k.itemMinHeight:o>m("top")?m("top"):o,f.y=o<k.itemMinHeight?X+Y-k.itemMinHeight:o>m("top")?$:x,f.width=i<k.itemMinWidth?k.itemMinWidth:i>m("left")?m("left"):i,f.x=i<k.itemMinWidth?b+I-k.itemMinWidth:i>m("left")?_:p,f.isGroup===!0){const n=f.width-2*y,a=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(s=>{s.width=n*s.groupW,s.x=n*s.groupX,s.height=a*s.groupH,s.y=a*s.groupY})}break;case"top":if(f.height=o<k.itemMinHeight?k.itemMinHeight:o>m("top")?m("top"):o,f.y=o<k.itemMinHeight?X+Y-k.itemMinHeight:o>m("top")?$:x,f.isGroup===!0){const n=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(a=>{a.height=n*a.groupH,a.y=n*a.groupY})}break;case"top-right":if(f.height=o<k.itemMinHeight?k.itemMinHeight:o>m("top")?m("top"):o,f.y=o<k.itemMinHeight?X+Y-k.itemMinHeight:o>m("top")?$:x,f.width=r<k.itemMinWidth?k.itemMinWidth:r>m("right")?m("right"):r,f.isGroup===!0){const n=f.width-2*y,a=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(s=>{s.width=n*s.groupW,s.x=n*s.groupX,s.height=a*s.groupH,s.y=a*s.groupY})}break;case"left":if(f.width=i<k.itemMinWidth?k.itemMinWidth:i>m("left")?m("left"):i,f.x=i<k.itemMinWidth?b+I-k.itemMinWidth:i>m("left")?_:p,f.isGroup===!0){const n=f.width-2*y;f.groupData.forEach(a=>{a.width=n*a.groupW,a.x=n*a.groupX})}break;case"right":if(f.width=r<k.itemMinWidth?k.itemMinWidth:r>m("right")?m("right"):r,f.isGroup===!0){const n=f.width-2*y;f.groupData.forEach(a=>{a.width=n*a.groupW,a.x=n*a.groupX})}break;case"bottom-left":if(f.height=e<k.itemMinHeight?k.itemMinHeight:e>m("bottom")?m("bottom"):e,f.width=i<k.itemMinWidth?k.itemMinWidth:i>m("left")?m("left"):i,f.x=i<k.itemMinWidth?b+I-k.itemMinWidth:i>m("left")?_:p,f.isGroup===!0){const n=f.width-2*y,a=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(s=>{s.width=n*s.groupW,s.x=n*s.groupX,s.height=a*s.groupH,s.y=a*s.groupY})}break;case"bottom":if(f.height=e<k.itemMinHeight?k.itemMinHeight:e>m("bottom")?m("bottom"):e,f.isGroup===!0){const n=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(a=>{a.height=n*a.groupH,a.y=n*a.groupY})}break;case"bottom-right":if(f.height=e<k.itemMinHeight?k.itemMinHeight:e>m("bottom")?m("bottom"):e,f.width=r<k.itemMinWidth?k.itemMinWidth:r>m("right")?m("right"):r,f.isGroup===!0){const n=f.width-2*y,a=f.height-2*y-(f.groupTit?g:0);f.groupData.forEach(s=>{s.width=n*s.groupW,s.x=n*s.groupX,s.height=a*s.groupH,s.y=a*s.groupY})}break}let h=v(c.value.filter(n=>n.drag!==!0).filter(n=>n.x<f.x&&n.x+n.width>f.x||n.x===f.x||n.x>f.x&&n.x<f.x+f.width).filter(n=>n.y<f.y&&n.y+n.height>f.y||n.y===f.y||n.y>f.y&&n.y<f.y+f.height));if(h.length>0){h.sort((n,a)=>{const s=n.y,d=a.y;return s-d});for(let n=0;n<h.length;n++)h.filter(a=>a.id===h[n].id).forEach(a=>{a.y+=f.y+f.height-a.y,c.value.filter(d=>d.id===a.id)[0].y=a.y;const s=d=>{c.value.filter(u=>u.drag!==!0&&u.id!==d.id).filter(u=>u.x<d.x&&u.x+u.width>d.x||u.x===d.x||u.x>d.x&&u.x<d.x+d.width).filter(u=>u.y<d.y&&u.y+u.height>d.y||u.y===d.y||u.y>d.y&&u.y<d.y+d.height).forEach(u=>{u.y=d.y+d.height,s(u)})};s(a)})}S(!1)},gt=l=>{delete f.drag,ot="",f=null,window.removeEventListener("mousemove",pt),window.removeEventListener("mouseup",gt),S()},m=l=>{switch(l){case"top":return X+Y-$;case"left":return b+I-_;case"right":return(Z>0?Z:H)-b;case"bottom":return Q>0?Q-X:999999999}},S=(l=!0)=>{l===!0&&ut();const r=c.value.map(e=>e.y+e.height);r.length>0?K.value=Math.max(...r):K.value=0};t.watch(()=>k.ySpace,()=>{k.ySpace>=0&&ut()});const ut=()=>{c.value.sort((l,r)=>{const e=l.y,i=r.y;return e-i});for(let l=0;l<c.value.length;l++){if(l===0&&c.value[l].y>0){const r=c.value[l].y;for(let e=l;e<c.value.length;e++)c.value[e].y-=r}if(l<c.value.length-1&&c.value[l+1].y>c.value[l].y+c.value[l].height){const r=v(c.value.slice(0,l+1));if(c.value[l+1].y>Math.max(...r.map(e=>e.y+e.height))){const e=c.value[l+1].y-Math.max(...r.map(i=>i.y+i.height));for(let i=l+1;i<c.value.length;i++)c.value[i].y-=e}}}for(let l=0;l<c.value.length-1;l++){let r=c.value.findIndex(e=>e.y===c.value[l].y+c.value[l].height);if(r!==-1)for(let e=r;e<c.value.length;e++)c.value[e].y+=k.ySpace}};t.onMounted(()=>{ft.observe(G.value)});const ft=new ResizeObserver(l=>{At(H===l[0].contentRect.width?null:l[0].contentRect.width,st===l[0].contentRect.height?null:l[0].contentRect.height)});let lt=!1;const _t=(l=[],r=null)=>{c.value=v(l),c.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.isGroup===!0)if(e.groupData.length<2)q(e.id);else{const i=et(e.groupData,e);tt(i)}}),r!==null?t.nextTick(()=>{const i=G.value.getBoundingClientRect().width/r,o=getComputedStyle(G.value),x=parseInt(o.getPropertyValue("--com-item-border-width").trim()),p=parseInt(o.getPropertyValue("--group-tit-height").trim());c.value.forEach(M=>{if(M.width*=i,M.height*=i,M.x*=i,M.y*=i,M.isGroup===!0){const y=M.width-2*x,g=M.height-2*x-(M.groupTit?p:0);M.groupData.forEach(h=>{h.width=y*h.groupW,h.x=y*h.groupX,h.height=g*h.groupH,h.y=g*h.groupY})}}),S()}):S(),lt=!0,setTimeout(()=>{lt=!1},500)},yt=(l,r,e)=>{const i=r.map(p=>p.y),o=Math.max(...i),x=r.filter(p=>p.y+p.height>o);x.sort((p,M)=>{const y=p.x,g=M.x;return y-g});for(let p=0;p<x.length;p++){if(p===0&&x[p].x>=l.width){l.y=o,l.x=0;break}if(x.length>1&&p!==x.length-1&&x[p].x+x[p].width+l.width<=x[p+1].x){l.y=o,l.x=x[p].x+x[p].width;break}if(p===x.length-1&&x[p].x+x[p].width+l.width<=e){l.y=o,l.x=x[p].x+x[p].width;break}}if(l.y==null){l.x=0;const p=r.map(M=>M.y+M.height);l.y=Math.max(...p)}},j=(l,r=null,e=!1)=>{const i=v(l),o=c.value.filter(x=>x.id===r);if(i.id||(i.id=new Date().getTime()+""),r&&o.length!==1){try{}catch{}return}if(e!==!0)if(delete i.x,delete i.y,r){const x=getComputedStyle(G.value),p=parseInt(x.getPropertyValue("--com-item-border-width").trim());yt(i,o[0].groupData,o[0].width-2*p)}else c.value.length===0?(i.x=0,i.y=0):yt(i,c.value,H);if(r){o[0].groupData.push(i);const x=et(o[0].groupData,o[0]);tt(x)}else c.value.push(i);S()},A=(l,r=null)=>{let e=-1;const i=c.value.filter(o=>o.id===r);if(r?i.length===1&&(e=i[0].groupData.findIndex(o=>o.id===l)):e=c.value.findIndex(o=>o.id===l),e!==-1){if(r)if(i[0].groupData.splice(e,1),i[0].groupData.length===1)q(r);else{const o=et(i[0].groupData,i[0]);tt(o)}else c.value.splice(e,1);S()}else try{}catch{}},tt=l=>{if(l.id){const r=v(l);let e=-1;const i=c.value.filter(o=>o.id===r.inGroupId);if(r.inGroupId?i.length===1&&(e=i[0].groupData.findIndex(o=>o.id===r.id)):e=c.value.findIndex(o=>o.id===r.id),e!==-1)r.inGroupId?i[0].groupData[e]=r:c.value[e]=r,S();else try{}catch{}}else try{}catch{}},At=(l,r)=>{if(l!==null){const e=H?l/H:1;H=l;const i=getComputedStyle(G.value),o=parseInt(i.getPropertyValue("--com-item-border-width").trim()),x=parseInt(i.getPropertyValue("--group-tit-height").trim());lt||(c.value.forEach(p=>{if(p.width*=e,p.height*=e,p.x*=e,p.y*=e,p.isGroup===!0){const M=p.width-2*o,y=p.height-2*o-(p.groupTit?x:0);p.groupData.forEach(g=>{g.width=M*g.groupW,g.x=M*g.groupX,g.height=y*g.groupH,g.y=y*g.groupY})}}),S())}r!==null&&(st=r)},xt=l=>{l.showPop||(c.value.forEach(r=>{delete r.showPop,r.groupData&&r.groupData.forEach(e=>{delete e.showPop})}),l.showPop=!0,window.addEventListener("click",F))},F=()=>{c.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(r=>{delete r.showPop})}),window.removeEventListener("click",F)},z=t.ref(!1),wt=l=>{const r=c.value.findIndex(e=>e.id===l);if(r!==-1)c.value[r].checked=!0,c.value[r].disabled=!0,z.value=!0,R("showGroup",z.value);else try{}catch{}},kt=()=>{z.value=!1,c.value.forEach(l=>{delete l.checked,delete l.disabled,l.groupData&&l.groupData.forEach(r=>{delete r.checked,delete r.disabled})}),R("showGroup",z.value)},Kt=l=>{l.checked=!l.checked,R("updateChecked",c.value.filter(r=>r.checked).length)},et=(l,r)=>{const e=v(l),i=v(r);e.sort((h,n)=>{const a=h.x,s=n.x;return a-s});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].x>0){const n=e[h].x;for(let a=h;a<e.length;a++)e[a].x-=n}if(e[h+1].x>e[h].x+e[h].width){const n=v(e.slice(0,h+1));if(e[h+1].x>Math.max(...n.map(a=>a.x+a.width))){const a=e[h+1].x-Math.max(...n.map(s=>s.x+s.width));for(let s=h+1;s<e.length;s++)e[s].x-=a}}}e.sort((h,n)=>{const a=h.y,s=n.y;return a-s});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].y>0){const n=e[h].y;for(let a=h;a<e.length;a++)e[a].y-=n}if(e[h+1].y>e[h].y+e[h].height){const n=v(e.slice(0,h+1));if(e[h+1].y>Math.max(...n.map(a=>a.y+a.height))){const a=e[h+1].y-Math.max(...n.map(s=>s.y+s.height));for(let s=h+1;s<e.length;s++)e[s].y-=a}}}const o=e.map(h=>h.x+h.width),x=Math.max(...o),p=e.map(h=>h.y+h.height),M=Math.max(...p);e.forEach(h=>{h.inGroupId||(h.inGroupId=i.id),h.groupW=h.width/x,h.groupH=h.height/M,h.groupX=h.x/x,h.groupY=h.y/M,h.isObstacle=h.x+h.width===x&&h.y===0});const y=getComputedStyle(G.value),g=parseInt(y.getPropertyValue("--com-item-border-width").trim());return i.width=x+2*g,i.height=M+2*g,i.groupData=[...e],i},Ft=()=>{t.nextTick(()=>{const l=getComputedStyle(G.value),r=parseInt(l.getPropertyValue("--com-item-border-width").trim()),e=parseInt(l.getPropertyValue("--group-tit-height").trim());c.value.filter(i=>i.isGroup===!0).forEach(i=>{const o=i.width-2*r,x=i.height-2*r-(i.groupTit?e:0);i.groupData.forEach(p=>{p.width=o*p.groupW,p.x=o*p.groupX,p.height=x*p.groupH,p.y=x*p.groupY})})})},qt=()=>{const l=c.value.filter(r=>r.checked);if(l.length>1){const r={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=et(l,r);e.groupData.forEach(i=>{A(i.id)}),j(e),S()}kt()},Mt=(l,r)=>{const e=c.value.filter(i=>i.id===r)[0];if(e){const i=e.groupData.filter(o=>o.id===l)[0];if(i)e.groupData.length===2?q(r):(delete i.inGroupId,delete i.groupW,delete i.groupH,delete i.groupX,delete i.groupY,delete i.isObstacle,A(i.id,e.id),j(i),S());else try{}catch{}}else try{}catch{}},q=l=>{const r=c.value.filter(e=>e.id===l)[0];if(r)A(r.id),r.groupData.forEach(e=>{delete e.inGroupId,delete e.groupW,delete e.groupH,delete r.groupX,delete r.groupY,delete r.isObstacle,e.x+=r.x,e.y+=r.y,j(e,null,!0)}),S();else try{}catch{}},Ut=(l="",r)=>{const e=c.value.filter(i=>i.id===r)[0];if(e){if(!e.groupTit||!l){const o=getComputedStyle(G.value),x=parseInt(o.getPropertyValue("--group-tit-height").trim());e.groupTit&&!l&&(e.height-=x),!e.groupTit&&l&&(e.height+=x)}e.groupTit=l;const i=o=>{c.value.filter(p=>p.id!==o.id).filter(p=>p.x<o.x&&p.x+p.width>o.x||p.x===o.x||p.x>o.x&&p.x<o.x+o.width).filter(p=>p.y<o.y&&p.y+p.height>o.y||p.y===o.y||p.y>o.y&&p.y<o.y+o.height).forEach(p=>{p.y=o.y+o.height,i(p)})};i(e),S()}else try{}catch{}},Jt=()=>{const l=v(c.value);return l.forEach(r=>{delete r.showPop,r.groupData&&r.groupData.forEach(e=>{delete e.showPop})}),{data:l,width:H}};return t.onBeforeUnmount(()=>{ft.unobserve(G.value),window.removeEventListener("click",F)}),P({init:_t,addItem:j,deleteItem:A,updateItem:tt,openGroup:wt,closeGroup:kt,changeGroupBorder:Ft,addGroup:qt,removeGroupItem:Mt,removeGroup:q,changeGroupTit:Ut,getData:Jt}),(l,r)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",ref_key:"pageRef",ref:G},[t.createElementVNode("div",{class:"content-box",ref_key:"boxRef",ref:Lt},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(c),(e,i)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",E.seeModel||t.unref(z)||e.static===!0||e.dragable===!1?"":"can-drag",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop?"on-top":"",E.seeModel?"no-hover":""]),style:t.normalizeStyle({width:e.width+"px",height:e.height+"px",top:e.y+"px",left:e.x+"px"}),key:i,onMousedown:t.withModifiers(o=>E.seeModel||t.unref(z)||e.static===!0||e.dragable===!1?null:$t(o,i),["prevent"])},[t.createElementVNode("div",mt,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,Bt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(o,x)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-content-child",o.isObstacle?"else":""]),style:t.normalizeStyle({width:o.width+"px",height:o.height+"px",top:o.y+"px",left:o.x+"px"}),key:x},[t.renderSlot(l.$slots,"item",{data:o},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(o.width*100)/100)+","+t.toDisplayString(Math.round(o.height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(o.x*100)/100)+","+t.toDisplayString(Math.round(o.y*100)/100),1)]),!E.seeModel&&!t.unref(z)&&t.unref(B)===null&&t.unref(f)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:o.showPop?"flex":"none"}),onMousedown:t.withModifiers(p=>null,["prevent","stop"])},[t.createVNode(L,{iconObj:E.settingIcon,onClick:t.withModifiers(p=>xt(o),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),o.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(p=>null,["prevent","stop"])},[t.renderSlot(l.$slots,"setPopNormal",{data:v(o)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:p=>Mt(o.id,o.inGroupId)},"移出组合",8,Dt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:p=>A(o.id,o.inGroupId)},"删除",8,vt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):t.renderSlot(l.$slots,"item",{key:1,data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.width*100)/100)+","+t.toDisplayString(Math.round(e.height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.x*100)/100)+","+t.toDisplayString(Math.round(e.y*100)/100),1)]),!e.isGroup&&e.notGroup!==!0&&t.unref(z)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.disabled?"disabled":""]),onClick:o=>e.disabled?null:Kt(e)},null,10,Ct)):t.createCommentVNode("",!0),!E.seeModel&&!t.unref(z)&&t.unref(B)===null&&t.unref(f)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"setting-box",style:t.normalizeStyle({display:e.showPop?"flex":"none"}),onMousedown:t.withModifiers(o=>null,["prevent","stop"])},[t.createVNode(L,{iconObj:E.settingIcon,onClick:t.withModifiers(o=>xt(e),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?"special":""]),onMousedown:t.withModifiers(o=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(l.$slots,"setPopSpecial",{key:0,data:v(e)},()=>[E.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:o=>R("showTitPop",e.groupTit,e.id)}," 设置组合标题",8,Ot)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>q(e.id)},"解除组合",8,Vt)]):t.renderSlot(l.$slots,"setPopNormal",{key:1,data:v(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:o=>wt(e.id)},"组合",8,St)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>A(e.id)},"删除",8,Gt)])],34)):t.createCommentVNode("",!0)]),!E.seeModel&&!t.unref(z)&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(N).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(o=>T(o,e,"top-left"),["prevent","stop"])},null,40,zt)):t.createCommentVNode("",!0),t.unref(N).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(o=>T(o,e,"top"),["prevent","stop"])},null,40,Nt)):t.createCommentVNode("",!0),t.unref(N).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(o=>T(o,e,"top-right"),["prevent","stop"])},null,40,Pt)):t.createCommentVNode("",!0),t.unref(N).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(o=>T(o,e,"left"),["prevent","stop"])},null,40,Ht)):t.createCommentVNode("",!0),t.unref(N).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(o=>T(o,e,"right"),["prevent","stop"])},null,40,Wt)):t.createCommentVNode("",!0),t.unref(N).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(o=>T(o,e,"bottom-left"),["prevent","stop"])},null,40,Tt)):t.createCommentVNode("",!0),t.unref(N).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(o=>T(o,e,"bottom"),["prevent","stop"])},null,40,It)):t.createCommentVNode("",!0),t.unref(N).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(o=>T(o,e,"bottom-right"),["prevent","stop"])},null,40,Yt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],46,Et))),128)),t.unref(B)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(C).width+"px",height:t.unref(C).height+"px",top:t.unref(C).y+"px",left:t.unref(C).x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(K)>0?+(t.unref(K)+(E.seeModel?E.seeModelMinBg:220)):t.unref(K))+"px"})},null,4),t.unref(c).length===0?(t.openBlock(),t.createElementBlock("div",Xt,[t.renderSlot(l.$slots,"empty",{},()=>[t.createTextVNode(" 暂无数据 ")])])):t.createCommentVNode("",!0)],512)],512))}}],rt={install(E){bt.forEach(P=>{E.component("vueDragComponentPlus",P)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(rt),rt});
