(function(t,q){typeof exports=="object"&&typeof module<"u"?module.exports=q(require("vue")):typeof define=="function"&&define.amd?define(["vue"],q):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=q(t.Vue))})(this,function(t){"use strict";const q={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(_){return(W,Ce)=>{const V=t.resolveComponent("el-icon");return _.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(_.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},_.iconObj.attrs)),null,16)):_.iconObj.type==="el"?(t.openBlock(),t.createBlock(V,t.normalizeProps(t.mergeProps({key:1},_.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(_.iconObj.icon)))]),_:1},16)):_.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+_.iconObj.icon]},_.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:_.iconObj.type},_.iconObj.attrs),t.toDisplayString(_.iconObj.icon),17))}}},Dt="",Ae=["onMousedown","onMouseenter","onMouseleave"],Le={class:"com-item-box"},Xe=["title"],$e={class:"com-item-box-content"},Fe=["onClick"],Ke=["onClick"],qe=["onClick"],Ue={key:1,class:"com-item-box-content"},Je=["onClick"],Qe=["onClick"],Ze=["onClick"],je=["onClick"],et=["onClick"],tt=["onClick"],ot=["onMousedown"],lt=["onMousedown"],st=["onMousedown"],rt=["onMousedown"],nt=["onMousedown"],it=["onMousedown"],at=["onMousedown"],ct=["onMousedown"],dt={key:2,class:"com-empty"},ht=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},addFirstSpace:{type:Boolean,default:!1},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(_,W){return _>=0}},itemMinWidth:{type:Number,default:15,validator(_,W){return _>=15}},itemMinHeight:{type:Number,default:15,validator(_,W){return _>=15}},ySpace:{type:Number,default:7,validator(_,W){return _>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},hideAuxiliary:{type:Boolean,default:!1},auxiliarySpace:{type:Number,default:15,validator(_,W){return _>=1}}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop"],setup(_,{expose:W,emit:Ce}){const V=Ce,p=_,B=l=>{if(typeof l=="object"&&!t.isVNode(l)&&l!==null&&!(l instanceof Date)){let o=l instanceof Array?[]:{};for(let e in l)o[e]=typeof l[e]=="object"&&!t.isVNode(l[e])&&l[e]!==null&&!(l[e]instanceof Date)?B(l[e]):l[e];return o}else return l},ce=(l,o,e=!1)=>ut(O(l,o,e),o,e),O=(l,o,e=!1)=>l.filter(r=>r[e?"s_x":"x"]<=o[e?"s_x":"x"]&&r[e?"s_x":"x"]+r[e?"s_width":"width"]>o[e?"s_x":"x"]||r[e?"s_x":"x"]>o[e?"s_x":"x"]&&r[e?"s_x":"x"]<o[e?"s_x":"x"]+o[e?"s_width":"width"]),ut=(l,o,e=!1)=>l.filter(r=>r[e?"s_y":"y"]<=o[e?"s_y":"y"]&&r[e?"s_y":"y"]+r[e?"s_height":"height"]>o[e?"s_y":"y"]||r[e?"s_y":"y"]>o[e?"s_y":"y"]&&r[e?"s_y":"y"]<o[e?"s_y":"y"]+o[e?"s_height":"height"]),L=(l,o=r=>r,e=!1)=>{const r=B(n.value),s=B(l);s.sort((i,M)=>{const u=i[e?"s_y":"y"],g=M[e?"s_y":"y"];return u-g});const c=i=>{ce(o(r,i),i,e).forEach(u=>{u[e?"s_y":"y"]=i[e?"s_y":"y"]+i[e?"s_height":"height"],c(u)})};s.forEach(i=>c(r.filter(M=>M.id===i.id)[0])),r.forEach(i=>{n.value.filter(M=>M.id===i.id)[0][e?"s_y":"y"]=i[e?"s_y":"y"]})},I=l=>{const o=B(l);return delete o.showPop,delete o.showSet,o.groupData?o.groupData.forEach(e=>{delete e.showPop,delete e.showSet,A(e,o),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):o.inGroupId&&(delete o.showPop,delete o.showSet,A(o,n.value.filter(e=>e.id===o.inGroupId)[0])),delete o.btnPosition,delete o.s_width,delete o.s_height,delete o.s_x,delete o.s_y,o},De=()=>{p.insertResizeKeys.forEach(l=>{p.excludeResizeKeys.indexOf(l)===-1&&H.value.push(l)})};t.watch(()=>[p.insertResizeKeys,p.excludeResizeKeys],()=>{De()});const H=t.ref([]);De();const z=t.ref(null);let U=null;const de=l=>{U=l,V("baseWidthInit",U)},N=t.ref(1),he=l=>{N.value=l,V("changeScle",N.value)},J=l=>{l.s_width=l.width*N.value,l.s_height=l.height*N.value;const o=getComputedStyle(z.value),e=parseInt(o.getPropertyValue("--com-item-border-width").trim()),r=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const s=l.s_width-2*e,c=l.s_height-2*e-(l.groupTit?r:0);l.groupData.forEach(i=>{i.s_width=s*i.groupW,i.s_height=c*i.groupH,i.s_x=s*i.groupX,i.s_y=c*i.groupY})}},pt=l=>{l.s_x=l.x*N.value,l.s_y=l.y*N.value},ft=l=>{l.width=l.s_width/N.value,l.height=l.s_height/N.value;const o=getComputedStyle(z.value),e=parseInt(o.getPropertyValue("--com-item-border-width").trim()),r=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const s=l.width-2*e,c=l.height-2*e-(l.groupTit?r:0);l.groupData.forEach(i=>{i.x=s*i.groupX,i.y=c*i.groupY})}},me=l=>{l.x=l.s_x/N.value,l.y=l.s_y/N.value};let T=null,Pe=null;const gt=t.ref(null),ue=t.ref(0),le=t.ref(null),se=t.ref(null),re=t.ref(null),ne=t.ref(null),Q=l=>{const o=B(l);if(l===null)le.value=null,se.value=null,re.value=null,ne.value=null;else{const e=getComputedStyle(z.value),r=parseInt(e.getPropertyValue("--auxiliary-width").trim()),s=n.value.filter(f=>f.id!==o.id).map(f=>f.s_y),c=n.value.filter(f=>f.id!==o.id).map(f=>f.s_y+f.s_height-1),i=[...s,...c];i.sort(),i.filter(f=>f<=o.s_y&&o.s_y-p.auxiliarySpace<f||f>=o.s_y&&o.s_y+p.auxiliarySpace>f).length>0?le.value=o.s_y:le.value=null,i.filter(f=>f<=o.s_y+o.s_height-1&&o.s_y+o.s_height-1-p.auxiliarySpace<f||f>=o.s_y+o.s_height-1&&o.s_y+o.s_height-1+p.auxiliarySpace>f).length>0?se.value=o.s_y+o.s_height-r:se.value=null;const M=n.value.filter(f=>f.id!==o.id).map(f=>f.s_x),u=n.value.filter(f=>f.id!==o.id).map(f=>f.s_x+f.s_width-1),g=[...M,...u];g.sort(),g.filter(f=>f<=o.s_x&&o.s_x-p.auxiliarySpace<f||f>=o.s_x&&o.s_x+p.auxiliarySpace>f).length>0?re.value=o.s_x:re.value=null,g.filter(f=>f<=o.s_x+o.s_width-1&&o.s_x+o.s_width-1-p.auxiliarySpace<f||f>=o.s_x+o.s_width-1&&o.s_x+o.s_width-1+p.auxiliarySpace>f).length>0?ne.value=o.s_x+o.s_width-r:ne.value=null}},n=t.ref([]),yt=(l,o)=>{let e=l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector;for(;l&&!e.call(l,o);)l=l.parentElement;return l};let S=null,Ve=null,Ie=null;const C=t.ref({}),_t=(l,o)=>{ie(),S=o,C.value=B(n.value[S]),V("dragStart",I(n.value[S])),n.value[S].move=!0,Q(n.value[S]);const e=yt(l.target,".com-item");Ve=l.clientX-e.offsetLeft,Ie=l.clientY-e.offsetTop,window.addEventListener("mousemove",ze),window.addEventListener("mouseup",Ne)},ze=l=>{const o=l.clientX-Ve,e=l.clientY-Ie,r=o<=Y("left")?Y("left"):o>=Y("right")?Y("right"):o,s=e<=Y("top")?Y("top"):e>=Y("bottom")?Y("bottom"):e,c=r-n.value[S].s_x,i=s-n.value[S].s_y;let M="";i>0?M="bottom":i<0?M="top":c>2?M="right":c<-2&&(M="left"),n.value[S].s_x=r,n.value[S].s_y=s,Q(n.value[S]);let u=ce(B(n.value.filter(g=>g.move!==!0)),n.value[S],!0);if(u.length===0)C.value.s_x=r,C.value.s_y=s;else switch(M){case"top":u=u.filter(a=>a.s_y<C.value.s_y);const g=Math.min(...u.map(a=>a.s_y+a.s_height));u.forEach(a=>{Math.abs(a.s_y+a.s_height-g)<5&&(a.s_y=g-a.s_height)});let f=C.value.s_y-s,h=!0,w=[...u];const k=a=>{O(B(n.value.filter(d=>d.move!==!0&&Math.abs(d.s_y+d.s_height-a.s_y)<=3)),a,!0).forEach(d=>{w.findIndex(y=>y.id===d.id)===-1&&(w.push(d),k(d))})};if(u.forEach(a=>{k(a)}),w.sort((a,E)=>{const d=a.s_y,y=E.s_y;return d-y}),(w.length===0||w.filter(a=>a.s_y===0).length>0)&&(h=!1),h){let a=0;w.filter(d=>d.s_y===w[0].s_y).forEach(d=>{O(B(n.value.filter(D=>D.move!==!0&&D.s_y+D.s_height<d.s_y)),d,!0).forEach(D=>{D.s_y+D.s_height>a&&(a=D.s_y+D.s_height)})}),a=w[0].s_y-a,a<f&&(f=a),w.forEach(d=>{d.s_y-=f,n.value.filter(y=>y.id===d.id)[0].s_y=d.s_y}),C.value.s_x=r,C.value.s_y=n.value.filter(d=>d.id===w[w.length-1].id)[0].s_y+n.value.filter(d=>d.id===w[w.length-1].id)[0].s_height}else{let a=0;u.forEach(y=>{const D=O(n.value.filter(P=>P.move!==!0),y,!0).filter(P=>P.s_y>y.s_y+y.s_height);D.length>0&&(a=Math.min(...D.map(P=>P.s_y)))});const E=a===0?0:a-C.value.s_height-(Math.max(...u.map(y=>y.s_y+y.s_height))-Math.min(...u.map(y=>y.s_y))),d=E===0?s+C.value.s_height-Math.min(...u.map(y=>y.s_y)):a-Math.min(...u.map(y=>y.s_y))-(Math.max(...u.map(y=>y.s_y+y.s_height))-Math.min(...u.map(y=>y.s_y)));(E===0||s<=E)&&(u.filter(y=>y.s_y<C.value.s_y).forEach(y=>{y.s_y+=d,n.value.filter(D=>D.id===y.id)[0].s_y=y.s_y}),C.value.s_x=r,C.value.s_y=s,L(n.value,(y,D)=>y.filter(P=>P.move!==!0&&P.id!==D.id),!0))}break;case"bottom":let m=0;u.forEach(a=>{const E=O(n.value.filter(d=>d.move!==!0),a,!0).filter(d=>d.s_y+d.s_height<a.s_y);E.length>0&&(m=Math.max(...E.map(d=>d.s_y+d.s_height)))});const oe=m+(Math.max(...u.map(a=>a.s_height+a.s_y))-Math.min(...u.map(a=>a.s_y))),we=Math.min(...u.map(a=>a.s_y))-m;s>=oe&&(u.filter(a=>a.s_y>C.value.s_y).forEach(a=>{a.s_y-=we,n.value.filter(d=>d.id===a.id)[0].s_y=a.s_y;const E=ce(n.value.filter(d=>d.move!==!0&&d.id!==a.id),a,!0);E.length>0&&(a.s_y=Math.max(...E.map(d=>d.s_y+d.s_height)),n.value.filter(d=>d.id===a.id)[0].s_y=a.s_y)}),C.value.s_x=r,C.value.s_y=oe,L(n.value,(a,E)=>a.filter(d=>d.move!==!0&&d.id!==E.id),!0));break;case"left":case"right":u.sort((a,E)=>{const d=a.s_y,y=E.s_y;return d-y});let ke=!0;for(let a=0;a<u.length;a++){if(ke){const E=B(n.value);for(let d=0;d<=a;d++){let y=null;const D=O(E.filter(P=>P.move!==!0&&P.s_y<u[d].s_y),u[d],!0);if(D.length===0?y=0:y=Math.max(...D.map(P=>P.s_y+P.s_height)),d===a){if(u[d].s_y-(u[d].s_y+u[d].s_height-s)<y){ke=!1;break}}else if(u[d].s_y-u[a].s_height<y){ke=!1;break}else E.filter(P=>P.id===u[d].id)[0].s_y-=u[a].s_height}}if(ke){u[a].s_y-=u[a].s_y+u[a].s_height-s,n.value.filter(E=>E.id===u[a].id)[0].s_y=u[a].s_y;for(let E=a;E>0;E--)u[a-1].s_y-=u[a].s_height,n.value.filter(d=>d.id===u[a-1].id)[0].s_y=u[a-1].s_y}else u.filter(E=>E.id===u[a].id).forEach(E=>{E.s_y+=n.value[S].s_y+n.value[S].s_height-E.s_y,n.value.filter(d=>d.id===E.id)[0].s_y=E.s_y,L([E],(d,y)=>d.filter(D=>D.move!==!0&&D.id!==y.id),!0)})}C.value.s_x=r;break}n.value.forEach(g=>{me(g)}),v(!1),V("dragIng",I(n.value[S]))},Ne=()=>{window.removeEventListener("mousemove",ze),window.removeEventListener("mouseup",Ne),delete n.value[S].move,n.value[S].s_x=C.value.s_x,n.value[S].s_y=C.value.s_y,Q(null),n.value.forEach(l=>{me(l)}),v(),V("dragEnd",I(n.value[S])),S=null},Y=l=>{switch(l){case"top":return 0;case"right":return T-n.value[S].s_width;case"bottom":return 999999999;case"left":return 0}};let x=null,Me="",pe=0,fe=0,X=0,$=0,F=0,K=0,Z=0,ge=0,j=0,ye=0;const R=(l,o,e)=>{ie(),x=o,V("resizeStart",I(x)),Me=e,pe=l.clientX,fe=l.clientY,X=o.s_width,$=o.s_height,F=o.s_y,K=o.s_x,x.drag=!0,Q(x);const r=n.value.filter(g=>g.static===!0&&(g.s_x<o.s_x?g.s_x+g.s_width>=o.s_x:g.s_x<=o.s_x+o.s_width)),s=n.value.filter(g=>g.static===!0&&(g.s_y<o.s_y?g.s_y+g.s_height>=o.s_y:g.s_y<=o.s_y+o.s_height)),c=r.filter(g=>g.s_y+g.s_height<=o.s_y).map(g=>g.s_y+g.s_height);c.length>0?Z=Math.max(...c):Z=0;const i=r.filter(g=>g.s_y>=o.s_y+o.s_height).map(g=>g.s_y);i.length>0?ge=Math.min(...i):ge=0;const M=s.filter(g=>g.s_x+g.s_width<=o.s_x).map(g=>g.s_x+g.s_width);M.length>0?j=Math.max(...M):j=0;const u=s.filter(g=>g.s_x>=o.s_x+o.s_width).map(g=>g.s_x);u.length>0?ye=Math.min(...u):ye=0,window.addEventListener("mousemove",Ge),window.addEventListener("mouseup",ve)},Ge=l=>{const o=X+(l.clientX-pe),e=$+(l.clientY-fe),r=X-(l.clientX-pe),s=$-(l.clientY-fe),c=F+(l.clientY-fe),i=K+(l.clientX-pe),M=getComputedStyle(z.value),u=parseInt(M.getPropertyValue("--com-item-border-width").trim()),g=parseInt(M.getPropertyValue("--group-tit-height").trim()),f=()=>{if(x.isGroup===!0){const w=x.s_width-2*u,k=x.s_height-2*u-(x.groupTit?g:0);x.groupData.forEach(m=>{m.s_width=w*m.groupW,m.s_x=w*m.groupX,m.s_height=k*m.groupH,m.s_y=k*m.groupY})}};switch(Me){case"top-left":x.s_height=s<p.itemMinHeight?p.itemMinHeight:s>b("top")?b("top"):s,x.s_y=s<p.itemMinHeight?F+$-p.itemMinHeight:s>b("top")?Z:c,x.s_width=r<p.itemMinWidth?p.itemMinWidth:r>b("left")?b("left"):r,x.s_x=r<p.itemMinWidth?K+X-p.itemMinWidth:r>b("left")?j:i,f();break;case"top":x.s_height=s<p.itemMinHeight?p.itemMinHeight:s>b("top")?b("top"):s,x.s_y=s<p.itemMinHeight?F+$-p.itemMinHeight:s>b("top")?Z:c,f();break;case"top-right":x.s_height=s<p.itemMinHeight?p.itemMinHeight:s>b("top")?b("top"):s,x.s_y=s<p.itemMinHeight?F+$-p.itemMinHeight:s>b("top")?Z:c,x.s_width=o<p.itemMinWidth?p.itemMinWidth:o>b("right")?b("right"):o,f();break;case"left":x.s_width=r<p.itemMinWidth?p.itemMinWidth:r>b("left")?b("left"):r,x.s_x=r<p.itemMinWidth?K+X-p.itemMinWidth:r>b("left")?j:i,f();break;case"right":x.s_width=o<p.itemMinWidth?p.itemMinWidth:o>b("right")?b("right"):o,f();break;case"bottom-left":x.s_height=e<p.itemMinHeight?p.itemMinHeight:e>b("bottom")?b("bottom"):e,x.s_width=r<p.itemMinWidth?p.itemMinWidth:r>b("left")?b("left"):r,x.s_x=r<p.itemMinWidth?K+X-p.itemMinWidth:r>b("left")?j:i,f();break;case"bottom":x.s_height=e<p.itemMinHeight?p.itemMinHeight:e>b("bottom")?b("bottom"):e,f();break;case"bottom-right":x.s_height=e<p.itemMinHeight?p.itemMinHeight:e>b("bottom")?b("bottom"):e,x.s_width=o<p.itemMinWidth?p.itemMinWidth:o>b("right")?b("right"):o,f();break}ft(x),Q(x);let h=ce(B(n.value.filter(w=>w.drag!==!0)),x,!0);if(h.length>0){h.sort((w,k)=>{const m=w.s_y,oe=k.s_y;return m-oe});for(let w=0;w<h.length;w++)h.filter(k=>k.id===h[w].id).forEach(k=>{k.s_y+=x.s_y+x.s_height-k.s_y,n.value.filter(m=>m.id===k.id)[0].s_y=k.s_y,L([k],(m,oe)=>m.filter(we=>we.drag!==!0&&we.id!==oe.id),!0)})}n.value.forEach(w=>{me(w)}),v(!1),V("resizeIng",I(x))},ve=l=>{delete x.drag,Me="",Q(null),window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",ve),v(),V("resizeEnd",I(x)),x=null},b=l=>{switch(l){case"top":return F+$-Z;case"left":return K+X-j;case"right":return(ye>0?ye:T)-K;case"bottom":return ge>0?ge-F:999999999}},v=(l=!0)=>{l===!0&&(L(n.value,(e,r)=>e.filter(s=>s.id!==r.id)),We(),n.value.forEach(e=>{pt(e)}),xt());const o=n.value.map(e=>e.y+e.height);o.length>0?ue.value=Math.max(...o):ue.value=0};t.watch(()=>p.ySpace,()=>{p.ySpace>=0&&We()});const We=()=>{const l=B(n.value).sort((o,e)=>{const r=o.y,s=e.y;return r-s});for(let o=0;o<l.length;o++){const e=O(l,l[o]).filter(r=>r.y+r.height<=l[o].y);e.length>0?l[o].y=Math.max(...e.map(r=>r.y+r.height)):l[o].y=0}l.sort((o,e)=>{const r=o.y,s=e.y;return r-s});for(let o=0;o<l.length-1;o++){const e=[],r=s=>{O(l,s).filter(i=>i.y===s.y+s.height).forEach(i=>{e.push(i.id),r(i)})};r(l[o]),e.forEach(s=>{l.filter(c=>c.id===s)[0].y+=p.ySpace})}l.forEach(o=>{n.value.filter(e=>e.id===o.id)[0].y=o.y}),p.addFirstSpace&&n.value.forEach(o=>o.y+=p.ySpace)},xt=()=>{const l=n.value.filter(o=>o.isGroup===!0);if(l.length>0){const o=getComputedStyle(z.value),e=parseInt(o.getPropertyValue("--setting-icon-group-width").trim());l.forEach(r=>{r.s_x+r.s_width+e>T?r.s_x-e<0?r.btnPosition="center":r.btnPosition="left":r.btnPosition="right"})}};t.onMounted(()=>{He.observe(z.value)});const He=new ResizeObserver(l=>{Mt(T===l[0].contentRect.width?null:l[0].contentRect.width,Pe===l[0].contentRect.height?null:l[0].contentRect.height)});let Ee=!1;const wt=(l=[],o=null)=>{n.value=B(l),n.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)ae(e.id);else{const r=xe(e.groupData,e);_e(r)}}),Ee=!0,t.nextTick(()=>{const e=z.value.getBoundingClientRect();o!=null?(de(o),he(e.width/o)):(de(e.width),he(1)),n.value.forEach(r=>{J(r)}),v(),setTimeout(()=>{Ee=!1},500)})},kt=(l,o)=>{o.showSet=!0},mt=(l,o)=>{delete o.showSet},Oe=(l,o,e)=>{const r=o.map(i=>i.y),s=Math.max(...r),c=o.filter(i=>i.y+i.height>s);c.sort((i,M)=>{const u=i.x,g=M.x;return u-g});for(let i=0;i<c.length;i++){if(i===0&&c[i].x>=l.width){l.y=s,l.x=0;break}if(c.length>1&&i!==c.length-1&&c[i].x+c[i].width+l.width<=c[i+1].x){l.y=s,l.x=c[i].x+c[i].width;break}if(i===c.length-1&&c[i].x+c[i].width+l.width<=e){l.y=s,l.x=c[i].x+c[i].width;break}}if(l.y==null){l.x=0;const i=o.map(M=>M.y+M.height);l.y=Math.max(...i)}},ee=(l,o=null,e=!1)=>{const r=B(l),s=n.value.filter(c=>c.id===o);if(r.id||(r.id=new Date().getTime()+""),o&&s.length!==1)try{}catch{}finally{return}if(e!==!0)if(delete r.x,delete r.y,o){s[0].groupData.forEach(M=>{A(M,s[0])});const c=getComputedStyle(z.value),i=parseInt(c.getPropertyValue("--com-item-border-width").trim());Oe(r,s[0].groupData,s[0].width-2*i)}else n.value.length===0?(r.x=0,r.y=0):Oe(r,n.value,U||T);if(o){s[0].groupData.push(r);const c=xe(s[0].groupData,s[0]);_e(c),L([c],(i,M)=>i.filter(u=>u.id!==M.id))}else n.value.length===0&&de(T),J(r),n.value.push(r);v()},be=(l,o=null,e=null)=>{let r=null;const s=n.value.filter(c=>c.id===o);if(o?s.length===1&&(r=B(s[0].groupData.filter(c=>c.id===l)[0])):r=B(n.value.filter(c=>c.id===l)[0]),r)return r.id=e||new Date().getTime()+"",o?(A(r,s[0]),ee(r,o)):ee(r),I(o?n.value.filter(c=>c.id===o)[0].groupData.filter(c=>c.id===r.id)[0]:n.value.filter(c=>c.id===r.id)[0]);try{}catch{}finally{return null}},te=(l,o=null)=>{let e=-1;const r=n.value.filter(s=>s.id===o);if(o?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===l)):e=n.value.findIndex(s=>s.id===l),e!==-1){if(o)if(r[0].groupData.splice(e,1),r[0].groupData.length===1)ae(o);else{r[0].groupData.forEach(c=>{A(c,r[0])});const s=xe(r[0].groupData,r[0]);_e(s)}else n.value.splice(e,1),n.value.length===0&&(de(null),he(1));v()}else try{}catch{}},_e=l=>{if(l.id){const o=B(l);delete o.showPop,delete o.showSet,delete o.btnPosition,o.groupData&&o.groupData.forEach(s=>{delete s.showPop,delete s.showSet});let e=-1;const r=n.value.filter(s=>s.id===o.inGroupId);if(o.inGroupId?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===o.id)):e=n.value.findIndex(s=>s.id===o.id),e!==-1)o.inGroupId?(r[0].groupData[e]=o,J(r[0])):(n.value[e]=o,J(n.value[e])),v();else try{}catch{}}else try{}catch{}},Mt=(l,o)=>{l!==null&&(T=l,Ee||(he(U&&T?l/U:1),n.value.forEach(e=>{J(e)}),v())),o!==null&&(Pe=o)},Te=l=>{l.showPop||(n.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(e=>{delete e.showPop})}),V("openSetMenu",I(l)),l.showPop=!0,window.addEventListener("click",ie))},ie=()=>{n.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(o=>{delete o.showPop})}),window.removeEventListener("click",ie)},G=t.ref(!1),Ye=l=>{const o=n.value.findIndex(e=>e.id===l);if(o!==-1)n.value[o].checked=!0,n.value[o].checkDis=!0,G.value=!0,V("showGroup",G.value);else try{}catch{}},Se=()=>{G.value=!1,n.value.forEach(l=>{delete l.checked,delete l.checkDis,l.groupData&&l.groupData.forEach(o=>{delete o.checked,delete o.checkDis})}),V("showGroup",G.value)},Et=l=>{l.checked=!l.checked,V("updateChecked",n.value.filter(o=>o.checked).length)},xe=(l,o)=>{const e=B(l),r=B(o);e.sort((h,w)=>{const k=h.x,m=w.x;return k-m});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].x>0){const w=e[h].x;for(let k=h;k<e.length;k++)e[k].x-=w}if(e[h+1].x>e[h].x+e[h].width){const w=B(e.slice(0,h+1));if(e[h+1].x>Math.max(...w.map(k=>k.x+k.width))){const k=e[h+1].x-Math.max(...w.map(m=>m.x+m.width));for(let m=h+1;m<e.length;m++)e[m].x-=k}}}e.sort((h,w)=>{const k=h.y,m=w.y;return k-m});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].y>0){const w=e[h].y;for(let k=h;k<e.length;k++)e[k].y-=w}if(e[h+1].y>e[h].y+e[h].height){const w=B(e.slice(0,h+1));if(e[h+1].y>Math.max(...w.map(k=>k.y+k.height))){const k=e[h+1].y-Math.max(...w.map(m=>m.y+m.height));for(let m=h+1;m<e.length;m++)e[m].y-=k}}}const s=e.map(h=>h.x+h.width),c=Math.max(...s),i=e.map(h=>h.y+h.height),M=Math.max(...i);e.forEach(h=>{h.inGroupId||(h.inGroupId=r.id),h.groupW=h.width/c,h.groupH=h.height/M,h.groupX=h.x/c,h.groupY=h.y/M,delete h.width,delete h.height,h.isObstacle=h.x+h.width===c&&h.y===0});const u=getComputedStyle(z.value),g=parseInt(u.getPropertyValue("--com-item-border-width").trim()),f=parseInt(u.getPropertyValue("--group-tit-height").trim());return r.width=c+2*g,r.height=M+2*g+(r.groupTit?f:0),r.groupData=[...e],r},A=(l,o)=>{const e=getComputedStyle(z.value),r=parseInt(e.getPropertyValue("--com-item-border-width").trim()),s=parseInt(e.getPropertyValue("--group-tit-height").trim());l.width=(o.width-2*r)*l.groupW,l.height=(o.height-2*r-(o.groupTit?s:0))*l.groupH},bt=()=>{t.nextTick(()=>{n.value.filter(l=>l.isGroup===!0).forEach(l=>{J(l)})})},St=()=>{const l=n.value.filter(o=>o.checked);if(l.length>1){const o={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=xe(l,o);return e.groupData.forEach(r=>{te(r.id)}),ee(e),Se(),I(n.value.filter(r=>r.id===e.id)[0])}else return Se(),null},Re=(l,o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){const r=e.groupData.filter(s=>s.id===l)[0];if(r)return e.groupData.length===2?ae(o):(A(r,e),delete r.inGroupId,delete r.groupW,delete r.groupH,delete r.groupX,delete r.groupY,delete r.isObstacle,te(r.id,e.id),ee(r),[I(n.value.filter(s=>s.id===l)[0])]);try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ae=l=>{const o=n.value.filter(e=>e.id===l)[0];if(o){let e=[];o.groupData.forEach(s=>{A(s,o),s.x+=o.x,s.y+=o.y,delete s.inGroupId,delete s.groupW,delete s.groupH,delete o.groupX,delete o.groupY,delete o.isObstacle,e.push(s.id),ee(s,null,!0)}),te(o.id);let r=[];return e.forEach(s=>{r.push(B(n.value.filter(c=>c.id===s)[0]))}),r}else try{}catch{}finally{return[]}},Bt=(l="",o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){if(!e.groupTit||!l){const r=getComputedStyle(z.value),s=parseInt(r.getPropertyValue("--group-tit-height").trim());e.groupTit&&!l&&(e.height-=s,e.s_height-=s),!e.groupTit&&l&&(e.height+=s,e.s_height+=s)}e.groupTit=l,L([e],(r,s)=>r.filter(c=>c.id!==s.id)),v()}else try{}catch{}},Ct=()=>new Promise((l,o)=>{n.value.forEach(r=>{delete r.showPop,delete r.showSet,r.groupData&&r.groupData.forEach(s=>{delete s.showPop,delete s.showSet})});const e=B(n.value);e.forEach(r=>{r.isGroup===!0&&r.groupData.forEach(s=>{A(s,r),delete s.s_width,delete s.s_height,delete s.s_x,delete s.s_y}),delete r.btnPosition,delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y}),l({data:e,width:U})});return t.onBeforeUnmount(()=>{He.unobserve(z.value),window.removeEventListener("click",ie)}),W({init:wt,addItem:ee,copyItem:be,deleteItem:te,updateItem:_e,openGroup:Ye,closeGroup:Se,changeGroupBorder:bt,addGroup:St,removeGroupItem:Re,removeGroup:ae,changeGroupTit:Bt,getData:Ct}),(l,o)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(N)}),ref_key:"pageRef",ref:z},[t.createElementVNode("div",{class:"content-box",ref_key:"boxRef",ref:gt},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",_.seeModel||t.unref(G)||e.static===!0||e.dragable===!1?"":"can-drag",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop?"on-top":"",_.seeModel?"no-hover":""]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:r,onMousedown:t.withModifiers(s=>_.seeModel||t.unref(G)||e.static===!0||e.dragable===!1?null:_t(s,r),["prevent"]),onMouseenter:s=>_.seeModel||t.unref(G)||t.unref(S)||t.unref(x)||!e.isGroup?null:kt(s,e),onMouseleave:s=>_.seeModel||t.unref(G)||t.unref(S)||t.unref(x)||!e.isGroup?null:mt(s,e)},[t.createElementVNode("div",Le,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,Xe)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(s,c)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",s.isObstacle?"else":""]),style:t.normalizeStyle({width:s.s_width+"px",height:s.s_height+"px",top:s.s_y+"px",left:s.s_x+"px"}),key:c},[t.createElementVNode("div",$e,[t.renderSlot(l.$slots,"item",{data:s},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_width*100)/100)+","+t.toDisplayString(Math.round(s.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_x*100)/100)+","+t.toDisplayString(Math.round(s.s_y*100)/100),1)])]),!_.seeModel&&!t.unref(G)&&t.unref(S)===null&&t.unref(x)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:s.showPop?"flex":"none"}),onMousedown:t.withModifiers(i=>null,["prevent","stop"])},[t.createVNode(q,{iconObj:_.settingIcon,onClick:t.withModifiers(i=>Te(s),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),s.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(i=>null,["prevent","stop"])},[t.renderSlot(l.$slots,"setPopNormal",{data:I(s)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:i=>Re(s.id,s.inGroupId)},"移出组合",8,Fe),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:i=>be(s.id,s.inGroupId)},"复制",8,Ke),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:i=>te(s.id,s.inGroupId)},"删除",8,qe)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",Ue,[t.renderSlot(l.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_width*100)/100)+","+t.toDisplayString(Math.round(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_x*100)/100)+","+t.toDisplayString(Math.round(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(G)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:s=>e.checkDis?null:Et(e)},null,10,Je)):t.createCommentVNode("",!0),!_.seeModel&&!t.unref(G)&&t.unref(S)===null&&t.unref(x)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[t.createVNode(q,{iconObj:_.settingIcon,onClick:t.withModifiers(s=>Te(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(l.$slots,"setPopSpecial",{key:0,data:I(e)},()=>[_.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>V("showTitPop",e.groupTit,e.id)}," 设置组合标题",8,Qe)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>ae(e.id)},"解除组合",8,Ze)]):t.renderSlot(l.$slots,"setPopNormal",{key:1,data:I(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>Ye(e.id)},"组合",8,je)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>be(e.id)},"复制",8,et),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>te(e.id)},"删除",8,tt)])],34)):t.createCommentVNode("",!0)]),!_.seeModel&&!t.unref(G)&&!e.showPop&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(H).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(s=>R(s,e,"top-left"),["prevent","stop"])},null,40,ot)):t.createCommentVNode("",!0),t.unref(H).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(s=>R(s,e,"top"),["prevent","stop"])},null,40,lt)):t.createCommentVNode("",!0),t.unref(H).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(s=>R(s,e,"top-right"),["prevent","stop"])},null,40,st)):t.createCommentVNode("",!0),t.unref(H).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(s=>R(s,e,"left"),["prevent","stop"])},null,40,rt)):t.createCommentVNode("",!0),t.unref(H).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(s=>R(s,e,"right"),["prevent","stop"])},null,40,nt)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(s=>R(s,e,"bottom-left"),["prevent","stop"])},null,40,it)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(s=>R(s,e,"bottom"),["prevent","stop"])},null,40,at)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(s=>R(s,e,"bottom-right"),["prevent","stop"])},null,40,ct)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],46,Ae))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:r},null,6))),128)),t.unref(S)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(C).s_width+"px",height:t.unref(C).s_height+"px",top:t.unref(C).s_y+"px",left:t.unref(C).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ue)>0?+(t.unref(ue)*t.unref(N)+(_.seeModel?_.seeModelMinBg:220)):0)+"px"})},null,4),_.hideAuxiliary?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(le)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(le)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(se)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(se)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(re)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(re)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(ne)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(ne)+"px"})},null,4)):t.createCommentVNode("",!0)],64)),t.unref(n).length===0?(t.openBlock(),t.createElementBlock("div",dt,[t.renderSlot(l.$slots,"empty",{},()=>[o[0]||(o[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)],512)],4))}}],Be={install(_){ht.forEach(W=>{_.component("vueDragComponentPlus",W)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(Be),Be});
