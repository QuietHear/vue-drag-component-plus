(function(t,de){typeof exports=="object"&&typeof module<"u"?module.exports=de(require("vue")):typeof define=="function"&&define.amd?define(["vue"],de):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=de(t.Vue))})(this,function(t){"use strict";const de={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(f){return(E,V)=>{const _=t.resolveComponent("el-icon");return f.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(f.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},f.iconObj.attrs)),null,16)):f.iconObj.type==="el"?(t.openBlock(),t.createBlock(_,t.normalizeProps(t.mergeProps({key:1},f.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(f.iconObj.icon)))]),_:1},16)):f.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+f.iconObj.icon]},f.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:f.iconObj.type},f.iconObj.attrs),t.toDisplayString(f.iconObj.icon),17))}}},it=(f,E={x:"x",y:"y",width:"width",height:"height"})=>{let V=null;return f instanceof Array?(V=[],f.forEach(_=>{typeof _[E.x]=="number"&&typeof _[E.y]=="number"&&typeof _[E.width]=="number"&&typeof _[E.height]=="number"&&V.push({x:_[E.x],y:_[E.y],width:_[E.width],height:_[E.height]})})):typeof f[E.width]=="number"&&typeof f[E.height]=="number"&&(V={width:f[E.width],height:f[E.height]}),V},Et=f=>{const E=new Map;return f.forEach(V=>{E.has(V.x)||E.set(V.x,[]),E.get(V.x).push(V)}),E},Mt=(f,E)=>f.filter(V=>V.x<=E.x&&V.x+V.width>E.x||V.x>E.x&&V.x<E.x+E.width),It=(f,E,V,_=!1)=>{if(E.width>V)return null;let g=[];if(f.length===0){const T={x:0,y:0};return _?[T]:T}const z=Math.max(...f.map(T=>T.y+T.height)),B=new Set([0]);f.forEach(T=>{B.add(T.y),B.add(T.y+T.height)});const fe=Array.from(B).sort((T,L)=>T-L);for(const T of fe){const L=T+E.height;if(L>z)continue;const p=f.filter(S=>S.y<L&&S.y+S.height>T);if(p.length===0){const S={x:0,y:T};if(!_)return S;g.push(S);continue}const R=p.map(S=>[S.x,S.x+S.width]);R.sort((S,n)=>S[0]-n[0]);const G=[];let[P,$]=R[0];for(let S=1;S<R.length;S++){const[n,oe]=R[S];n<=$?$=Math.max($,oe):(G.push([P,$]),[P,$]=[n,oe])}if(G.push([P,$]),G[0][0]>=E.width){const S={x:0,y:T};if(!_)return S;g.push(S)}let q=G[0][1];for(let S=1;S<G.length;S++){if(G[S][0]-q>=E.width){const oe={x:q,y:T};if(!_)return oe;g.push(oe)}q=Math.max(q,G[S][1])}if(V-q>=E.width){const S={x:q,y:T};if(!_)return S;g.push(S)}}return _?(Et(g).forEach((L,p)=>{if(L.length>1)for(let R=0;R<L.length-1;R++){let G={...E,...L[R]};Mt(f.filter(P=>P.y>=G.y+G.height&&P.y<=L[R+1].y),G).length===0&&(g=g.filter(P=>!(P.x===L[R+1].x&&P.y===L[R+1].y)),L.splice(R,1),R--)}}),g.sort((L,p)=>L.y!==p.y?L.y-p.y:L.x-p.x),g.length===0?null:g):null},St={class:"content-box-bottom"},Bt=["onMousedown","onMouseenter","onMouseleave"],Ct={class:"com-item-box"},mt=["title"],Dt={class:"com-item-box-content"},Nt=["onClick"],Pt=["onClick"],zt=["onClick"],Vt={key:1,class:"com-item-box-content"},Tt=["onClick"],Gt=["onClick"],At=["onClick"],Ot=["onClick"],Lt=["onClick"],Rt=["onClick"],Ht=["onClick"],Yt=["onClick"],Xt=["onClick"],$t=["onClick"],Wt=["onMousedown"],Ft=["onMousedown"],Kt=["onMousedown"],qt=["onMousedown"],Ut=["onMousedown"],Jt=["onMousedown"],Qt=["onMousedown"],Zt=["onMousedown"],jt={key:0,class:"com-empty"},el=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},mobileDragModel:{type:Boolean,default:!1},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(f,E){return f>=0}},itemMinWidth:{type:Number,default:50,validator(f,E){return f>=20}},itemMinHeight:{type:Number,default:50,validator(f,E){return f>=20}},xSpace:{type:Number,default:10,validator(f,E){return f>=0}},ySpace:{type:Number,default:null,validator(f,E){return f>=0}},hScaleDiscount:{type:Number,default:.2,validator(f,E){return f>0}},cssScaleMin:{type:Number,default:.75,validator(f,E){return f>0}},cssScaleMax:{type:Number,default:1.2,validator(f,E){return f>0&&f>=(E?E.cssScaleMin:.1)}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},showAuxiliary:{type:Boolean,default:!1},groupBtnPosMore:{type:Boolean,default:!1},beforeAddGroup:{type:Function,default:f=>f},beforeRemoveGroup:{type:Function,default:f=>f},dragDelayTime:{type:Number,default:200,validator(f,E){return f>=0&&f<1e3}},moveDistance:{type:[Number,String],default:"50px"},scrollDistance:{type:[Number,String],default:"20px"},dragInBox:{type:Boolean,default:!1},adsorbSpace:{type:Number,default:10,validator(f,E){return f>=0}}},emits:["baseWidthInit","changeScale","changeCssScale","changeTrimModel","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop","domStart","domReady","hasError","dealError"],setup(f,{expose:E,emit:V}){const _=V,g=f,z=l=>{if(typeof l=="object"&&!t.isVNode(l)&&l!==null&&!(l instanceof Date)){let r=l instanceof Array?[]:{};for(let e in l)r[e]=typeof l[e]=="object"&&!t.isVNode(l[e])&&l[e]!==null&&!(l[e]instanceof Date)?z(l[e]):l[e];return r}else return l},B=l=>{let r={};if(l instanceof Array)r=[],l.forEach(e=>{r.push(B(e))});else for(let e in l)["id","move","drag","itemMinWidth","width","s_width","itemMinHeight","height","s_height","x","s_x","y","s_y","isGroup","groupTit","groupData","inGroupId","groupW","groupH","groupX","groupY"].indexOf(e)!==-1&&(e==="groupData"?r[e]=B(l[e]):r[e]=l[e]);return r},fe=(l,r,e=!0)=>{if(l.length===0)return null;let s=1/0,o=1/0,i=-1/0,x=!1;for(const d of l){const M=Math.abs(d-r);M<s?(s=M,o=d,i=d,x=M===0):M===s&&(d<o&&(o=d),d>i&&(i=d))}return x?r:e?o:i},T=(l,r)=>{let e=l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector;for(;l&&!e.call(l,r);)l=l.parentElement;return l},L=(l,r)=>l.classList?l.classList.contains(r):new RegExp("\\s"+r+"\\s").test(" "+l.className+" "),p=l=>{try{return parseFloat(l.toFixed(7))}catch{_("hasError","数值格式转换异常")}},R=(l,r)=>{let e=[],s=o=>{o.forEach(i=>{L(i,r)&&e.push(i),i.childNodes&&i.childNodes.length>0&&s(i.childNodes)})};return s(l.childNodes),e},G=(l,r,e=!1)=>$(P(l,r,e),r,e),P=(l,r,e=!1)=>l.filter(s=>p(s[e?"s_x":"x"])<=p(r[e?"s_x":"x"])&&p(s[e?"s_x":"x"]+s[e?"s_width":"width"])>p(r[e?"s_x":"x"])||p(s[e?"s_x":"x"])>p(r[e?"s_x":"x"])&&p(s[e?"s_x":"x"])<p(r[e?"s_x":"x"]+r[e?"s_width":"width"])),$=(l,r,e=!1)=>l.filter(s=>p(s[e?"s_y":"y"])<=p(r[e?"s_y":"y"])&&p(s[e?"s_y":"y"]+s[e?"s_height":"height"])>p(r[e?"s_y":"y"])||p(s[e?"s_y":"y"])>p(r[e?"s_y":"y"])&&p(s[e?"s_y":"y"])<p(r[e?"s_y":"y"]+r[e?"s_height":"height"])),q=(l,r=s=>s,e=!1)=>{const s=B(n.value),o=B(l);o.sort((x,d)=>{const M=p(x[e?"s_y":"y"]),m=p(d[e?"s_y":"y"]);if(M!==m)return M-m;{const h=p(x[e?"s_x":"x"]),D=p(d[e?"s_x":"x"]);return h-D}});const i=x=>{G(r(s,x),x,e).forEach(M=>{M[e?"s_y":"y"]=x[e?"s_y":"y"]+x[e?"s_height":"height"],i(M)})};o.forEach(x=>i(s.filter(d=>d.id===x.id)[0])),s.forEach(x=>{n.value.filter(d=>d.id===x.id)[0][e?"s_y":"y"]=x[e?"s_y":"y"]})},S=l=>{const r=z(l);return delete r.showPop,delete r.showSet,r.groupData?r.groupData.forEach(e=>{delete e.showPop,delete e.showSet,ie(e,r),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):r.inGroupId&&(delete r.showPop,delete r.showSet,ie(r,n.value.filter(e=>e.id===r.inGroupId)[0])),delete r.btnPosition,delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y,delete r.syCopy,r},n=t.ref([]),oe=()=>{g.insertResizeKeys.forEach(l=>{g.excludeResizeKeys.indexOf(l)===-1&&ee.value.push(l)})};t.watch(()=>[g.insertResizeKeys,g.excludeResizeKeys],()=>{oe()});const ee=t.ref([]);oe();const ut=()=>{n.value.length>0&&n.value.filter(l=>l.isGroup===!0).forEach(l=>{ce(l)})},ht=()=>{g.xSpace!==null&&g.xSpace!==void 0?A.value=g.xSpace/2:A.value=10/2,g.ySpace!==null&&g.ySpace!==void 0&&g.ySpace>=0?Y.value=g.ySpace/2:Y.value=A.value,ut()};t.watch(()=>[g.xSpace,g.ySpace],()=>{ht()});const A=t.ref(0),Y=t.ref(0);ht();const H=t.ref(null);let te=null;const be=l=>{te=l,_("baseWidthInit",te)},Q=t.ref(1),Ee=t.ref(1),pe=l=>{Q.value=l,l<g.cssScaleMin?Ee.value=g.cssScaleMin:l>g.cssScaleMax?Ee.value=g.cssScaleMax:Ee.value=l,_("changeScale",Q.value),_("changeCssScale",g.seeModel?Ee.value:1)},W=()=>1+(Q.value-1)*g.hScaleDiscount;t.watch(()=>g.seeModel,()=>{pe(Q.value)});const ce=(l,r=null)=>{r?(l.width=l.width*r,l.height=l.height*r):(l.s_width=l.width*Q.value,l.s_height=l.height*W());const e=getComputedStyle(H.value),s=parseInt(e.getPropertyValue("--com-item-border-width").trim()),o=parseInt(e.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0)if(r){const i=l.width,x=l.height-(l.groupTit?o:0);l.groupData.forEach(d=>{d.width=i*d.groupW,d.height=x*d.groupH,d.x=i*d.groupX,d.y=x*d.groupY})}else{const i=l.s_width-2*A.value-2*s,x=l.s_height-2*Y.value-2*s-(l.groupTit?o:0);l.groupData.forEach(d=>{d.s_width=i*d.groupW,d.s_height=x*d.groupH,d.s_x=i*d.groupX,d.s_y=x*d.groupY})}},dt=(l,r=null)=>{r?(l.s_x=l.x*r,l.s_y=l.y*r):(l.s_x=l.x*Q.value,l.s_y=l.y*W())},tl=l=>{l.width=l.s_width/Q.value,l.height=l.s_height/W();const r=getComputedStyle(H.value),e=parseInt(r.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const s=l.width,o=l.height-(l.groupTit?e:0);l.groupData.forEach(i=>{i.x=s*i.groupX,i.y=o*i.groupY})}},ge=l=>{l.x=l.s_x/Q.value,l.y=l.s_y/W()};let se=null,ft=null;const ne=t.ref(0),Me=t.ref(null),Ie=t.ref(null),Se=t.ref(null),Be=t.ref(null),Ce=t.ref(null),me=t.ref(null),ue=l=>{const r=B(l);if(!g.showAuxiliary||l===null)Me.value=null,Ie.value=null,Se.value=null,Be.value=null,Ce.value=null,me.value=null;else{const e=getComputedStyle(H.value),s=parseInt(e.getPropertyValue("--auxiliary-width").trim()),o=n.value.filter(y=>y.id!==r.id).filter(y=>parseInt(y.s_x)<parseInt(r.s_x)&&parseInt(y.s_x+y.s_width)<=parseInt(r.s_x)||parseInt(y.s_x)>=parseInt(r.s_x+r.s_width)),i=o.map(y=>parseInt(y.s_y)),x=o.map(y=>parseInt(y.s_y+y.s_height/2)),d=o.map(y=>parseInt(y.s_y+y.s_height)),M=[...i,...x,...d];M.sort(),M.filter(y=>y===parseInt(r.s_y)).length>0?Me.value=r.s_y+Y.value:Me.value=null,M.filter(y=>y===parseInt(r.s_y+r.s_height/2)).length>0?Ie.value=r.s_y+r.s_height/2:Ie.value=null,M.filter(y=>y===parseInt(r.s_y+r.s_height)).length>0?Se.value=r.s_y+r.s_height-s-Y.value:Se.value=null;const m=n.value.filter(y=>y.id!==r.id).map(y=>parseInt(y.s_x)),h=n.value.filter(y=>y.id!==r.id).map(y=>parseInt(y.s_x+y.s_width/2)),D=n.value.filter(y=>y.id!==r.id).map(y=>parseInt(y.s_x+y.s_width)),C=[...m,...h,...D];C.sort(),C.filter(y=>y===parseInt(r.s_x)).length>0?Be.value=r.s_x+A.value:Be.value=null,C.filter(y=>y===parseInt(r.s_x+r.s_width/2)).length>0?Ce.value=r.s_x+r.s_width/2:Ce.value=null,C.filter(y=>y===parseInt(r.s_x+r.s_width)).length>0?me.value=r.s_x+r.s_width-s-A.value:me.value=null}},ye=()=>{window.removeEventListener("keydown",ye),v!==null?Le():I!==null&&Ze()},X=t.ref(!1),We=l=>{let r=null;r=n.value.filter(e=>e.id===l)[0],r&&r.static!==!0&&r.dragable!==!1?(X.value=!0,gt(n.value.findIndex(e=>e.id===l)),setTimeout(()=>{window.addEventListener("click",De),window.addEventListener("keydown",Fe)},50),_("changeTrimModel",X.value,S(n.value.filter(e=>e.id===r.id)[0]))):_("hasError","未找到组件")},Fe=l=>{switch(l.keyCode){case 13:case 27:case 32:l.preventDefault(),De();break;case 37:l.preventDefault(),we("left");break;case 38:l.preventDefault(),we("top");break;case 39:l.preventDefault(),we("right");break;case 40:l.preventDefault(),we("bottom");break}},De=()=>{window.removeEventListener("click",De),window.removeEventListener("keydown",Fe),Le(),X.value=!1,_("changeTrimModel",X.value)},a=t.ref({});let v=null,Ke=null,qe=null,Ue=null,le=null;const F=t.ref(null);let pt=null,Oe=null,Je=null,Qe=null,_e=null,re=null,he=null,xe=null;const Ne=()=>{clearInterval(he),he=null,xe=null},gt=(l,r)=>{clearTimeout(Ue),clearTimeout(le),Ne(),Ge();const e=F.value.getBoundingClientRect();if(pt=e.left,Oe=e.top,Je=e.bottom,Qe=e.height,typeof g.moveDistance=="string"?_e=g.moveDistance.indexOf("px")!==-1?parseFloat(g.moveDistance):50:_e=g.moveDistance*Qe,typeof g.scrollDistance=="string"?re=g.scrollDistance.indexOf("px")!==-1?parseFloat(g.scrollDistance):20:re=g.scrollDistance*Qe,X.value)le=null,v=l,a.value=B(n.value[v]),_("dragStart",S(n.value[v])),n.value[v].move=!0,ue(n.value[v]),Ke=0,qe=0;else{const s=T(l.target,".com-item");s&&(le=setTimeout(()=>{le=null,v=r,a.value=B(n.value[v]),_("dragStart",S(n.value[v])),n.value[v].move=!0,ue(n.value[v]);const o=s.getBoundingClientRect();Ke=l.clientX-o.left,qe=l.clientY-o.top,window.addEventListener("mousemove",we),window.addEventListener("keydown",ye)},g.dragDelayTime),window.addEventListener("mouseup",Le))}},we=l=>{clearTimeout(Ue),clearTimeout(le),le=null;let r=null,e=null;if(X.value)switch(r=n.value[v].s_x,e=n.value[v].s_y,l){case"top":e-=1;break;case"bottom":e+=1;break;case"left":r-=1;break;case"right":r+=1;break}else r=l.clientX-pt-Ke,e=l.clientY-Oe+F.value.scrollTop-qe;const s=r<=Z("left")?Z("left"):r>=Z("right")?Z("right"):r;let o=e<=Z("top")?Z("top"):e>=Z("bottom")?Z("bottom"):e;const i=s-n.value[v].s_x,x=o-n.value[v].s_y;let d="";i>0?d="right":i<0?d="left":x>0?d="bottom":x<0&&(d="top"),g.dragInBox?(n.value[v].s_x=s,n.value[v].s_y=o):(n.value[v].s_x=r,n.value[v].s_y=e);const M=()=>{let m=G(B(n.value.filter(h=>h.move!==!0)),n.value[v],!0);if(m.length===0)a.value.s_x=s,a.value.s_y=o;else switch(d){case"top":const h=z(a.value);h.s_x=s,G(B(n.value.filter(u=>u.move!==!0)),h,!0).length===0&&(a.value.s_x=s);const D=m.filter(u=>g.mobileDragModel?p(u.s_height+u.s_y-o)>2*Y.value:n.value[v].s_height>=u.s_height&&o-u.s_y<=15||n.value[v].s_height<u.s_height&&o-u.s_y<=n.value[v].s_height/2);if(D.length>0){const u=P(B(n.value.filter(w=>w.move!==!0&&p(w.s_y+w.s_height)<=p(a.value.s_y)&&D.filter(c=>c.id===w.id).length===0)),a.value,!0);let k=n.value[v].s_height;if(u.length===0&&(k-=Math.min(...D.map(w=>w.s_y))),m.length===D.length?a.value.s_y=u.length===0?0:Math.max(...u.map(w=>w.s_y+w.s_height)):a.value.s_y=Math.max(...u.map(w=>w.s_y+w.s_height)),a.value.s_x=s,k>0){const w=z(D);D.forEach(c=>{P(n.value.filter(O=>O.move!==!0&&p(O.s_y)>=p(c.s_y+c.s_height)),c,!0).forEach(O=>{w.filter(at=>at.id===O.id).length===0&&w.push(B(O))})}),w.forEach(c=>{m.length!==D.length&&D.filter(b=>b.id===c.id).length===1&&(c.s_y=a.value.s_y),c.s_y+=k,n.value.filter(b=>b.id===c.id)[0].s_y=c.s_y})}}break;case"bottom":const C=z(a.value);C.s_x=s,G(B(n.value.filter(u=>u.move!==!0)),C,!0).length===0&&(a.value.s_x=s);const y=m.filter(u=>g.mobileDragModel?p(o+n.value[v].s_height-u.s_y)>2*Y.value:n.value[v].s_height>=u.s_height&&u.s_y+u.s_height-o-n.value[v].s_height<=15||n.value[v].s_height<u.s_height&&u.s_y+u.s_height-o-n.value[v].s_height<=u.s_height/2);if(y.length>0){y.forEach(w=>{const c=P(B(n.value.filter(b=>b.move!==!0&&p(b.s_y+b.s_height)<=p(w.s_y))),w,!0);w.s_y=c.length===0?0:Math.max(...c.map(b=>b.s_y+b.s_height)),n.value.filter(b=>b.id===w.id)[0].s_y=w.s_y});const u=[...G(y,n.value[v],!0),...P(B(n.value.filter(w=>w.move!==!0&&p(w.s_y+w.s_height)<=p(n.value[v].s_y+n.value[v].s_height))),n.value[v],!0)];let k=Math.max(...u.map(w=>w.s_y+w.s_height))-a.value.s_y;if(a.value.s_y=Math.max(...u.map(w=>w.s_y+w.s_height)),a.value.s_x=s,k>0){const w=P(n.value.filter(c=>c.move!==!0&&p(c.s_y)>=p(a.value.s_y)),a.value,!0);B(w).forEach(c=>{P(n.value.filter(O=>O.move!==!0&&p(O.s_y)>=p(c.s_y+c.s_height)),c,!0).forEach(O=>{w.filter(at=>at.id===O.id).length===0&&w.push(B(O))})}),w.forEach(c=>{c.s_y+=k,n.value.filter(b=>b.id===c.id)[0].s_y=c.s_y})}}break;case"left":case"right":const N=m.filter(u=>u.s_x+u.s_width-s>=A.value*3&&s+n.value[v].s_width-u.s_x>=A.value*3).filter(u=>o<u.s_y||o>=u.s_y&&o-u.s_y<=15).sort((u,k)=>{const w=p(u.s_y),c=p(k.s_y);return w-c});if(N.length>0)a.value.s_x=s,a.value.s_y=Math.min(...N.map(u=>u.s_y));else{let u=B(n.value[v]);if(u.s_y=Math.min(...m.map(k=>k.s_y))-u.s_height,a.value.s_y>=Math.min(...m.map(k=>k.s_y+k.s_height))||u.s_y>=0&&G(B(n.value.filter(k=>k.move!==!0)),u,!0).length===0){const k=z(a.value);k.s_x=s,G(B(n.value.filter(w=>w.move!==!0)),k,!0).length===0&&(a.value.s_x=s)}}N.forEach(u=>{const k=a.value.s_y+a.value.s_height-u.s_y>0?a.value.s_y+a.value.s_height-u.s_y:0,w=z([u]);P(n.value.filter(b=>b.move!==!0&&p(b.s_y)>=p(u.s_y+u.s_height)),u,!0).forEach(b=>{w.filter(O=>O.id===b.id).length===0&&w.push(B(b))}),w.forEach(b=>{b.s_y+=k,N.filter(O=>O.id===b.id).length===1&&(N.filter(O=>O.id===b.id)[0].s_y=b.s_y),n.value.filter(O=>O.id===b.id)[0].s_y=b.s_y})});break}n.value.forEach(h=>{ge(h)}),ge(a.value),J(!1),ue(n.value[v]),_("dragIng"),a.value.s_y=n.value[v].syCopy,delete n.value[v].syCopy};if(X.value){let m=null;m=R(H.value,"i"+n.value[v].id+"d")[0].getBoundingClientRect().top,m-Oe<=_e&&d==="top"&&(F.value.scrollTop=F.value.scrollTop-re),Je-m<=_e&&d==="bottom"&&(F.value.scrollTop=F.value.scrollTop+re),M()}else{const m=()=>{const h=F.value.scrollTop;xe==="top"?(F.value.scrollTop=F.value.scrollTop-re,h<=re?(Ne(),o=0):o-=re):(F.value.scrollTop=F.value.scrollTop+re,o+=re),n.value[v].s_y=o,M()};xe==="top"&&d==="bottom"&&Ne(),l.clientY-Oe<=_e&&d==="top"&&!he&&(M(),xe="top",he=setInterval(m,100)),xe==="bottom"&&d==="top"&&Ne(),Je-l.clientY<=_e&&d==="bottom"&&!he&&(M(),xe="bottom",he=setInterval(m,100)),he||M()}},Le=()=>{if(window.removeEventListener("mouseup",Le),clearTimeout(le),le)le=null;else{if(Ne(),window.removeEventListener("mousemove",we),g.adsorbSpace>0){let l=!1;if((a.value.s_x===0||a.value.s_x===Z("right"))&&(l=!0),!l){const r=$(B(n.value.filter(e=>e.move!==!0&&p(e.s_x+e.s_width)<=p(a.value.s_x))),a.value,!0).filter(e=>parseInt(a.value.s_x)-parseInt(e.s_x+e.s_width)<=g.adsorbSpace);r.length>0&&(a.value.s_x=Math.max(...r.map(e=>e.s_x+e.s_width)),l=!0)}if(!l){let r=[];P(B(n.value.filter(e=>e.move!==!0&&(p(e.s_y+e.s_height)===p(a.value.s_y)||p(e.s_y)===p(a.value.s_y+a.value.s_height)))),a.value,!0).forEach(e=>{Math.abs(parseInt(e.s_x)-parseInt(a.value.s_x))<=g.adsorbSpace&&r.push(e.s_x),Math.abs(parseInt(e.s_x+e.s_width/2)-parseInt(a.value.s_x))<=g.adsorbSpace&&r.push(e.s_x+e.s_width/2),Math.abs(parseInt(e.s_x+e.s_width)-parseInt(a.value.s_x))<=g.adsorbSpace&&r.push(e.s_x+e.s_width)}),r.length>0&&(a.value.s_x=Math.min(Z("right"),...r),l=!0)}if(!l){const r=$(B(n.value.filter(e=>e.move!==!0&&p(a.value.s_x+a.value.s_width)<=p(e.s_x))),a.value,!0).filter(e=>parseInt(e.s_x)-parseInt(a.value.s_x+a.value.s_width)<=g.adsorbSpace);r.length>0&&(a.value.s_x=Math.min(...r.map(e=>e.s_x))-a.value.s_width,l=!0)}if(!l){let r=[];P(B(n.value.filter(e=>e.move!==!0&&(p(e.s_y+e.s_height)===p(a.value.s_y)||p(e.s_y)===p(a.value.s_y+a.value.s_height)))),a.value,!0).forEach(e=>{Math.abs(parseInt(e.s_x)-parseInt(a.value.s_x+a.value.s_width))<=g.adsorbSpace&&r.push(e.s_x),Math.abs(parseInt(e.s_x+e.s_width/2)-parseInt(a.value.s_x+a.value.s_width))<=g.adsorbSpace&&r.push(e.s_x+e.s_width/2),Math.abs(parseInt(e.s_x+e.s_width)-parseInt(a.value.s_x+a.value.s_width))<=g.adsorbSpace&&r.push(e.s_x+e.s_width)}),r.length>0&&(a.value.s_x=Math.max(a.value.s_width,...r)-a.value.s_width,l=!0)}}delete n.value[v].move,n.value[v].s_x=a.value.s_x,n.value[v].s_y=a.value.s_y,ue(null),n.value.forEach(l=>{ge(l)}),J(),_("dragEnd",S(n.value[v])),v=null,ye(),Ue=setTimeout(()=>{J()},500)}},Z=l=>{switch(l){case"top":return 0;case"right":return se-A.value*2-n.value[v].s_width;case"bottom":return 999999999;case"left":return 0}};let I=null,j="",Re=0,He=0,Pe=0,ze=0,Ye=0,Ve=0;const ae=(l,r,e)=>{Ge(),a.value=B(r),I=r,_("resizeStart",S(I)),j=e,Re=l.clientX,He=l.clientY,Pe=r.s_width,ze=r.s_height,Ye=r.s_y,Ve=r.s_x,I.drag=!0,ue(I),window.addEventListener("mousemove",yt),window.addEventListener("mouseup",Ze),window.addEventListener("keydown",ye)},yt=l=>{const r=Pe+(l.clientX-Re),e=ze+(l.clientY-He),s=Pe-(l.clientX-Re),o=ze-(l.clientY-He),i=Ye+(l.clientY-He),x=Ve+(l.clientX-Re),d=(typeof a.value.itemMinWidth=="number"?a.value.itemMinWidth:g.itemMinWidth)*Q.value,M=(typeof a.value.itemMinHeight=="number"?a.value.itemMinHeight:g.itemMinHeight)*W();j.indexOf("top")!==-1?(a.value.s_height=o<M?M:o>U("top")?U("top"):o,a.value.s_y=o<M?Ye+ze-M:o>U("top")?0:i):j.indexOf("bottom")!==-1&&(a.value.s_height=e<M?M:e>U("bottom")?U("bottom"):e),j.indexOf("left")!==-1?(a.value.s_width=s<d?d:s>U("left")?U("left"):s,a.value.s_x=s<d?Ve+Pe-d:s>U("left")?0:x):j.indexOf("right")!==-1&&(a.value.s_width=r<d?d:r>U("right")?U("right"):r);let m=G(B(n.value.filter(N=>N.drag!==!0)),a.value,!0),h=[];if(j.indexOf("top")!==-1){const N=Math.abs(p(a.value.s_y-I.s_y))>Y.value*2,u=[];let k=null;const w=n.value.filter(c=>c.id!==I.id).filter(c=>parseInt(c.s_x)<parseInt(a.value.s_x)&&parseInt(c.s_x+c.s_width)<=parseInt(a.value.s_x)||parseInt(c.s_x)>=parseInt(a.value.s_x+a.value.s_width)).filter(c=>{let b=!1;return Math.abs(parseInt(a.value.s_y)-parseInt(c.s_y))<=g.adsorbSpace&&(u.push(c.s_y),b=!0),Math.abs(parseInt(a.value.s_y)-parseInt(c.s_y+c.s_height/2))<=g.adsorbSpace&&(u.push(c.s_y+c.s_height/2),b=!0),Math.abs(parseInt(a.value.s_y)-parseInt(c.s_y+c.s_height))<=g.adsorbSpace&&(u.push(c.s_y+c.s_height),b=!0),b});k=fe(u,a.value.s_y,!1),(w.length>0||N||a.value.s_y===0||a.value.s_height===M)&&(I.s_height=(k?a.value.s_y-k:0)+a.value.s_height,I.s_y=k||a.value.s_y,m.length>0&&(h=[...h,...P(m,I,!0)]))}else if(j.indexOf("bottom")!==-1){const N=Math.abs(p(a.value.s_height-I.s_height))>Y.value*2,u=[];let k=null;const w=n.value.filter(c=>c.id!==I.id).filter(c=>parseInt(c.s_x)<parseInt(a.value.s_x)&&parseInt(c.s_x+c.s_width)<=parseInt(a.value.s_x)||parseInt(c.s_x)>=parseInt(a.value.s_x+a.value.s_width)).filter(c=>{let b=!1;return Math.abs(parseInt(a.value.s_y+a.value.s_height)-parseInt(c.s_y))<=g.adsorbSpace&&(u.push(c.s_y-a.value.s_y),b=!0),Math.abs(parseInt(a.value.s_y+a.value.s_height)-parseInt(c.s_y+c.s_height/2))<=g.adsorbSpace&&(u.push(c.s_y+c.s_height/2-a.value.s_y),b=!0),Math.abs(parseInt(a.value.s_y+a.value.s_height)-parseInt(c.s_y+c.s_height))<=g.adsorbSpace&&(u.push(c.s_y+c.s_height-a.value.s_y),b=!0),b});k=fe(u,a.value.s_height),(w.length>0||N||a.value.s_height===M)&&(I.s_height=k||a.value.s_height,m.length>0&&(h=[...h,...P(m,I,!0)]))}if(j.indexOf("left")!==-1){const N=Math.abs(p(a.value.s_x-I.s_x))>A.value*2,u=[];let k=null;const w=n.value.filter(c=>c.id!==I.id).filter(c=>{let b=!1;return Math.abs(parseInt(a.value.s_x)-parseInt(c.s_x))<=g.adsorbSpace&&(u.push(c.s_x),b=!0),Math.abs(parseInt(a.value.s_x)-parseInt(c.s_x+c.s_width/2))<=g.adsorbSpace&&(u.push(c.s_x+c.s_width/2),b=!0),Math.abs(parseInt(a.value.s_x)-parseInt(c.s_x+c.s_width))<=g.adsorbSpace&&(u.push(c.s_x+c.s_width),b=!0),b});k=fe(u,a.value.s_x,!1),(w.length>0||N||a.value.s_x===0||a.value.s_width===d)&&(I.s_width=(k?a.value.s_x-k:0)+a.value.s_width,I.s_x=k||a.value.s_x,m.length>0&&(h=[...h,...$(m,I,!0)]))}else if(j.indexOf("right")!==-1){const N=Math.abs(p(a.value.s_width-I.s_width))>A.value*2,u=[];let k=null;const w=n.value.filter(c=>c.id!==I.id).filter(c=>{let b=!1;return Math.abs(parseInt(a.value.s_x+a.value.s_width)-parseInt(c.s_x))<=g.adsorbSpace&&(u.push(c.s_x-a.value.s_x),b=!0),Math.abs(parseInt(a.value.s_x+a.value.s_width)-parseInt(c.s_x+c.s_width/2))<=g.adsorbSpace&&(u.push(c.s_x+c.s_width/2-a.value.s_x),b=!0),Math.abs(parseInt(a.value.s_x+a.value.s_width)-parseInt(c.s_x+c.s_width))<=g.adsorbSpace&&(u.push(c.s_x+c.s_width-a.value.s_x),b=!0),b});k=fe(u,a.value.s_width),(w.length>0||N||a.value.s_width===U("right")||a.value.s_width===d)&&(I.s_width=k||a.value.s_width,m.length>0&&(h=[...h,...$(m,I,!0)]))}if(h.length>0){h.sort((N,u)=>{const k=p(N.s_y),w=p(u.s_y);return k-w});for(let N=0;N<h.length;N++)h.filter(u=>u.id===h[N].id).forEach(u=>{u.s_y+=I.s_y+I.s_height-u.s_y,n.value.filter(k=>k.id===u.id)[0].s_y=u.s_y,q([u],(k,w)=>k.filter(c=>c.drag!==!0&&c.id!==w.id),!0)})}const D=getComputedStyle(H.value),C=parseInt(D.getPropertyValue("--com-item-border-width").trim()),y=parseInt(D.getPropertyValue("--group-tit-height").trim());if(I.isGroup===!0){const N=I.s_width-2*A.value-2*C,u=I.s_height-2*Y.value-2*C-(I.groupTit?y:0);I.groupData.forEach(k=>{k.s_width=N*k.groupW,k.s_height=u*k.groupH,k.s_x=N*k.groupX,k.s_y=u*k.groupY})}tl(I),n.value.forEach(N=>{ge(N)}),J(!1),ue(I),_("resizeIng")},Ze=l=>{delete I.drag,j="",ue(null),window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",Ze),J(),_("resizeEnd",S(I)),I=null,ye()},U=l=>{switch(l){case"top":return Ye+ze;case"left":return Ve+Pe;case"right":return se-A.value*2-Ve;case"bottom":return 999999999}},J=(l=!0)=>{l===!0&&q(n.value,(e,s)=>e.filter(o=>o.id!==s.id)),ll(l),n.value.forEach(e=>{(l===!0||e.move!==!0&&e.drag!==!0)&&dt(e)}),l===!0&&rl();const r=n.value.map(e=>{if(e.move===!0){const s=B(e);return s.s_y=a.value.s_y,ge(s),s.y+e.height}else return e.y+e.height});r.length>0?ne.value=Math.max(...r):ne.value=0},ll=(l=!0)=>{const r=B(n.value).sort((e,s)=>{const o=p(e.y),i=p(s.y);return o-i});if(!l){if(I!==null){const e=P(z(r.filter(o=>o.drag!==!0&&p(o.s_y+o.s_height)<p(I.s_y))),I),s=r.filter(o=>o.drag===!0)[0];s&&(e.length>0?(s.height+=s.y-Math.max(...e.map(o=>o.y+o.height)),s.y=Math.max(...e.map(o=>o.y+o.height))):(s.height+=s.y,s.y=0))}else if(v!==null){const e=r.filter(s=>s.move===!0)[0];e&&(e.s_x=a.value.s_x,e.s_y=a.value.s_y,ge(e))}}for(let e=0;e<r.length;e++){const s=P(r,r[e]).filter(o=>p(o.y+o.height)<=p(r[e].y));s.length>0?r[e].y=Math.max(...s.map(o=>o.y+o.height)):r[e].y=0}r.forEach(e=>{l===!0||e.move!==!0&&e.drag!==!0?n.value.filter(s=>s.id===e.id)[0].y=e.y:e.move===!0&&(n.value.filter(s=>s.id===e.id)[0].syCopy=e.y*W())})},rl=()=>{const l=n.value.filter(r=>r.isGroup===!0);if(l.length>0){const r=getComputedStyle(H.value),e=parseInt(r.getPropertyValue("--setting-icon-group-width").trim()),s=parseInt(r.getPropertyValue("--setting-icon-group-height").trim());l.forEach(o=>{A.value+o.s_x+o.s_width+e>se?A.value+o.s_x-e<0?g.groupBtnPosMore?Y.value+o.s_y-s<0?o.btnPosition="bottom":o.btnPosition="top":o.btnPosition="center":o.btnPosition="left":o.btnPosition="right"})}},_t=new ResizeObserver(l=>{al(se===l[0].borderBoxSize[0].inlineSize?null:l[0].borderBoxSize[0].inlineSize,ft===l[0].borderBoxSize[0].blockSize?null:l[0].borderBoxSize[0].blockSize)});t.onMounted(()=>{_t.observe(H.value)});const Te=t.ref("");let je=0,et=0,tt=null,lt=!1;const ol=(l=[],r=null)=>{clearInterval(tt),Te.value=new Date().getTime()+"",je=0,et=0;let e=[];l.forEach(s=>{je+=1,s.isGroup===!0&&(et+=s.groupData.length),(s.y===void 0||s.y===null)&&(e.findIndex(o=>o.id===s.id)===-1&&e.push(z(s)),s.y=0),(s.x===void 0||s.x===null)&&(e.findIndex(o=>o.id===s.id)===-1&&e.push(z(s)),s.x=0)}),e.length>0&&_("dealError",e),bt(),_("domStart"),n.value=z(l),n.value.filter(s=>s.isGroup===!0).forEach(s=>{if(s.groupData.length<2)Ae(s.id);else{const o=$e(s.groupData,s);Xe(o)}}),lt=!0,t.nextTick(()=>{const s=H.value.getBoundingClientRect();r!=null&&n.value.length>0?(be(r),pe(s.width/r)):(be(n.value.length>0?s.width:null),pe(1)),n.value.forEach(o=>{ce(o)}),J(),tt=setInterval(()=>{R(H.value,Te.value+"p").length===je&&R(H.value,Te.value+"c").length===et&&(clearInterval(tt),_("domReady"))},10),setTimeout(()=>{lt=!1},500)})},sl=l=>{l.showSet=!0},rt=l=>{const r=n.value.filter(e=>e.id===l);r.length===1?delete r[0].showSet:_("hasError","未找到组件")},xt=(l,r,e)=>{const s=it(l),o=it(r),i=It(o,s,e);if(i)l.x=i.x,l.y=i.y;else{l.x=0;const x=o.map(d=>d.y+d.height);x.length>0?l.y=Math.max(...x):_("hasError","组件宽度太大")}},ve=(l,r=null,e=!1)=>{const s=z(l),o=n.value.filter(i=>i.id===r);if(s.id||(s.id=new Date().getTime()+""),r&&o.length!==1){_("hasError","未找到组件");return}if(e!==!0&&(delete s.x,delete s.y,r?(o[0].groupData.forEach(i=>{ie(i,o[0])}),xt(s,o[0].groupData,o[0].width)):xt(s,n.value,(te||se)-A.value*2)),r){o[0].groupData.push(s);const i=$e(o[0].groupData,o[0]);Xe(i),q([i],(x,d)=>x.filter(M=>M.id!==d.id))}else s.x!==void 0&&s.y!==void 0&&(n.value.length===0&&be(se),ce(s),n.value.push(s));J()},ot=(l,r=null,e=null)=>{let s=null;const o=n.value.filter(i=>i.id===r);return r?o.length===1&&(s=z(o[0].groupData.filter(i=>i.id===l)[0])):s=z(n.value.filter(i=>i.id===l)[0]),s?(s.id=e||new Date().getTime()+"",r?(ie(s,o[0]),ve(s,r)):ve(s),S(r?n.value.filter(i=>i.id===r)[0].groupData.filter(i=>i.id===s.id)[0]:n.value.filter(i=>i.id===s.id)[0])):(_("hasError","未找到组件"),null)},ke=(l,r=null,e=!0)=>{let s=-1;const o=n.value.filter(i=>i.id===r);if(r?o.length===1&&(s=o[0].groupData.findIndex(i=>i.id===l)):s=n.value.findIndex(i=>i.id===l),s!==-1){if(r)if(o[0].groupData.splice(s,1),o[0].groupData.length===1)Ae(r);else{o[0].groupData.forEach(x=>{ie(x,o[0])});const i=$e(o[0].groupData,o[0]);Xe(i)}else n.value.splice(s,1),n.value.length===0&&e&&(be(null),pe(1));e&&J()}else _("hasError","未找到组件")},nl=l=>{Xe(l,!1)},Xe=(l,r=!0)=>{if(l.id){const e=z(l);let s=-1;const o=n.value.filter(i=>i.id===e.inGroupId);if(e.inGroupId?o.length===1&&(s=o[0].groupData.findIndex(i=>i.id===e.id)):s=n.value.findIndex(i=>i.id===e.id),s!==-1){if(r&&(delete e.showPop,delete e.showSet,delete e.btnPosition,e.groupData&&e.groupData.forEach(i=>{delete i.showPop,delete i.showSet})),e.inGroupId){if(r)o[0].groupData[s]=e;else try{delete o[0].showPop,delete o[0].showSet,delete o[0].btnPosition,o[0].groupData&&o[0].groupData.forEach(i=>{delete i.showPop,delete i.showSet});for(let i in e){const x=i.split(".");let d=o[0].groupData[s];for(let M=0;M<x.length;M++)if(M===x.length-1)d[x[M]]=e[i];else if(d=d[x[M]],!d)throw new Error(i)}}catch(i){_("hasError","数据key: "+(i+"").replace("Error: ","")+" 不存在")}ce(o[0])}else{if(r)n.value[s]=e;else try{delete n.value[s].showPop,delete n.value[s].showSet,delete n.value[s].btnPosition,n.value[s].groupData&&n.value[s].groupData.forEach(i=>{delete i.showPop,delete i.showSet});for(let i in e){const x=i.split(".");let d=n.value[s];for(let M=0;M<x.length;M++)if(M===x.length-1)d[x[M]]=e[i];else if(d=d[x[M]],!d)throw new Error(i)}}catch(i){_("hasError","数据key: "+(i+"").replace("Error: ","")+" 不存在")}ce(n.value[s])}J()}else _("hasError","未找到组件")}else _("hasError","未找到组件")},st=(l,r=!1)=>{let e=null;return e=n.value.filter(s=>s.id===l)[0],e?(typeof r=="boolean"?e.static=r:r&&typeof r=="object"&&(typeof r.static=="boolean"&&(e.static=r.static),typeof r.dragable=="boolean"&&(e.dragable=r.dragable),typeof r.resizable=="boolean"&&(e.resizable=r.resizable)),S(n.value.filter(s=>s.id===e.id)[0])):(_("hasError","未找到组件"),null)},al=(l,r)=>{l!==null&&(se=l,lt||(pe(te&&se?l/te:1),n.value.forEach(e=>{ce(e)}),J())),r!==null&&(ft=r)},wt=l=>{l.showPop||(n.value.forEach(r=>{delete r.showPop,r.groupData&&r.groupData.forEach(e=>{delete e.showPop})}),_("openSetMenu",S(l)),l.showPop=!0,window.addEventListener("click",Ge))},Ge=()=>{n.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(r=>{delete r.showPop})}),window.removeEventListener("click",Ge)},K=t.ref(!1),vt=l=>{const r=n.value.findIndex(e=>e.id===l);r!==-1?(n.value[r].checked=!0,n.value[r].checkDis=!0,K.value=!0,_("showGroup",K.value)):_("hasError","未找到组件")},nt=()=>{K.value=!1,n.value.forEach(l=>{delete l.checked,delete l.checkDis,l.groupData&&l.groupData.forEach(r=>{delete r.checked,delete r.checkDis})}),_("showGroup",K.value)},il=l=>{l.checked=!l.checked,_("updateChecked",n.value.filter(r=>r.checked).length)},$e=(l,r)=>{const e=z(l),s=z(r);e.sort((h,D)=>{const C=p(h.x),y=p(D.x);return C-y});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].x>0){const D=e[h].x;for(let C=h;C<e.length;C++)e[C].x-=D}if(e[h+1].x>e[h].x+e[h].width){const D=B(e.slice(0,h+1));if(e[h+1].x>Math.max(...D.map(C=>C.x+C.width))){const C=e[h+1].x-Math.max(...D.map(y=>y.x+y.width));for(let y=h+1;y<e.length;y++)e[y].x-=C}}}e.sort((h,D)=>{const C=p(h.y),y=p(D.y);return C-y});for(let h=0;h<e.length-1;h++){if(h===0&&e[h].y>0){const D=e[h].y;for(let C=h;C<e.length;C++)e[C].y-=D}if(e[h+1].y>e[h].y+e[h].height){const D=B(e.slice(0,h+1));if(e[h+1].y>Math.max(...D.map(C=>C.y+C.height))){const C=e[h+1].y-Math.max(...D.map(y=>y.y+y.height));for(let y=h+1;y<e.length;y++)e[y].y-=C}}}const o=e.map(h=>h.x+h.width),i=Math.max(...o),x=e.map(h=>h.y+h.height),d=Math.max(...x);e.forEach(h=>{h.inGroupId||(h.inGroupId=s.id),h.groupW=h.width/i,h.groupH=h.height/d,h.groupX=h.x/i,h.groupY=h.y/d,h.isObstacle=h.x+h.width===i&&h.y===0,delete h.width,delete h.height});const M=getComputedStyle(H.value),m=parseInt(M.getPropertyValue("--group-tit-height").trim());return s.width=i,s.height=d+(s.groupTit?m:0),s.groupData=[...e],s},ie=(l,r)=>{const e=getComputedStyle(H.value),s=parseInt(e.getPropertyValue("--group-tit-height").trim());l.width=r.width*l.groupW,l.height=(r.height-(r.groupTit?s:0))*l.groupH},cl=()=>{t.nextTick(()=>{ut()})},ul=()=>{let l=n.value.filter(r=>r.checked);if(l.length>1)if(l=g.beforeAddGroup(z(l)),typeof l=="object"&&l instanceof Array&&l.length>0&&l.filter(r=>r.id).length===l.length){const r={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=$e(l,r);return e.groupData.forEach(s=>{ke(s.id,null,!1)}),ve(e),nt(),S(n.value.filter(s=>s.id===e.id)[0])}else return _("hasError","自定义方法抛出数据格式不正确"),null;else return nt(),null},kt=(l,r)=>{const e=n.value.filter(s=>s.id===r)[0];if(e){let s=e.groupData.filter(o=>o.id===l)[0];return s?e.groupData.length===2?Ae(r):(s=g.beforeRemoveGroup(z([s])),typeof s=="object"&&s instanceof Array&&s.length===1&&s.filter(o=>o.id).length===1?(s=s[0],ie(s,e),delete s.inGroupId,delete s.groupW,delete s.groupH,delete s.groupX,delete s.groupY,delete s.isObstacle,ke(s.id,e.id),ve(s),[S(n.value.filter(o=>o.id===l)[0])]):(_("hasError","自定义方法抛出数据格式不正确"),[])):(_("hasError","未找到组件"),[])}else return _("hasError","未找到组件"),[]},Ae=l=>{const r=n.value.filter(e=>e.id===l)[0];if(r){let e=[],s=!0;try{r.groupData.forEach(o=>{if(o=g.beforeRemoveGroup(z([r])),typeof o=="object"&&o instanceof Array&&o.length===1&&o.filter(i=>i.id).length===1)o=o[0];else throw s=!1,new Error})}catch{_("hasError","自定义方法抛出数据格式不正确")}if(s){ke(r.id,null,!1),r.groupData.forEach(i=>{ie(i,r),i.x+=r.x,i.y+=r.y,delete i.inGroupId,delete i.groupW,delete i.groupH,delete i.groupX,delete i.groupY,delete i.isObstacle,e.push(i.id),ve(i,null,!0)});let o=[];return e.forEach(i=>{o.push(S(n.value.filter(x=>x.id===i)[0]))}),o}else return[]}else return _("hasError","未找到组件"),[]},hl=(l="",r)=>{const e=n.value.filter(s=>s.id===r)[0];if(e){if(!e.groupTit||!l){const s=getComputedStyle(H.value),o=parseInt(s.getPropertyValue("--group-tit-height").trim());e.groupTit&&!l&&(e.height-=o,e.s_height-=o*W()),!e.groupTit&&l&&(e.height+=o,e.s_height+=o*W())}e.groupTit=l,q([e],(s,o)=>s.filter(i=>i.id!==o.id)),J()}else _("hasError","未找到组件")},bt=()=>{n.value=[],be(null),pe(1),ne.value=0},dl=(l=null)=>new Promise((r,e)=>{n.value.forEach(o=>{delete o.showPop,delete o.showSet,o.groupData&&o.groupData.forEach(i=>{delete i.showPop,delete i.showSet})});const s=z(n.value);s.forEach(o=>{o.isGroup===!0&&o.groupData.forEach(i=>{ie(i,o),delete i.s_width,delete i.s_height,delete i.s_x,delete i.s_y}),delete o.btnPosition,delete o.s_width,delete o.s_height,delete o.s_x,delete o.s_y}),l&&te&&s.forEach(o=>{ce(o,l/te),dt(o,l/te)}),r({data:s,width:l||te})});return t.onBeforeUnmount(()=>{_t.unobserve(H.value),window.removeEventListener("click",Ge),window.removeEventListener("click",De),window.removeEventListener("keydown",Fe),window.removeEventListener("keydown",ye)}),E({init:ol,addItem:ve,copyItem:ot,deleteItem:ke,updateItem:nl,toggleLockItem:st,hideGroupSet:rt,openGroup:vt,closeGroup:nt,changeGroupBorder:cl,addGroup:ul,removeGroupItem:kt,removeGroup:Ae,changeGroupTit:hl,openTrimModel:We,closeTrimModel:De,resetData:bt,getData:dl}),(l,r)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--item-scale":t.unref(Q),"--css-scale":f.seeModel?t.unref(Ee):1,"--com-x-space":t.unref(A)+"px","--com-y-space":t.unref(Y)+"px"}),ref_key:"pageRef",ref:H},[t.createElementVNode("div",{class:"content-box",ref_key:"contentBoxRef",ref:F},[r[1]||(r[1]=t.createElementVNode("div",{class:"content-box-top"},null,-1)),t.createElementVNode("div",St,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",t.unref(v)!==null||t.unref(I)?"":"not-move-animate",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop||e.isGroup&&e.groupData.filter(o=>o.showPop).length>0?"on-top":"",t.unref(Te)+"p","i"+e.id+"d"]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:s},[t.createElementVNode("div",{class:t.normalizeClass(["com-item-inner",f.seeModel||t.unref(X)||t.unref(K)||e.static===!0||e.dragable===!1?"":"can-drag",e.move||e.drag?"always-hover":"",f.seeModel?"no-hover":""]),onMousedown:t.withModifiers(o=>f.seeModel||t.unref(X)||t.unref(K)||e.static===!0||e.dragable===!1?null:gt(o,s),["prevent"]),onMouseenter:o=>f.seeModel||t.unref(X)||t.unref(K)||t.unref(v)!==null||t.unref(I)||!e.isGroup?null:sl(e),onMouseleave:o=>f.seeModel||t.unref(X)||t.unref(K)||t.unref(v)!==null||t.unref(I)||!e.isGroup?null:rt(e.id)},[t.createElementVNode("div",Ct,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,mt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(o,i)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",o.isObstacle?"is-obstacle":"",t.unref(Te)+"c"]),style:t.normalizeStyle({width:o.s_width+"px",height:o.s_height+"px",top:o.s_y+"px",left:o.s_x+"px"}),key:i},[t.createElementVNode("div",Dt,[t.renderSlot(l.$slots,"item",{data:o},()=>[t.createElementVNode("p",null,t.toDisplayString(parseInt(o.s_width*100)/100)+","+t.toDisplayString(parseInt(o.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(parseInt(o.s_x*100)/100)+","+t.toDisplayString(parseInt(o.s_y*100)/100),1)])]),!f.seeModel&&!t.unref(X)&&!t.unref(K)&&t.unref(v)===null&&t.unref(I)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:o.showPop?"flex":"none"}),onMousedown:t.withModifiers(x=>null,["prevent","stop"])},[t.createVNode(de,{iconObj:f.settingIcon,onClick:t.withModifiers(x=>wt(o),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),o.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(x=>null,["prevent","stop"])},[t.renderSlot(l.$slots,"setPopNormal",{data:S(o)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:x=>kt(o.id,o.inGroupId)},"移出组合",8,Nt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:x=>ot(o.id,o.inGroupId)},"复制",8,Pt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:x=>ke(o.id,o.inGroupId)},"删除",8,zt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",Vt,[t.renderSlot(l.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(parseInt(e.s_width*100)/100)+","+t.toDisplayString(parseInt(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(parseInt(e.s_x*100)/100)+","+t.toDisplayString(parseInt(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(K)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:o=>e.checkDis?null:il(e)},null,10,Tt)):t.createCommentVNode("",!0),!f.seeModel&&!t.unref(X)&&!t.unref(K)&&t.unref(v)===null&&t.unref(I)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="top"?"only-g t":e.btnPosition==="bottom"?"only-g b":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(o=>null,["prevent","stop"])},[t.createVNode(de,{iconObj:f.settingIcon,onClick:t.withModifiers(o=>wt(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="top"?"special t":e.btnPosition==="bottom"?"special b":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(o=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(l.$slots,"setPopSpecial",{key:0,data:S(e)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>st(e.id,e.static!==!0)},t.toDisplayString(e.static===!0?"解除":"")+"锁定 ",9,Gt),e.static!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:o=>We(e.id)}," 微调 ",8,At)):t.createCommentVNode("",!0),f.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop-item",onClick:o=>{rt(e.id),_("showTitPop",e.groupTit,e.id)}}," 设置组合标题 ",8,Ot)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>Ae(e.id)},"解除组合",8,Lt)]):t.renderSlot(l.$slots,"setPopNormal",{key:1,data:S(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:o=>vt(e.id)},"组合",8,Rt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>st(e.id,e.static!==!0)},t.toDisplayString(e.static===!0?"解除":"")+"锁定 ",9,Ht),e.static!==!0?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop-item",onClick:o=>We(e.id)}," 微调 ",8,Yt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>ot(e.id)},"复制",8,Xt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:o=>ke(e.id)},"删除",8,$t)])],34)):t.createCommentVNode("",!0)]),!f.seeModel&&!t.unref(X)&&!t.unref(K)&&!e.showPop&&!(e.isGroup&&e.groupData.filter(o=>o.showPop).length>0)&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(ee).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(o=>ae(o,e,"top-left"),["prevent","stop"])},null,40,Wt)):t.createCommentVNode("",!0),t.unref(ee).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(o=>ae(o,e,"top"),["prevent","stop"])},null,40,Ft)):t.createCommentVNode("",!0),t.unref(ee).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(o=>ae(o,e,"top-right"),["prevent","stop"])},null,40,Kt)):t.createCommentVNode("",!0),t.unref(ee).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(o=>ae(o,e,"left"),["prevent","stop"])},null,40,qt)):t.createCommentVNode("",!0),t.unref(ee).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(o=>ae(o,e,"right"),["prevent","stop"])},null,40,Ut)):t.createCommentVNode("",!0),t.unref(ee).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(o=>ae(o,e,"bottom-left"),["prevent","stop"])},null,40,Jt)):t.createCommentVNode("",!0),t.unref(ee).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(o=>ae(o,e,"bottom"),["prevent","stop"])},null,40,Qt)):t.createCommentVNode("",!0),t.unref(ee).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(o=>ae(o,e,"bottom-right"),["prevent","stop"])},null,40,Zt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],42,Bt)],6))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",t.unref(v)!==null||t.unref(I)?"":"not-move-animate",e.move?"is-move":"",e.drag?"is-drag":""]),style:t.normalizeStyle({width:e.s_width-t.unref(A)*2+"px",height:e.s_height-t.unref(Y)*2+"px",top:e.s_y+t.unref(Y)+"px",left:e.s_x+t.unref(A)+"px"}),key:s},null,6))),128)),t.unref(v)!==null||t.unref(I)?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(a).s_width+"px",height:t.unref(a).s_height+"px",top:t.unref(a).s_y+"px",left:t.unref(a).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ne)>0?t.unref(ne)*W()+(f.seeModel?f.seeModelMinBg:220):0)+"px"})},null,4),f.showAuxiliary?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(Me)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(Me)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(Ie)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(Ie)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(Se)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(Se)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(Be)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(Be)+"px",height:t.unref(ne)*W()+220+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(Ce)!==null?(t.openBlock(),t.createElementBlock("div",{key:4,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(Ce)+"px",height:t.unref(ne)*W()+220+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(me)!==null?(t.openBlock(),t.createElementBlock("div",{key:5,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(me)+"px",height:t.unref(ne)*W()+220+"px"})},null,4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)]),t.unref(n).length===0?(t.openBlock(),t.createElementBlock("div",jt,[t.renderSlot(l.$slots,"empty",{},()=>[r[0]||(r[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)],512)],4))}}],ct={install(f){el.forEach(E=>{f.component("vueDragComponentPlus",E)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(ct),ct});
