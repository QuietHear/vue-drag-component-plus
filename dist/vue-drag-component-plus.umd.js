(function(t,A){typeof exports=="object"&&typeof module<"u"?module.exports=A(require("vue")):typeof define=="function"&&define.amd?define(["vue"],A):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=A(t.Vue))})(this,function(t){"use strict";const A={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(m){return(H,gt)=>{const z=t.resolveComponent("el-icon");return m.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(m.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},m.iconObj.attrs)),null,16)):m.iconObj.type==="el"?(t.openBlock(),t.createBlock(z,t.normalizeProps(t.mergeProps({key:1},m.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(m.iconObj.icon)))]),_:1},16)):m.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+m.iconObj.icon]},m.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:m.iconObj.type},m.iconObj.attrs),t.toDisplayString(m.iconObj.icon),17))}}},pe="",Ot=["onMousedown","onMouseenter","onMouseleave"],Gt={class:"com-item-box"},It=["title"],Wt={class:"com-item-box-content"},Ht=["onClick"],Tt=["onClick"],vt={key:1,class:"com-item-box-content"},Yt=["onClick"],Xt=["onClick"],Lt=["onClick"],Rt=["onClick"],$t=["onClick"],At=["onMousedown"],bt=["onMousedown"],_t=["onMousedown"],Ft=["onMousedown"],Kt=["onMousedown"],qt=["onMousedown"],Ut=["onMousedown"],Jt=["onMousedown"],Qt={key:2,class:"com-empty"},Zt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},addFirstSpace:{type:Boolean,default:!1},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(m,H){return m>=0}},itemMinWidth:{type:Number,default:15,validator(m,H){return m>=15}},itemMinHeight:{type:Number,default:15,validator(m,H){return m>=15}},ySpace:{type:Number,default:7,validator(m,H){return m>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},hideAuxiliary:{type:Boolean,default:!1},auxiliarySpace:{type:Number,default:15,validator(m,H){return m>=1}}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop"],setup(m,{expose:H,emit:gt}){const z=gt,k=m,B=i=>{if(typeof i=="object"&&!t.isVNode(i)&&i!==null&&!(i instanceof Date)){let l=i instanceof Array?[]:{};for(let e in i)l[e]=typeof i[e]=="object"&&!t.isVNode(i[e])&&i[e]!==null&&!(i[e]instanceof Date)?B(i[e]):i[e];return l}else return i},xt=()=>{k.insertResizeKeys.forEach(i=>{k.excludeResizeKeys.indexOf(i)===-1&&T.value.push(i)})};t.watch(()=>[k.insertResizeKeys,k.excludeResizeKeys],()=>{xt()});const T=t.ref([]);xt();const G=t.ref(null);let q=null;const lt=i=>{q=i,z("baseWidthInit",q)},dt=t.ref(1),rt=i=>{dt.value=i,z("changeScle",dt.value)};let W=null,wt=null;const jt=t.ref(null),U=t.ref(0),J=t.ref(null),Q=t.ref(null),Z=t.ref(null),j=t.ref(null),b=i=>{const l=B(i);if(i===null)J.value=null,Q.value=null,Z.value=null,j.value=null;else{const e=getComputedStyle(G.value),n=parseInt(e.getPropertyValue("--auxiliary-width").trim()),r=p.value.filter(f=>f.id!==l.id).map(f=>f.y),x=p.value.filter(f=>f.id!==l.id).map(f=>f.y+f.height-1),d=[...r,...x];d.sort(),d.filter(f=>f<=l.y&&l.y-k.auxiliarySpace<f||f>=l.y&&l.y+k.auxiliarySpace>f).length>0?J.value=l.y:J.value=null,d.filter(f=>f<=l.y+l.height-1&&l.y+l.height-1-k.auxiliarySpace<f||f>=l.y+l.height-1&&l.y+l.height-1+k.auxiliarySpace>f).length>0?Q.value=l.y+l.height-n:Q.value=null;const w=p.value.filter(f=>f.id!==l.id).map(f=>f.x),y=p.value.filter(f=>f.id!==l.id).map(f=>f.x+f.width-1),c=[...w,...y];c.sort(),c.filter(f=>f<=l.x&&l.x-k.auxiliarySpace<f||f>=l.x&&l.x+k.auxiliarySpace>f).length>0?Z.value=l.x:Z.value=null,c.filter(f=>f<=l.x+l.width-1&&l.x+l.width-1-k.auxiliarySpace<f||f>=l.x+l.width-1&&l.x+l.width-1+k.auxiliarySpace>f).length>0?j.value=l.x+l.width-n:j.value=null}},p=t.ref([]),te=(i,l)=>{let e=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector;for(;i&&!e.call(i,l);)i=i.parentElement;return i};let C=null,kt=null,Mt=null;const V=t.ref({}),ee=(i,l)=>{tt(),C=l,V.value=B(p.value[C]),z("dragStart",B(p.value[C])),p.value[C].move=!0,b(p.value[C]);const e=te(i.target,".com-item");kt=i.clientX-e.offsetLeft,Mt=i.clientY-e.offsetTop,window.addEventListener("mousemove",Et),window.addEventListener("mouseup",mt)},Et=i=>{const l=i.clientX-kt,e=i.clientY-Mt,n=l<=v("left")?v("left"):l>=v("right")?v("right"):l,r=e<=v("top")?v("top"):e>=v("bottom")?v("bottom"):e,x=n-p.value[C].x,d=r-p.value[C].y,w=`${x>3?"right":x<-3?"left":""}_${d>0?"bottom":d<0?"top":""}`;p.value[C].x=n,p.value[C].y=r,b(p.value[C]);let y=B(p.value.filter(c=>c.move!==!0).filter(c=>c.x<n&&c.x+c.width>n||c.x===n||c.x>n&&c.x<n+p.value[C].width).filter(c=>c.y<r&&c.y+c.height>r||c.y===r||c.y>r&&c.y<r+p.value[C].height));if(y.length===0)V.value.x=n,V.value.y=r;else{if(w.indexOf("top")!==-1){y=y.filter(o=>o.y<V.value.y);const c=Math.min(...y.map(o=>o.y+o.height));y.forEach(o=>{Math.abs(o.y+o.height-c)<5&&(o.y=c-o.height)});let f=V.value.y-r,a=!0,s=[...y];const u=o=>{B(p.value.filter(h=>h.move!==!0&&h.y+h.height-o.y<=f+3&&h.y+h.height-o.y>=0).filter(h=>h.x<o.x&&h.x+h.width>o.x||h.x>=o.x&&h.x<o.x+o.width)).forEach(h=>{h.y+h.height!==o.y&&(h.y=o.y-h.height),s.findIndex(S=>S.id===h.id)===-1&&(s.push(h),u(h))})};if(y.forEach(o=>{u(o)}),s.sort((o,M)=>{const h=o.y,S=M.y;return h-S}),(s.length===0||s.filter(o=>o.y===0).length>0)&&(a=!1),a){let o=0;s.filter(h=>h.y===s[0].y).forEach(h=>{B(p.value.filter(E=>E.move!==!0&&E.y+E.height<h.y).filter(E=>E.x<h.x&&E.x+E.width>h.x||E.x>=h.x&&E.x<h.x+h.width)).forEach(E=>{E.y+E.height>o&&(o=E.y+E.height)})}),o=s[0].y-o,o<f&&(f=o),s.forEach(h=>{h.y-=f,p.value.filter(S=>S.id===h.id)[0].y=h.y}),V.value.x=n,V.value.y=p.value.filter(h=>h.id===s[s.length-1].id)[0].y+p.value.filter(h=>h.id===s[s.length-1].id)[0].height}else{let o=0;y.forEach(S=>{const E=p.value.filter(N=>N.move!==!0).filter(N=>N.x<S.x&&N.x+N.width>S.x||N.x===S.x||N.x>S.x&&N.x<S.x+S.width).filter(N=>N.y>S.y+S.height);E.length>0&&(o=Math.min(...E.map(N=>N.y)))});const M=o===0?0:o-V.value.height-(Math.max(...y.map(S=>S.y+S.height))-Math.min(...y.map(S=>S.y))),h=M===0?r+V.value.height-Math.min(...y.map(S=>S.y)):o-Math.min(...y.map(S=>S.y))-(Math.max(...y.map(S=>S.y+S.height))-Math.min(...y.map(S=>S.y)));if(M===0||r<=M){y.filter(E=>E.y<V.value.y).forEach(E=>{E.y+=h,p.value.filter(N=>N.id===E.id)[0].y=E.y}),V.value.x=n,V.value.y=r;const S=E=>{p.value.filter(P=>P.move!==!0&&P.id!==E.id).filter(P=>P.x<E.x&&P.x+P.width>E.x||P.x===E.x||P.x>E.x&&P.x<E.x+E.width).filter(P=>P.y<E.y&&P.y+P.height>E.y||P.y===E.y||P.y>E.y&&P.y<E.y+E.height).forEach(P=>{P.y=E.y+E.height,S(P)})};p.value.forEach(E=>S(E))}}y=B(p.value.filter(o=>o.move!==!0).filter(o=>o.x<n&&o.x+o.width>n||o.x===n||o.x>n&&o.x<n+p.value[C].width).filter(o=>o.y<r&&o.y+o.height>r||o.y===r||o.y>r&&o.y<r+p.value[C].height))}if(w.indexOf("bottom")!==-1){let c=0;y.forEach(s=>{const u=p.value.filter(o=>o.move!==!0).filter(o=>o.x<s.x&&o.x+o.width>s.x||o.x===s.x||o.x>s.x&&o.x<s.x+s.width).filter(o=>o.y+o.height<s.y);u.length>0&&(c=Math.max(...u.map(o=>o.y+o.height)))});const f=c+(Math.max(...y.map(s=>s.height+s.y))-Math.min(...y.map(s=>s.y))),a=Math.min(...y.map(s=>s.y))-c;if(r>=f){let s=!0;y.filter(o=>o.y>V.value.y).forEach(o=>{o.y-=a,p.value.filter(h=>h.id===o.id)[0].y=o.y;const M=p.value.filter(h=>h.move!==!0&&h.id!==o.id).filter(h=>h.x<o.x&&h.x+h.width>o.x||h.x===o.x||h.x>o.x&&h.x<o.x+o.width).filter(h=>h.y<o.y&&h.y+h.height>o.y||h.y===o.y||h.y>o.y&&h.y<o.y+o.height);M.length>0&&(o.y=Math.max(...M.map(h=>h.y+h.height)),p.value.filter(h=>h.id===o.id)[0].y=o.y)}),V.value.x=n,s&&(V.value.y=f);const u=o=>{p.value.filter(h=>h.id!==o.id).filter(h=>h.x<o.x&&h.x+h.width>o.x||h.x===o.x||h.x>o.x&&h.x<o.x+o.width).filter(h=>h.y<o.y&&h.y+h.height>o.y||h.y===o.y||h.y>o.y&&h.y<o.y+o.height).forEach(h=>{h.y=o.y+o.height,h.move===!0&&(V.value.y=h.y,s=!1),u(h)})};p.value.forEach(o=>u(o)),y=B(p.value.filter(o=>o.move!==!0).filter(o=>o.x<n&&o.x+o.width>n||o.x===n||o.x>n&&o.x<n+p.value[C].width).filter(o=>o.y<r&&o.y+o.height>r||o.y===r||o.y>r&&o.y<r+p.value[C].height))}}if(((w.indexOf("top")!==-1||w.indexOf("bottom")!==-1)&&(w.indexOf("right")!==-1||w.indexOf("left")!==-1)&&Math.abs(x)>8||w.indexOf("top")===-1&&w.indexOf("bottom")===-1&&(w.indexOf("right")!==-1||w.indexOf("left")!==-1))&&y.length>0){y.sort((f,a)=>{const s=f.y,u=a.y;return s-u});let c=!0;for(let f=0;f<y.length;f++){if(c){const a=B(p.value);for(let s=0;s<=f;s++){let u=null;const o=a.filter(M=>M.move!==!0&&M.y<y[s].y).filter(M=>M.x<y[s].x&&M.x+M.width>y[s].x||M.x===y[s].x||M.x>y[s].x&&M.x<y[s].x+y[s].width);if(o.length===0?u=0:u=Math.max(...o.map(M=>M.y+M.height)),s===f){if(y[s].y-(y[s].y+y[s].height-r)<u){c=!1;break}}else if(y[s].y-y[f].height<u){c=!1;break}else a.filter(M=>M.id===y[s].id)[0].y-=y[f].height}}if(c){y[f].y-=y[f].y+y[f].height-r,p.value.filter(a=>a.id===y[f].id)[0].y=y[f].y;for(let a=f;a>0;a--)y[f-1].y-=y[f].height,p.value.filter(s=>s.id===y[f-1].id)[0].y=y[f-1].y}else y.filter(a=>a.id===y[f].id).forEach(a=>{a.y+=p.value[C].y+p.value[C].height-a.y,p.value.filter(u=>u.id===a.id)[0].y=a.y;const s=u=>{p.value.filter(M=>M.move!==!0&&M.id!==u.id).filter(M=>M.x<u.x&&M.x+M.width>u.x||M.x===u.x||M.x>u.x&&M.x<u.x+u.width).filter(M=>M.y<u.y&&M.y+M.height>u.y||M.y===u.y||M.y>u.y&&M.y<u.y+u.height).forEach(M=>{M.y=u.y+u.height,s(M)})};s(a)})}V.value.x=n}}O(!1),z("dragIng",B(p.value[C]))},mt=()=>{window.removeEventListener("mousemove",Et),window.removeEventListener("mouseup",mt),delete p.value[C].move,p.value[C].x=V.value.x,p.value[C].y=V.value.y,b(null),O(),z("dragEnd",B(p.value[C])),C=null},v=i=>{switch(i){case"top":return 0;case"right":return W-p.value[C].width;case"bottom":return 999999999;case"left":return 0}};let g=null,pt="",ot=0,it=0,X=0,L=0,R=0,$=0,_=0,nt=0,F=0,at=0;const Y=(i,l,e)=>{tt(),g=l,z("resizeStart",B(g)),pt=e,ot=i.clientX,it=i.clientY,X=l.width,L=l.height,R=l.y,$=l.x,g.drag=!0,b(g);const n=p.value.filter(c=>c.static===!0&&(c.x<l.x?c.x+c.width>=l.x:c.x<=l.x+l.width)),r=p.value.filter(c=>c.static===!0&&(c.y<l.y?c.y+c.height>=l.y:c.y<=l.y+l.height)),x=n.filter(c=>c.y+c.height<=l.y).map(c=>c.y+c.height);x.length>0?_=Math.max(...x):_=0;const d=n.filter(c=>c.y>=l.y+l.height).map(c=>c.y);d.length>0?nt=Math.min(...d):nt=0;const w=r.filter(c=>c.x+c.width<=l.x).map(c=>c.x+c.width);w.length>0?F=Math.max(...w):F=0;const y=r.filter(c=>c.x>=l.x+l.width).map(c=>c.x);y.length>0?at=Math.min(...y):at=0,window.addEventListener("mousemove",Bt),window.addEventListener("mouseup",St)},Bt=i=>{const l=X+(i.clientX-ot),e=L+(i.clientY-it),n=X-(i.clientX-ot),r=L-(i.clientY-it),x=R+(i.clientY-it),d=$+(i.clientX-ot),w=getComputedStyle(G.value),y=parseInt(w.getPropertyValue("--com-item-border-width").trim()),c=parseInt(w.getPropertyValue("--group-tit-height").trim());switch(pt){case"top-left":if(g.height=r<k.itemMinHeight?k.itemMinHeight:r>D("top")?D("top"):r,g.y=r<k.itemMinHeight?R+L-k.itemMinHeight:r>D("top")?_:x,g.width=n<k.itemMinWidth?k.itemMinWidth:n>D("left")?D("left"):n,g.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>D("left")?F:d,g.isGroup===!0){const a=g.width-2*y,s=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(u=>{u.width=a*u.groupW,u.x=a*u.groupX,u.height=s*u.groupH,u.y=s*u.groupY})}break;case"top":if(g.height=r<k.itemMinHeight?k.itemMinHeight:r>D("top")?D("top"):r,g.y=r<k.itemMinHeight?R+L-k.itemMinHeight:r>D("top")?_:x,g.isGroup===!0){const a=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(s=>{s.height=a*s.groupH,s.y=a*s.groupY})}break;case"top-right":if(g.height=r<k.itemMinHeight?k.itemMinHeight:r>D("top")?D("top"):r,g.y=r<k.itemMinHeight?R+L-k.itemMinHeight:r>D("top")?_:x,g.width=l<k.itemMinWidth?k.itemMinWidth:l>D("right")?D("right"):l,g.isGroup===!0){const a=g.width-2*y,s=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(u=>{u.width=a*u.groupW,u.x=a*u.groupX,u.height=s*u.groupH,u.y=s*u.groupY})}break;case"left":if(g.width=n<k.itemMinWidth?k.itemMinWidth:n>D("left")?D("left"):n,g.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>D("left")?F:d,g.isGroup===!0){const a=g.width-2*y;g.groupData.forEach(s=>{s.width=a*s.groupW,s.x=a*s.groupX})}break;case"right":if(g.width=l<k.itemMinWidth?k.itemMinWidth:l>D("right")?D("right"):l,g.isGroup===!0){const a=g.width-2*y;g.groupData.forEach(s=>{s.width=a*s.groupW,s.x=a*s.groupX})}break;case"bottom-left":if(g.height=e<k.itemMinHeight?k.itemMinHeight:e>D("bottom")?D("bottom"):e,g.width=n<k.itemMinWidth?k.itemMinWidth:n>D("left")?D("left"):n,g.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>D("left")?F:d,g.isGroup===!0){const a=g.width-2*y,s=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(u=>{u.width=a*u.groupW,u.x=a*u.groupX,u.height=s*u.groupH,u.y=s*u.groupY})}break;case"bottom":if(g.height=e<k.itemMinHeight?k.itemMinHeight:e>D("bottom")?D("bottom"):e,g.isGroup===!0){const a=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(s=>{s.height=a*s.groupH,s.y=a*s.groupY})}break;case"bottom-right":if(g.height=e<k.itemMinHeight?k.itemMinHeight:e>D("bottom")?D("bottom"):e,g.width=l<k.itemMinWidth?k.itemMinWidth:l>D("right")?D("right"):l,g.isGroup===!0){const a=g.width-2*y,s=g.height-2*y-(g.groupTit?c:0);g.groupData.forEach(u=>{u.width=a*u.groupW,u.x=a*u.groupX,u.height=s*u.groupH,u.y=s*u.groupY})}break}b(g);let f=B(p.value.filter(a=>a.drag!==!0).filter(a=>a.x<g.x&&a.x+a.width>g.x||a.x===g.x||a.x>g.x&&a.x<g.x+g.width).filter(a=>a.y<g.y&&a.y+a.height>g.y||a.y===g.y||a.y>g.y&&a.y<g.y+g.height));if(f.length>0){f.sort((a,s)=>{const u=a.y,o=s.y;return u-o});for(let a=0;a<f.length;a++)f.filter(s=>s.id===f[a].id).forEach(s=>{s.y+=g.y+g.height-s.y,p.value.filter(o=>o.id===s.id)[0].y=s.y;const u=o=>{p.value.filter(h=>h.drag!==!0&&h.id!==o.id).filter(h=>h.x<o.x&&h.x+h.width>o.x||h.x===o.x||h.x>o.x&&h.x<o.x+o.width).filter(h=>h.y<o.y&&h.y+h.height>o.y||h.y===o.y||h.y>o.y&&h.y<o.y+o.height).forEach(h=>{h.y=o.y+o.height,u(h)})};u(s)})}O(!1),z("resizeIng",B(g))},St=i=>{delete g.drag,pt="",b(null),window.removeEventListener("mousemove",Bt),window.removeEventListener("mouseup",St),O(),z("resizeEnd",B(g)),g=null},D=i=>{switch(i){case"top":return R+L-_;case"left":return $+X-F;case"right":return(at>0?at:W)-$;case"bottom":return nt>0?nt-R:999999999}},O=(i=!0)=>{i===!0&&(Ct(),le());const l=p.value.map(e=>e.y+e.height);l.length>0?U.value=Math.max(...l):U.value=0};t.watch(()=>k.ySpace,()=>{k.ySpace>=0&&Ct()});const Ct=()=>{const i=B(p.value).sort((l,e)=>{const n=l.y,r=e.y;return n-r});for(let l=0;l<i.length;l++){const e=i.filter(n=>n.x<=i[l].x&&n.x+n.width>i[l].x||n.x>i[l].x&&n.x<i[l].x+i[l].width).filter(n=>n.y+n.height<=i[l].y);e.length>0?i[l].y=Math.max(...e.map(n=>n.y+n.height)):i[l].y=0}i.sort((l,e)=>{const n=l.y,r=e.y;return n-r});for(let l=0;l<i.length-1;l++){const e=[],n=r=>{i.filter(d=>d.x<=r.x&&d.x+d.width>r.x||d.x>r.x&&d.x<r.x+r.width).filter(d=>d.y===r.y+r.height).forEach(d=>{e.push(d.id),n(d)})};n(i[l]),e.forEach(r=>{i.filter(x=>x.id===r)[0].y+=k.ySpace})}i.forEach(l=>{p.value.filter(e=>e.id===l.id)[0].y=l.y}),k.addFirstSpace&&p.value.forEach(l=>l.y+=k.ySpace)},le=()=>{const i=p.value.filter(l=>l.isGroup===!0);if(i.length>0){const l=getComputedStyle(G.value),e=parseInt(l.getPropertyValue("--setting-icon-group-width").trim());i.forEach(n=>{n.x+n.width+e>W?n.x-e<0?n.btnPosition="center":n.btnPosition="left":n.btnPosition="right"})}};t.onMounted(()=>{Dt.observe(G.value)});const Dt=new ResizeObserver(i=>{ne(W===i[0].contentRect.width?null:i[0].contentRect.width,wt===i[0].contentRect.height?null:i[0].contentRect.height)});let ut=!1;const re=(i=[],l=null)=>{p.value=B(i),p.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)et(e.id);else{const n=ht(e.groupData,e);ct(n)}}),ut=!0,t.nextTick(()=>{const e=G.value.getBoundingClientRect();if(l!==null){lt(l),rt(e.width/l);const n=e.width/l,r=getComputedStyle(G.value),x=parseInt(r.getPropertyValue("--com-item-border-width").trim()),d=parseInt(r.getPropertyValue("--group-tit-height").trim());p.value.forEach(w=>{if(w.width*=n,w.height*=n,w.x*=n,w.y*=n,w.isGroup===!0){const y=w.width-2*x,c=w.height-2*x-(w.groupTit?d:0);w.groupData.forEach(f=>{f.width=y*f.groupW,f.x=y*f.groupX,f.height=c*f.groupH,f.y=c*f.groupY})}}),O()}else lt(e.width),rt(1),O();setTimeout(()=>{ut=!1},500)})},oe=(i,l)=>{l.showSet=!0},ie=(i,l)=>{delete l.showSet},Vt=(i,l,e)=>{const n=l.map(d=>d.y),r=Math.max(...n),x=l.filter(d=>d.y+d.height>r);x.sort((d,w)=>{const y=d.x,c=w.x;return y-c});for(let d=0;d<x.length;d++){if(d===0&&x[d].x>=i.width){i.y=r,i.x=0;break}if(x.length>1&&d!==x.length-1&&x[d].x+x[d].width+i.width<=x[d+1].x){i.y=r,i.x=x[d].x+x[d].width;break}if(d===x.length-1&&x[d].x+x[d].width+i.width<=e){i.y=r,i.x=x[d].x+x[d].width;break}}if(i.y==null){i.x=0;const d=l.map(w=>w.y+w.height);i.y=Math.max(...d)}},st=(i,l=null,e=!1)=>{const n=B(i),r=p.value.filter(x=>x.id===l);if(n.id||(n.id=new Date().getTime()+""),l&&r.length!==1){try{}catch{}return}if(e!==!0)if(delete n.x,delete n.y,l){const x=getComputedStyle(G.value),d=parseInt(x.getPropertyValue("--com-item-border-width").trim());Vt(n,r[0].groupData,r[0].width-2*d)}else p.value.length===0?(n.x=0,n.y=0):Vt(n,p.value,W);if(l){r[0].groupData.push(n);const x=ht(r[0].groupData,r[0]);ct(x);const d=w=>{p.value.filter(c=>c.id!==w.id).filter(c=>c.x<w.x&&c.x+c.width>w.x||c.x===w.x||c.x>w.x&&c.x<w.x+w.width).filter(c=>c.y<w.y&&c.y+c.height>w.y||c.y===w.y||c.y>w.y&&c.y<w.y+w.height).forEach(c=>{c.y=w.y+w.height,d(c)})};d(x)}else p.value.length===0&&lt(W),p.value.push(n);O()},K=(i,l=null)=>{let e=-1;const n=p.value.filter(r=>r.id===l);if(l?n.length===1&&(e=n[0].groupData.findIndex(r=>r.id===i)):e=p.value.findIndex(r=>r.id===i),e!==-1){if(l)if(n[0].groupData.splice(e,1),n[0].groupData.length===1)et(l);else{const r=ht(n[0].groupData,n[0]);ct(r)}else p.value.splice(e,1),p.value.length===0&&(lt(null),rt(1));O()}else try{}catch{}},ct=i=>{if(i.id){const l=B(i);delete l.showPop,delete l.showSet,delete l.btnPosition,l.groupData&&l.groupData.forEach(r=>{delete r.showPop,delete r.showSet});let e=-1;const n=p.value.filter(r=>r.id===l.inGroupId);if(l.inGroupId?n.length===1&&(e=n[0].groupData.findIndex(r=>r.id===l.id)):e=p.value.findIndex(r=>r.id===l.id),e!==-1)l.inGroupId?n[0].groupData[e]=l:p.value[e]=l,O();else try{}catch{}}else try{}catch{}},ne=(i,l)=>{if(i!==null){const e=W?i/W:1;if(W=i,!ut){rt(q&&W?i/q:1);const n=getComputedStyle(G.value),r=parseInt(n.getPropertyValue("--com-item-border-width").trim()),x=parseInt(n.getPropertyValue("--group-tit-height").trim());p.value.forEach(d=>{if(d.width*=e,d.height*=e,d.x*=e,d.y*=e,d.isGroup===!0){const w=d.width-2*r,y=d.height-2*r-(d.groupTit?x:0);d.groupData.forEach(c=>{c.width=w*c.groupW,c.x=w*c.groupX,c.height=y*c.groupH,c.y=y*c.groupY})}}),O()}}l!==null&&(wt=l)},Pt=i=>{i.showPop||(p.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(e=>{delete e.showPop})}),z("openSetMenu",B(i)),i.showPop=!0,window.addEventListener("click",tt))},tt=()=>{p.value.forEach(i=>{delete i.showPop,i.groupData&&i.groupData.forEach(l=>{delete l.showPop})}),window.removeEventListener("click",tt)},I=t.ref(!1),zt=i=>{const l=p.value.findIndex(e=>e.id===i);if(l!==-1)p.value[l].checked=!0,p.value[l].disabled=!0,I.value=!0,z("showGroup",I.value);else try{}catch{}},ft=()=>{I.value=!1,p.value.forEach(i=>{delete i.checked,delete i.disabled,i.groupData&&i.groupData.forEach(l=>{delete l.checked,delete l.disabled})}),z("showGroup",I.value)},ae=i=>{i.checked=!i.checked,z("updateChecked",p.value.filter(l=>l.checked).length)},ht=(i,l)=>{const e=B(i),n=B(l);e.sort((a,s)=>{const u=a.x,o=s.x;return u-o});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].x>0){const s=e[a].x;for(let u=a;u<e.length;u++)e[u].x-=s}if(e[a+1].x>e[a].x+e[a].width){const s=B(e.slice(0,a+1));if(e[a+1].x>Math.max(...s.map(u=>u.x+u.width))){const u=e[a+1].x-Math.max(...s.map(o=>o.x+o.width));for(let o=a+1;o<e.length;o++)e[o].x-=u}}}e.sort((a,s)=>{const u=a.y,o=s.y;return u-o});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].y>0){const s=e[a].y;for(let u=a;u<e.length;u++)e[u].y-=s}if(e[a+1].y>e[a].y+e[a].height){const s=B(e.slice(0,a+1));if(e[a+1].y>Math.max(...s.map(u=>u.y+u.height))){const u=e[a+1].y-Math.max(...s.map(o=>o.y+o.height));for(let o=a+1;o<e.length;o++)e[o].y-=u}}}const r=e.map(a=>a.x+a.width),x=Math.max(...r),d=e.map(a=>a.y+a.height),w=Math.max(...d);e.forEach(a=>{a.inGroupId||(a.inGroupId=n.id),a.groupW=a.width/x,a.groupH=a.height/w,a.groupX=a.x/x,a.groupY=a.y/w,a.isObstacle=a.x+a.width===x&&a.y===0});const y=getComputedStyle(G.value),c=parseInt(y.getPropertyValue("--com-item-border-width").trim()),f=parseInt(y.getPropertyValue("--group-tit-height").trim());return n.width=x+2*c,n.height=w+2*c+(n.groupTit?f:0),n.groupData=[...e],n},se=()=>{t.nextTick(()=>{const i=getComputedStyle(G.value),l=parseInt(i.getPropertyValue("--com-item-border-width").trim()),e=parseInt(i.getPropertyValue("--group-tit-height").trim());p.value.filter(n=>n.isGroup===!0).forEach(n=>{const r=n.width-2*l,x=n.height-2*l-(n.groupTit?e:0);n.groupData.forEach(d=>{d.width=r*d.groupW,d.x=r*d.groupX,d.height=x*d.groupH,d.y=x*d.groupY})})})},ce=()=>{const i=p.value.filter(l=>l.checked);if(i.length>1){const l={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=ht(i,l);return e.groupData.forEach(n=>{K(n.id)}),st(e),O(),ft(),B(p.value.filter(n=>n.id===e.id)[0])}return ft(),null},Nt=(i,l)=>{const e=p.value.filter(n=>n.id===l)[0];if(e){const n=e.groupData.filter(r=>r.id===i)[0];if(n)return e.groupData.length===2?et(l):(delete n.inGroupId,delete n.groupW,delete n.groupH,delete n.groupX,delete n.groupY,delete n.isObstacle,K(n.id,e.id),st(n),O(),[B(p.value.filter(r=>r.id===i)[0])]);try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},et=i=>{const l=p.value.filter(e=>e.id===i)[0];if(l){let e=[];l.groupData.forEach(r=>{delete r.inGroupId,delete r.groupW,delete r.groupH,delete l.groupX,delete l.groupY,delete l.isObstacle,r.x+=l.x,r.y+=l.y,e.push(r.id),st(r,null,!0)}),K(l.id),O();let n=[];return e.forEach(r=>{n.push(B(p.value.filter(x=>x.id===r)[0]))}),n}else try{}catch{}finally{return[]}},he=(i="",l)=>{const e=p.value.filter(n=>n.id===l)[0];if(e){if(!e.groupTit||!i){const r=getComputedStyle(G.value),x=parseInt(r.getPropertyValue("--group-tit-height").trim());e.groupTit&&!i&&(e.height-=x),!e.groupTit&&i&&(e.height+=x)}e.groupTit=i;const n=r=>{p.value.filter(d=>d.id!==r.id).filter(d=>d.x<r.x&&d.x+d.width>r.x||d.x===r.x||d.x>r.x&&d.x<r.x+r.width).filter(d=>d.y<r.y&&d.y+d.height>r.y||d.y===r.y||d.y>r.y&&d.y<r.y+r.height).forEach(d=>{d.y=r.y+r.height,n(d)})};n(e),O()}else try{}catch{}},de=()=>{p.value.forEach(l=>{delete l.showPop,delete l.showSet,delete l.btnPosition,l.groupData&&l.groupData.forEach(e=>{delete e.showPop,delete e.showSet})});const i=B(p.value);return i.forEach(l=>{delete l.btnPosition}),{data:i,width:q}};return t.onBeforeUnmount(()=>{Dt.unobserve(G.value),window.removeEventListener("click",tt)}),H({init:re,addItem:st,deleteItem:K,updateItem:ct,openGroup:zt,closeGroup:ft,changeGroupBorder:se,addGroup:ce,removeGroupItem:Nt,removeGroup:et,changeGroupTit:he,getData:de}),(i,l)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(dt)}),ref_key:"pageRef",ref:G},[t.createElementVNode("div",{class:"content-box",ref_key:"boxRef",ref:jt},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(p),(e,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",m.seeModel||t.unref(I)||e.static===!0||e.dragable===!1?"":"can-drag",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop?"on-top":"",m.seeModel?"no-hover":""]),style:t.normalizeStyle({width:e.width+"px",height:e.height+"px",top:e.y+"px",left:e.x+"px"}),key:n,onMousedown:t.withModifiers(r=>m.seeModel||t.unref(I)||e.static===!0||e.dragable===!1?null:ee(r,n),["prevent"]),onMouseenter:r=>m.seeModel||t.unref(I)||t.unref(C)||t.unref(g)||!e.isGroup?null:oe(r,e),onMouseleave:r=>m.seeModel||t.unref(I)||t.unref(C)||t.unref(g)||!e.isGroup?null:ie(r,e)},[t.createElementVNode("div",Gt,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,It)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(r,x)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",r.isObstacle?"else":""]),style:t.normalizeStyle({width:r.width+"px",height:r.height+"px",top:r.y+"px",left:r.x+"px"}),key:x},[t.createElementVNode("div",Wt,[t.renderSlot(i.$slots,"item",{data:r},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(r.width*100)/100)+","+t.toDisplayString(Math.round(r.height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(r.x*100)/100)+","+t.toDisplayString(Math.round(r.y*100)/100),1)])]),!m.seeModel&&!t.unref(I)&&t.unref(C)===null&&t.unref(g)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:r.showPop?"flex":"none"}),onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.createVNode(A,{iconObj:m.settingIcon,onClick:t.withModifiers(d=>Pt(r),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),r.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.renderSlot(i.$slots,"setPopNormal",{data:B(r)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Nt(r.id,r.inGroupId)},"移出组合",8,Ht),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>K(r.id,r.inGroupId)},"删除",8,Tt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",vt,[t.renderSlot(i.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.width*100)/100)+","+t.toDisplayString(Math.round(e.height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.x*100)/100)+","+t.toDisplayString(Math.round(e.y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(I)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.disabled?"disabled":""]),onClick:r=>e.disabled?null:ae(e)},null,10,Yt)):t.createCommentVNode("",!0),!m.seeModel&&!t.unref(I)&&t.unref(C)===null&&t.unref(g)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[t.createVNode(A,{iconObj:m.settingIcon,onClick:t.withModifiers(r=>Pt(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?"special":""]),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(i.$slots,"setPopSpecial",{key:0,data:B(e)},()=>[m.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>z("showTitPop",e.groupTit,e.id)}," 设置组合标题",8,Xt)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>et(e.id)},"解除组合",8,Lt)]):t.renderSlot(i.$slots,"setPopNormal",{key:1,data:B(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>zt(e.id)},"组合",8,Rt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>K(e.id)},"删除",8,$t)])],34)):t.createCommentVNode("",!0)]),!m.seeModel&&!t.unref(I)&&!e.showPop&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(T).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(r=>Y(r,e,"top-left"),["prevent","stop"])},null,40,At)):t.createCommentVNode("",!0),t.unref(T).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(r=>Y(r,e,"top"),["prevent","stop"])},null,40,bt)):t.createCommentVNode("",!0),t.unref(T).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(r=>Y(r,e,"top-right"),["prevent","stop"])},null,40,_t)):t.createCommentVNode("",!0),t.unref(T).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(r=>Y(r,e,"left"),["prevent","stop"])},null,40,Ft)):t.createCommentVNode("",!0),t.unref(T).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(r=>Y(r,e,"right"),["prevent","stop"])},null,40,Kt)):t.createCommentVNode("",!0),t.unref(T).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(r=>Y(r,e,"bottom-left"),["prevent","stop"])},null,40,qt)):t.createCommentVNode("",!0),t.unref(T).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(r=>Y(r,e,"bottom"),["prevent","stop"])},null,40,Ut)):t.createCommentVNode("",!0),t.unref(T).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(r=>Y(r,e,"bottom-right"),["prevent","stop"])},null,40,Jt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],46,Ot))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(p),(e,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.width+"px",height:e.height+"px",top:e.y+"px",left:e.x+"px"}),key:n},null,6))),128)),t.unref(C)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(V).width+"px",height:t.unref(V).height+"px",top:t.unref(V).y+"px",left:t.unref(V).x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(U)>0?+(t.unref(U)+(m.seeModel?m.seeModelMinBg:220)):t.unref(U))+"px"})},null,4),m.hideAuxiliary?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(J)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(J)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(Q)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(Q)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(Z)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(Z)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(j)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(j)+"px"})},null,4)):t.createCommentVNode("",!0)],64)),t.unref(p).length===0?(t.openBlock(),t.createElementBlock("div",Qt,[t.renderSlot(i.$slots,"empty",{},()=>[l[0]||(l[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)],512)],4))}}],yt={install(m){Zt.forEach(H=>{m.component("vueDragComponentPlus",H)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(yt),yt});
