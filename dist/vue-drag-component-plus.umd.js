(function(t,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue")):typeof define=="function"&&define.amd?define(["vue"],j):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=j(t.Vue))})(this,function(t){"use strict";const j={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(g){return(Y,Ge)=>{const v=t.resolveComponent("el-icon");return g.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(g.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},g.iconObj.attrs)),null,16)):g.iconObj.type==="el"?(t.openBlock(),t.createBlock(v,t.normalizeProps(t.mergeProps({key:1},g.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(g.iconObj.icon)))]),_:1},16)):g.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+g.iconObj.icon]},g.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:g.iconObj.type},g.iconObj.attrs),t.toDisplayString(g.iconObj.icon),17))}}},Lt="",je={class:"content-box"},et=["onMousedown","onMouseenter","onMouseleave"],tt={class:"com-item-box"},ot=["title"],lt={class:"com-item-box-content"},rt=["onClick"],st=["onClick"],nt=["onClick"],at={key:1,class:"com-item-box-content"},it=["onClick"],ct=["onClick"],dt=["onClick"],ht=["onClick"],ut=["onClick"],ft=["onClick"],pt=["onMousedown"],gt=["onMousedown"],yt=["onMousedown"],_t=["onMousedown"],xt=["onMousedown"],wt=["onMousedown"],kt=["onMousedown"],mt=["onMousedown"],Et={key:2,class:"com-empty"},Mt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(g,Y){return g>=0}},itemMinWidth:{type:Number,default:15,validator(g,Y){return g>=15}},itemMinHeight:{type:Number,default:15,validator(g,Y){return g>=15}},xSpace:{type:Number,default:10,validator(g,Y){return g>=0}},ySpace:{type:Number,default:null,validator(g,Y){return g>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},showAuxiliary:{type:Boolean,default:!1},groupBtnPosMore:{type:Boolean,default:!1},beforeAddGroup:{type:Function,default:g=>g},beforeRemoveGroup:{type:Function,default:g=>g}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop","domStart","domReady"],setup(g,{expose:Y,emit:Ge}){const v=Ge,C=g,b=o=>{if(typeof o=="object"&&!t.isVNode(o)&&o!==null&&!(o instanceof Date)){let l=o instanceof Array?[]:{};for(let e in o)l[e]=typeof o[e]=="object"&&!t.isVNode(o[e])&&o[e]!==null&&!(o[e]instanceof Date)?b(o[e]):o[e];return l}else return o},bt=(o,l)=>{let e=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.msMatchesSelector;for(;o&&!e.call(o,l);)o=o.parentElement;return o},St=(o,l)=>o.classList?o.classList.contains(l):new RegExp("\\s"+l+"\\s").test(" "+o.className+" "),Te=(o,l)=>{let e=[],s=r=>{r.forEach(i=>{St(i,l)&&e.push(i),i.childNodes&&i.childNodes.length>0&&s(i.childNodes)})};return s(o.childNodes),e},_e=(o,l,e=!1)=>Bt(K(o,l,e),l,e),K=(o,l,e=!1)=>o.filter(s=>s[e?"s_x":"x"]<=l[e?"s_x":"x"]&&s[e?"s_x":"x"]+s[e?"s_width":"width"]>l[e?"s_x":"x"]||s[e?"s_x":"x"]>l[e?"s_x":"x"]&&s[e?"s_x":"x"]<l[e?"s_x":"x"]+l[e?"s_width":"width"]),Bt=(o,l,e=!1)=>o.filter(s=>s[e?"s_y":"y"]<=l[e?"s_y":"y"]&&s[e?"s_y":"y"]+s[e?"s_height":"height"]>l[e?"s_y":"y"]||s[e?"s_y":"y"]>l[e?"s_y":"y"]&&s[e?"s_y":"y"]<l[e?"s_y":"y"]+l[e?"s_height":"height"]),q=(o,l=s=>s,e=!1)=>{const s=b(n.value),r=b(o);r.sort((d,k)=>{const u=d[e?"s_y":"y"],p=k[e?"s_y":"y"];if(u!==p)return u-p;{const a=d[e?"s_x":"x"],x=k[e?"s_x":"x"];return a-x}});const i=d=>{_e(l(s,d),d,e).forEach(u=>{u[e?"s_y":"y"]=d[e?"s_y":"y"]+d[e?"s_height":"height"],i(u)})};r.forEach(d=>i(s.filter(k=>k.id===d.id)[0])),s.forEach(d=>{n.value.filter(k=>k.id===d.id)[0][e?"s_y":"y"]=d[e?"s_y":"y"]})},I=o=>{const l=b(o);return delete l.showPop,delete l.showSet,l.groupData?l.groupData.forEach(e=>{delete e.showPop,delete e.showSet,W(e,l),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):l.inGroupId&&(delete l.showPop,delete l.showSet,W(l,n.value.filter(e=>e.id===l.inGroupId)[0])),delete l.btnPosition,delete l.s_width,delete l.s_height,delete l.s_x,delete l.s_y,l},n=t.ref([]),Oe=()=>{C.insertResizeKeys.forEach(o=>{C.excludeResizeKeys.indexOf(o)===-1&&L.value.push(o)})};t.watch(()=>[C.insertResizeKeys,C.excludeResizeKeys],()=>{Oe()});const L=t.ref([]);Oe();const Ae=()=>{n.value.length>0&&n.value.filter(o=>o.isGroup===!0).forEach(o=>{te(o)})},Ye=()=>{C.xSpace!==null&&C.xSpace!==void 0?G.value=C.xSpace/2:G.value=10/2,C.ySpace!==null&&C.ySpace!==void 0&&C.ySpace>=0?R.value=C.ySpace/2:R.value=G.value,Ae()};t.watch(()=>[C.xSpace,C.ySpace],()=>{Ye()});const G=t.ref(0),R=t.ref(0);Ye();const T=t.ref(null);let ee=null;const ae=o=>{ee=o,v("baseWidthInit",ee)},E=t.ref(1),ie=o=>{E.value=o,v("changeScle",E.value)},te=o=>{o.s_width=o.width*E.value,o.s_height=o.height*E.value;const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--com-item-border-width").trim()),s=parseInt(l.getPropertyValue("--group-tit-height").trim());if(o.isGroup===!0){const r=o.s_width-2*G.value*E.value-2*e,i=o.s_height-2*R.value*E.value-2*e-(o.groupTit?s:0);o.groupData.forEach(d=>{d.s_width=r*d.groupW,d.s_height=i*d.groupH,d.s_x=r*d.groupX,d.s_y=i*d.groupY})}},Dt=o=>{o.s_x=o.x*E.value,o.s_y=o.y*E.value},Ct=o=>{o.width=o.s_width/E.value,o.height=o.s_height/E.value;const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--group-tit-height").trim());if(o.isGroup===!0){const s=o.width,r=o.height-(o.groupTit?e:0);o.groupData.forEach(i=>{i.x=s*i.groupX,i.y=r*i.groupY})}},be=o=>{o.x=o.s_x/E.value,o.y=o.s_y/E.value};let H=null,Le=null;const ce=t.ref(0),de=t.ref(null),he=t.ref(null),ue=t.ref(null),fe=t.ref(null),oe=o=>{const l=b(o);if(!C.showAuxiliary||o===null)de.value=null,he.value=null,ue.value=null,fe.value=null;else{const e=getComputedStyle(T.value),s=parseInt(e.getPropertyValue("--auxiliary-width").trim()),r=n.value.filter(a=>a.id!==l.id).map(a=>a.s_y),i=n.value.filter(a=>a.id!==l.id).map(a=>a.s_y+a.s_height),d=[...r,...i];d.sort(),d.filter(a=>a===l.s_y).length>0?de.value=l.s_y:de.value=null,d.filter(a=>a===l.s_y+l.s_height).length>0?he.value=l.s_y+l.s_height-s:he.value=null;const k=n.value.filter(a=>a.id!==l.id).map(a=>a.s_x),u=n.value.filter(a=>a.id!==l.id).map(a=>a.s_x+a.s_width),p=[...k,...u];p.sort(),p.filter(a=>a===l.s_x).length>0?ue.value=l.s_x:ue.value=null,p.filter(a=>a===l.s_x+l.s_width).length>0?fe.value=l.s_x+l.s_width-s:fe.value=null}};let S=null,Re=null,He=null;const B=t.ref({});let Se=null;const vt=(o,l)=>{clearTimeout(Se),ge(),S=l,B.value=b(n.value[S]),v("dragStart",I(n.value[S])),n.value[S].move=!0,oe(n.value[S]);const e=bt(o.target,".com-item");Re=o.clientX-e.offsetLeft,He=o.clientY-e.offsetTop,window.addEventListener("mousemove",Xe),window.addEventListener("mouseup",$e)},Xe=o=>{clearTimeout(Se);const l=o.clientX-Re,e=o.clientY-He,s=l<=X("left")?X("left"):l>=X("right")?X("right"):l,r=e<=X("top")?X("top"):e>=X("bottom")?X("bottom"):e,i=s-n.value[S].s_x,d=r-n.value[S].s_y;let k="";d>0?k="bottom":d<0?k="top":i>2?k="right":i<-2&&(k="left"),n.value[S].s_x=s,n.value[S].s_y=r,oe(n.value[S]);let u=_e(b(n.value.filter(p=>p.move!==!0)),n.value[S],!0);if(u.length===0)B.value.s_x=s,B.value.s_y=r;else switch(k){case"top":u=u.filter(c=>c.s_y<B.value.s_y);const p=Math.min(...u.map(c=>c.s_y+c.s_height));u.forEach(c=>{Math.abs(c.s_y+c.s_height-p)<5&&(c.s_y=p-c.s_height)});let a=B.value.s_y-r,x=!0,f=[...u];const M=c=>{K(b(n.value.filter(h=>h.move!==!0&&Math.abs(h.s_y+h.s_height-c.s_y)<=3)),c,!0).forEach(h=>{f.findIndex(y=>y.id===h.id)===-1&&(f.push(h),M(h))})};if(u.forEach(c=>{M(c)}),f.sort((c,w)=>{const h=c.s_y,y=w.s_y;return h-y}),(f.length===0||f.filter(c=>c.s_y===0).length>0)&&(x=!1),x){let c=0;f.filter(h=>h.s_y===f[0].s_y).forEach(h=>{K(b(n.value.filter(D=>D.move!==!0&&D.s_y+D.s_height<h.s_y)),h,!0).forEach(D=>{D.s_y+D.s_height>c&&(c=D.s_y+D.s_height)})}),c=f[0].s_y-c,c<a&&(a=c),f.forEach(h=>{h.s_y-=a,n.value.filter(y=>y.id===h.id)[0].s_y=h.s_y}),B.value.s_x=s,B.value.s_y=n.value.filter(h=>h.id===f[f.length-1].id)[0].s_y+n.value.filter(h=>h.id===f[f.length-1].id)[0].s_height}else{let c=0;u.forEach(y=>{const D=K(n.value.filter(N=>N.move!==!0),y,!0).filter(N=>N.s_y>y.s_y+y.s_height);D.length>0&&(c=Math.min(...D.map(N=>N.s_y)))});const w=c===0?0:c-B.value.s_height-(Math.max(...u.map(y=>y.s_y+y.s_height))-Math.min(...u.map(y=>y.s_y))),h=w===0?r+B.value.s_height-Math.min(...u.map(y=>y.s_y)):c-Math.min(...u.map(y=>y.s_y))-(Math.max(...u.map(y=>y.s_y+y.s_height))-Math.min(...u.map(y=>y.s_y)));(w===0||r<=w)&&(u.filter(y=>y.s_y<B.value.s_y).forEach(y=>{y.s_y+=h,n.value.filter(D=>D.id===y.id)[0].s_y=y.s_y}),B.value.s_x=s,B.value.s_y=r,q(n.value,(y,D)=>y.filter(N=>N.move!==!0&&N.id!==D.id),!0))}break;case"bottom":let P=0;u.forEach(c=>{const w=K(n.value.filter(h=>h.move!==!0),c,!0).filter(h=>h.s_y+h.s_height<c.s_y);w.length>0&&(P=Math.max(...w.map(h=>h.s_y+h.s_height)))});const V=P+(Math.max(...u.map(c=>c.s_height+c.s_y))-Math.min(...u.map(c=>c.s_y))),z=Math.min(...u.map(c=>c.s_y))-P;r>=V&&(u.filter(c=>c.s_y>B.value.s_y).forEach(c=>{c.s_y-=z,n.value.filter(h=>h.id===c.id)[0].s_y=c.s_y;const w=_e(n.value.filter(h=>h.move!==!0&&h.id!==c.id),c,!0);w.length>0&&(c.s_y=Math.max(...w.map(h=>h.s_y+h.s_height)),n.value.filter(h=>h.id===c.id)[0].s_y=c.s_y)}),B.value.s_x=s,B.value.s_y=V,q(n.value,(c,w)=>c.filter(h=>h.move!==!0&&h.id!==w.id),!0));break;case"left":case"right":u.sort((c,w)=>{const h=c.s_y,y=w.s_y;return h-y});let F=!0;for(let c=0;c<u.length;c++){if(F){const w=b(n.value);for(let h=0;h<=c;h++){let y=null;const D=K(w.filter(N=>N.move!==!0&&N.s_y<u[h].s_y),u[h],!0);if(D.length===0?y=0:y=Math.max(...D.map(N=>N.s_y+N.s_height)),h===c){if(u[h].s_y-(u[h].s_y+u[h].s_height-r)<y){F=!1;break}}else if(u[h].s_y-u[c].s_height<y){F=!1;break}else w.filter(N=>N.id===u[h].id)[0].s_y-=u[c].s_height}}if(F){u[c].s_y-=u[c].s_y+u[c].s_height-r,n.value.filter(w=>w.id===u[c].id)[0].s_y=u[c].s_y;for(let w=c;w>0;w--)u[c-1].s_y-=u[c].s_height,n.value.filter(h=>h.id===u[c-1].id)[0].s_y=u[c-1].s_y}else u.filter(w=>w.id===u[c].id).forEach(w=>{w.s_y+=n.value[S].s_y+n.value[S].s_height-w.s_y,n.value.filter(h=>h.id===w.id)[0].s_y=w.s_y,q([w],(h,y)=>h.filter(D=>D.move!==!0&&D.id!==y.id),!0)})}B.value.s_x=s;break}n.value.forEach(p=>{be(p)}),A(!1),v("dragIng",I(n.value[S]))},$e=()=>{window.removeEventListener("mousemove",Xe),window.removeEventListener("mouseup",$e),delete n.value[S].move,n.value[S].s_x=B.value.s_x,n.value[S].s_y=B.value.s_y,oe(null),n.value.forEach(o=>{be(o)}),A(),v("dragEnd",I(n.value[S])),S=null,Se=setTimeout(()=>{A()},500)},X=o=>{switch(o){case"top":return 0;case"right":return H-G.value*2*E.value-n.value[S].s_width;case"bottom":return 999999999;case"left":return 0}};let _=null,Be="",xe=0,we=0,U=0,J=0,Q=0,Z=0,le=0,ke=0,re=0,me=0;const $=(o,l,e)=>{ge(),_=l,v("resizeStart",I(_)),Be=e,xe=o.clientX,we=o.clientY,U=l.s_width,J=l.s_height,Q=l.s_y,Z=l.s_x,_.drag=!0,oe(_);const s=n.value.filter(p=>p.static===!0&&(p.s_x<l.s_x?p.s_x+p.s_width>=l.s_x:p.s_x<=l.s_x+l.s_width)),r=n.value.filter(p=>p.static===!0&&(p.s_y<l.s_y?p.s_y+p.s_height>=l.s_y:p.s_y<=l.s_y+l.s_height)),i=s.filter(p=>p.s_y+p.s_height<=l.s_y).map(p=>p.s_y+p.s_height);i.length>0?le=Math.max(...i):le=0;const d=s.filter(p=>p.s_y>=l.s_y+l.s_height).map(p=>p.s_y);d.length>0?ke=Math.min(...d):ke=0;const k=r.filter(p=>p.s_x+p.s_width<=l.s_x).map(p=>p.s_x+p.s_width);k.length>0?re=Math.max(...k):re=0;const u=r.filter(p=>p.s_x>=l.s_x+l.s_width).map(p=>p.s_x);u.length>0?me=Math.min(...u):me=0,window.addEventListener("mousemove",We),window.addEventListener("mouseup",Fe)},We=o=>{const l=U+(o.clientX-xe),e=J+(o.clientY-we),s=U-(o.clientX-xe),r=J-(o.clientY-we),i=Q+(o.clientY-we),d=Z+(o.clientX-xe),k=getComputedStyle(T.value),u=parseInt(k.getPropertyValue("--com-item-border-width").trim()),p=parseInt(k.getPropertyValue("--group-tit-height").trim()),a=()=>{if(_.isGroup===!0){const P=_.s_width-2*G.value*E.value-2*u,V=_.s_height-2*R.value*E.value-2*u-(_.groupTit?p:0);_.groupData.forEach(z=>{z.s_width=P*z.groupW,z.s_height=V*z.groupH,z.s_x=P*z.groupX,z.s_y=V*z.groupY})}},x=(C.itemMinWidth+G.value*2)*E.value,f=(C.itemMinHeight+R.value*2)*E.value;switch(Be){case"top-left":_.s_height=r<f?f:r>m("top")?m("top"):r,_.s_y=r<f?Q+J-f:r>m("top")?le:i,_.s_width=s<x?x:s>m("left")?m("left"):s,_.s_x=s<x?Z+U-x:s>m("left")?re:d,a();break;case"top":_.s_height=r<f?f:r>m("top")?m("top"):r,_.s_y=r<f?Q+J-f:r>m("top")?le:i,a();break;case"top-right":_.s_height=r<f?f:r>m("top")?m("top"):r,_.s_y=r<f?Q+J-f:r>m("top")?le:i,_.s_width=l<x?x:l>m("right")?m("right"):l,a();break;case"left":_.s_width=s<x?x:s>m("left")?m("left"):s,_.s_x=s<x?Z+U-x:s>m("left")?re:d,a();break;case"right":_.s_width=l<x?x:l>m("right")?m("right"):l,a();break;case"bottom-left":_.s_height=e<f?f:e>m("bottom")?m("bottom"):e,_.s_width=s<x?x:s>m("left")?m("left"):s,_.s_x=s<x?Z+U-x:s>m("left")?re:d,a();break;case"bottom":_.s_height=e<f?f:e>m("bottom")?m("bottom"):e,a();break;case"bottom-right":_.s_height=e<f?f:e>m("bottom")?m("bottom"):e,_.s_width=l<x?x:l>m("right")?m("right"):l,a();break}Ct(_),oe(_);let M=_e(b(n.value.filter(P=>P.drag!==!0)),_,!0);if(M.length>0){M.sort((P,V)=>{const z=P.s_y,F=V.s_y;return z-F});for(let P=0;P<M.length;P++)M.filter(V=>V.id===M[P].id).forEach(V=>{V.s_y+=_.s_y+_.s_height-V.s_y,n.value.filter(z=>z.id===V.id)[0].s_y=V.s_y,q([V],(z,F)=>z.filter(c=>c.drag!==!0&&c.id!==F.id),!0)})}n.value.forEach(P=>{be(P)}),A(!1),v("resizeIng",I(_))},Fe=o=>{delete _.drag,Be="",oe(null),window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Fe),A(),v("resizeEnd",I(_)),_=null},m=o=>{switch(o){case"top":return Q+J-le;case"left":return Z+U-re;case"right":return(me>0?me:H-G.value*2*E.value)-Z;case"bottom":return ke>0?ke-Q:999999999}},A=(o=!0)=>{o===!0&&(q(n.value,(e,s)=>e.filter(r=>r.id!==s.id)),Pt(),n.value.forEach(e=>{Dt(e)}),zt());const l=n.value.map(e=>e.y+e.height);l.length>0?ce.value=Math.max(...l):ce.value=0},Pt=()=>{const o=b(n.value).sort((l,e)=>{const s=l.y,r=e.y;return s-r});for(let l=0;l<o.length;l++){const e=K(o,o[l]).filter(s=>s.y+s.height<=o[l].y);e.length>0?o[l].y=Math.max(...e.map(s=>s.y+s.height)):o[l].y=0}o.forEach(l=>{n.value.filter(e=>e.id===l.id)[0].y=l.y})},zt=()=>{const o=n.value.filter(l=>l.isGroup===!0);if(o.length>0){const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--setting-icon-group-width").trim()),s=parseInt(l.getPropertyValue("--setting-icon-group-height").trim());o.forEach(r=>{G.value+r.s_x+r.s_width+e>H?G.value+r.s_x-e<0?C.groupBtnPosMore?R.value+r.s_y-s<0?r.btnPosition="bottom":r.btnPosition="top":r.btnPosition="center":r.btnPosition="left":r.btnPosition="right"})}};t.onMounted(()=>{Ke.observe(T.value)});const Ke=new ResizeObserver(o=>{Vt(H===o[0].borderBoxSize[0].inlineSize?null:o[0].borderBoxSize[0].inlineSize,Le===o[0].borderBoxSize[0].blockSize?null:o[0].borderBoxSize[0].blockSize)}),pe=t.ref("");let De=0,Ce=0,ve=null,Pe=!1;const Nt=(o=[],l=null)=>{clearInterval(ve),pe.value=new Date().getTime()+"",De=0,Ce=0,o.forEach(e=>{De+=1,e.isGroup===!0&&(Ce+=e.groupData.length)}),Ze(),v("domStart"),n.value=b(o),n.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)ye(e.id);else{const s=Me(e.groupData,e);Ee(s)}}),Pe=!0,t.nextTick(()=>{const e=T.value.getBoundingClientRect();l!=null?(ae(l),ie(e.width/l)):(ae(n.value.length>0?e.width:null),ie(1)),n.value.forEach(s=>{te(s)}),A(),ve=setInterval(()=>{Te(T.value,pe.value+"p").length===De&&Te(T.value,pe.value+"c").length===Ce&&(clearInterval(ve),v("domReady"))},10),setTimeout(()=>{Pe=!1},500)})},It=o=>{o.showSet=!0},ze=o=>{const l=n.value.filter(e=>e.id===o);if(l.length===1)delete l[0].showSet;else try{}catch{}},qe=(o,l,e)=>{const s=l.map(d=>d.y),r=Math.max(...s),i=l.filter(d=>d.y+d.height>r);i.sort((d,k)=>{const u=d.x,p=k.x;return u-p});for(let d=0;d<i.length;d++){if(d===0&&i[d].x>=o.width){o.y=r,o.x=0;break}if(i.length>1&&d!==i.length-1&&i[d].x+i[d].width+o.width<=i[d+1].x){o.y=r,o.x=i[d].x+i[d].width;break}if(d===i.length-1&&i[d].x+i[d].width+o.width<=e){o.y=r,o.x=i[d].x+i[d].width;break}}if(o.y==null){o.x=0;const d=l.map(k=>k.y+k.height);o.y=Math.max(...d)}},se=(o,l=null,e=!1)=>{const s=b(o),r=n.value.filter(i=>i.id===l);if(s.id||(s.id=new Date().getTime()+""),l&&r.length!==1)try{}catch{}finally{return}if(e!==!0&&(delete s.x,delete s.y,l?(r[0].groupData.forEach(i=>{W(i,r[0])}),qe(s,r[0].groupData,r[0].width)):n.value.length===0?(s.x=0,s.y=0):qe(s,n.value,(ee||H)-G.value*2)),l){r[0].groupData.push(s);const i=Me(r[0].groupData,r[0]);Ee(i),q([i],(d,k)=>d.filter(u=>u.id!==k.id))}else n.value.length===0&&ae(H),te(s),n.value.push(s);A()},Ne=(o,l=null,e=null)=>{let s=null;const r=n.value.filter(i=>i.id===l);if(l?r.length===1&&(s=b(r[0].groupData.filter(i=>i.id===o)[0])):s=b(n.value.filter(i=>i.id===o)[0]),s)return s.id=e||new Date().getTime()+"",l?(W(s,r[0]),se(s,l)):se(s),I(l?n.value.filter(i=>i.id===l)[0].groupData.filter(i=>i.id===s.id)[0]:n.value.filter(i=>i.id===s.id)[0]);try{}catch{}finally{return null}},ne=(o,l=null)=>{let e=-1;const s=n.value.filter(r=>r.id===l);if(l?s.length===1&&(e=s[0].groupData.findIndex(r=>r.id===o)):e=n.value.findIndex(r=>r.id===o),e!==-1){if(l)if(s[0].groupData.splice(e,1),s[0].groupData.length===1)ye(l);else{s[0].groupData.forEach(i=>{W(i,s[0])});const r=Me(s[0].groupData,s[0]);Ee(r)}else n.value.splice(e,1),n.value.length===0&&(ae(null),ie(1));A()}else try{}catch{}},Ee=o=>{if(o.id){const l=b(o);delete l.showPop,delete l.showSet,delete l.btnPosition,l.groupData&&l.groupData.forEach(r=>{delete r.showPop,delete r.showSet});let e=-1;const s=n.value.filter(r=>r.id===l.inGroupId);if(l.inGroupId?s.length===1&&(e=s[0].groupData.findIndex(r=>r.id===l.id)):e=n.value.findIndex(r=>r.id===l.id),e!==-1)l.inGroupId?(s[0].groupData[e]=l,te(s[0])):(n.value[e]=l,te(n.value[e])),A();else try{}catch{}}else try{}catch{}},Vt=(o,l)=>{o!==null&&(H=o,Pe||(ie(ee&&H?o/ee:1),n.value.forEach(e=>{te(e)}),A())),l!==null&&(Le=l)},Ue=o=>{o.showPop||(n.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(e=>{delete e.showPop})}),v("openSetMenu",I(o)),o.showPop=!0,window.addEventListener("click",ge))},ge=()=>{n.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(l=>{delete l.showPop})}),window.removeEventListener("click",ge)},O=t.ref(!1),Je=o=>{const l=n.value.findIndex(e=>e.id===o);if(l!==-1)n.value[l].checked=!0,n.value[l].checkDis=!0,O.value=!0,v("showGroup",O.value);else try{}catch{}},Ie=()=>{O.value=!1,n.value.forEach(o=>{delete o.checked,delete o.checkDis,o.groupData&&o.groupData.forEach(l=>{delete l.checked,delete l.checkDis})}),v("showGroup",O.value)},Gt=o=>{o.checked=!o.checked,v("updateChecked",n.value.filter(l=>l.checked).length)},Me=(o,l)=>{const e=b(o),s=b(l);e.sort((a,x)=>{const f=a.x,M=x.x;return f-M});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].x>0){const x=e[a].x;for(let f=a;f<e.length;f++)e[f].x-=x}if(e[a+1].x>e[a].x+e[a].width){const x=b(e.slice(0,a+1));if(e[a+1].x>Math.max(...x.map(f=>f.x+f.width))){const f=e[a+1].x-Math.max(...x.map(M=>M.x+M.width));for(let M=a+1;M<e.length;M++)e[M].x-=f}}}e.sort((a,x)=>{const f=a.y,M=x.y;return f-M});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].y>0){const x=e[a].y;for(let f=a;f<e.length;f++)e[f].y-=x}if(e[a+1].y>e[a].y+e[a].height){const x=b(e.slice(0,a+1));if(e[a+1].y>Math.max(...x.map(f=>f.y+f.height))){const f=e[a+1].y-Math.max(...x.map(M=>M.y+M.height));for(let M=a+1;M<e.length;M++)e[M].y-=f}}}const r=e.map(a=>a.x+a.width),i=Math.max(...r),d=e.map(a=>a.y+a.height),k=Math.max(...d);e.forEach(a=>{a.inGroupId||(a.inGroupId=s.id),a.groupW=a.width/i,a.groupH=a.height/k,a.groupX=a.x/i,a.groupY=a.y/k,a.isObstacle=a.x+a.width===i&&a.y===0,delete a.width,delete a.height});const u=getComputedStyle(T.value),p=parseInt(u.getPropertyValue("--group-tit-height").trim());return s.width=i,s.height=k+(s.groupTit?p:0),s.groupData=[...e],s},W=(o,l)=>{const e=getComputedStyle(T.value),s=parseInt(e.getPropertyValue("--group-tit-height").trim());o.width=l.width*o.groupW,o.height=(l.height-(l.groupTit?s:0))*o.groupH},Tt=()=>{t.nextTick(()=>{Ae()})},Ot=()=>{let o=n.value.filter(l=>l.checked);if(o.length>1)if(o=C.beforeAddGroup(b(o)),typeof o=="object"&&o instanceof Array&&o.length>0&&o.filter(l=>l.id).length===o.length){const l={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=Me(o,l);return e.groupData.forEach(s=>{ne(s.id)}),se(e),Ie(),I(n.value.filter(s=>s.id===e.id)[0])}else try{}catch{}finally{return null}else return Ie(),null},Qe=(o,l)=>{const e=n.value.filter(s=>s.id===l)[0];if(e){let s=e.groupData.filter(r=>r.id===o)[0];if(s){if(e.groupData.length===2)return ye(l);if(s=C.beforeRemoveGroup(b([s])),typeof s=="object"&&s instanceof Array&&s.length===1&&s.filter(r=>r.id).length===1)return s=s[0],W(s,e),delete s.inGroupId,delete s.groupW,delete s.groupH,delete s.groupX,delete s.groupY,delete s.isObstacle,ne(s.id,e.id),se(s),[I(n.value.filter(r=>r.id===o)[0])];try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ye=o=>{const l=n.value.filter(e=>e.id===o)[0];if(l){let e=[],s=!0;try{l.groupData.forEach(r=>{if(r=C.beforeRemoveGroup(b([l])),typeof r=="object"&&r instanceof Array&&r.length===1&&r.filter(i=>i.id).length===1)r=r[0];else throw s=!1,new Error})}catch{}if(s){l.groupData.forEach(i=>{W(i,l),i.x+=l.x,i.y+=l.y,delete i.inGroupId,delete i.groupW,delete i.groupH,delete i.groupX,delete i.groupY,delete i.isObstacle,e.push(i.id),se(i,null,!0)}),ne(l.id);let r=[];return e.forEach(i=>{r.push(I(n.value.filter(d=>d.id===i)[0]))}),r}else return[]}else try{}catch{}finally{return[]}},At=(o="",l)=>{const e=n.value.filter(s=>s.id===l)[0];if(e){if(!e.groupTit||!o){const s=getComputedStyle(T.value),r=parseInt(s.getPropertyValue("--group-tit-height").trim());e.groupTit&&!o&&(e.height-=r,e.s_height-=r*E.value),!e.groupTit&&o&&(e.height+=r,e.s_height+=r*E.value)}e.groupTit=o,q([e],(s,r)=>s.filter(i=>i.id!==r.id)),A()}else try{}catch{}},Ze=()=>{n.value=[],ae(null),ie(1),ce.value=0},Yt=()=>new Promise((o,l)=>{n.value.forEach(s=>{delete s.showPop,delete s.showSet,s.groupData&&s.groupData.forEach(r=>{delete r.showPop,delete r.showSet})});const e=b(n.value);e.forEach(s=>{s.isGroup===!0&&s.groupData.forEach(r=>{W(r,s),delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y}),delete s.btnPosition,delete s.s_width,delete s.s_height,delete s.s_x,delete s.s_y}),o({data:e,width:ee})});return t.onBeforeUnmount(()=>{Ke.unobserve(T.value),window.removeEventListener("click",ge)}),Y({init:Nt,addItem:se,copyItem:Ne,deleteItem:ne,updateItem:Ee,hideGroupSet:ze,openGroup:Je,closeGroup:Ie,changeGroupBorder:Tt,addGroup:Ot,removeGroupItem:Qe,removeGroup:ye,changeGroupTit:At,resetData:Ze,getData:Yt}),(o,l)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(E),"--com-x-space":t.unref(G)+"px","--com-y-space":t.unref(R)+"px"}),ref_key:"pageRef",ref:T},[t.createElementVNode("div",je,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop||e.isGroup&&e.groupData.filter(r=>r.showPop).length>0?"on-top":"",t.unref(pe)+"p"]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:s},[t.createElementVNode("div",{class:t.normalizeClass(["com-item-inner",g.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?"":"can-drag",g.seeModel?"no-hover":""]),onMousedown:t.withModifiers(r=>g.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?null:vt(r,s),["prevent"]),onMouseenter:r=>g.seeModel||t.unref(O)||t.unref(S)||t.unref(_)||!e.isGroup?null:It(e),onMouseleave:r=>g.seeModel||t.unref(O)||t.unref(S)||t.unref(_)||!e.isGroup?null:ze(e.id)},[t.createElementVNode("div",tt,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,ot)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(r,i)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",r.isObstacle?"is-obstacle":"",t.unref(pe)+"c"]),style:t.normalizeStyle({width:r.s_width+"px",height:r.s_height+"px",top:r.s_y+"px",left:r.s_x+"px"}),key:i},[t.createElementVNode("div",lt,[t.renderSlot(o.$slots,"item",{data:r},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(r.s_width*100)/100)+","+t.toDisplayString(Math.round(r.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(r.s_x*100)/100)+","+t.toDisplayString(Math.round(r.s_y*100)/100),1)])]),!g.seeModel&&!t.unref(O)&&t.unref(S)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:r.showPop?"flex":"none"}),onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:g.settingIcon,onClick:t.withModifiers(d=>Ue(r),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),r.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.renderSlot(o.$slots,"setPopNormal",{data:I(r)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Qe(r.id,r.inGroupId)},"移出组合",8,rt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Ne(r.id,r.inGroupId)},"复制",8,st),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>ne(r.id,r.inGroupId)},"删除",8,nt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",at,[t.renderSlot(o.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_width*100)/100)+","+t.toDisplayString(Math.round(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_x*100)/100)+","+t.toDisplayString(Math.round(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(O)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:r=>e.checkDis?null:Gt(e)},null,10,it)):t.createCommentVNode("",!0),!g.seeModel&&!t.unref(O)&&t.unref(S)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="top"?"only-g t":e.btnPosition==="bottom"?"only-g b":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:g.settingIcon,onClick:t.withModifiers(r=>Ue(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="top"?"special t":e.btnPosition==="bottom"?"special b":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(o.$slots,"setPopSpecial",{key:0,data:I(e)},()=>[g.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>{ze(e.id),v("showTitPop",e.groupTit,e.id)}}," 设置组合标题",8,ct)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>ye(e.id)},"解除组合",8,dt)]):t.renderSlot(o.$slots,"setPopNormal",{key:1,data:I(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>Je(e.id)},"组合",8,ht)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>Ne(e.id)},"复制",8,ut),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>ne(e.id)},"删除",8,ft)])],34)):t.createCommentVNode("",!0)]),!g.seeModel&&!t.unref(O)&&!e.showPop&&!(e.isGroup&&e.groupData.filter(r=>r.showPop).length>0)&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(L).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(r=>$(r,e,"top-left"),["prevent","stop"])},null,40,pt)):t.createCommentVNode("",!0),t.unref(L).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(r=>$(r,e,"top"),["prevent","stop"])},null,40,gt)):t.createCommentVNode("",!0),t.unref(L).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(r=>$(r,e,"top-right"),["prevent","stop"])},null,40,yt)):t.createCommentVNode("",!0),t.unref(L).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(r=>$(r,e,"left"),["prevent","stop"])},null,40,_t)):t.createCommentVNode("",!0),t.unref(L).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(r=>$(r,e,"right"),["prevent","stop"])},null,40,xt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(r=>$(r,e,"bottom-left"),["prevent","stop"])},null,40,wt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(r=>$(r,e,"bottom"),["prevent","stop"])},null,40,kt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(r=>$(r,e,"bottom-right"),["prevent","stop"])},null,40,mt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],42,et)],6))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.s_width-t.unref(G)*2*t.unref(E)+"px",height:e.s_height-t.unref(R)*2*t.unref(E)+"px",top:e.s_y+t.unref(R)*t.unref(E)+"px",left:e.s_x+t.unref(G)*t.unref(E)+"px"}),key:s},null,6))),128)),t.unref(S)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(B).s_width+"px",height:t.unref(B).s_height+"px",top:t.unref(B).s_y+"px",left:t.unref(B).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ce)>0?+(t.unref(ce)*t.unref(E)+(g.seeModel?g.seeModelMinBg:220)):0)+"px"})},null,4),g.showAuxiliary?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(de)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(de)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(he)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(he)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(ue)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(ue)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(fe)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(fe)+"px"})},null,4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0),t.unref(n).length===0?(t.openBlock(),t.createElementBlock("div",Et,[t.renderSlot(o.$slots,"empty",{},()=>[l[0]||(l[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)])],4))}}],Ve={install(g){Mt.forEach(Y=>{g.component("vueDragComponentPlus",Y)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(Ve),Ve});
