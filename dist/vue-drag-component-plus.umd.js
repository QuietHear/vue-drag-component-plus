(function(t,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue")):typeof define=="function"&&define.amd?define(["vue"],j):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=j(t.Vue))})(this,function(t){"use strict";const j={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(y){return(A,Ge)=>{const D=t.resolveComponent("el-icon");return y.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(y.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},y.iconObj.attrs)),null,16)):y.iconObj.type==="el"?(t.openBlock(),t.createBlock(D,t.normalizeProps(t.mergeProps({key:1},y.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(y.iconObj.icon)))]),_:1},16)):y.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+y.iconObj.icon]},y.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:y.iconObj.type},y.iconObj.attrs),t.toDisplayString(y.iconObj.icon),17))}}},Lt="",je={class:"content-box"},et=["onMousedown","onMouseenter","onMouseleave"],tt={class:"com-item-box"},ot=["title"],lt={class:"com-item-box-content"},st=["onClick"],rt=["onClick"],nt=["onClick"],at={key:1,class:"com-item-box-content"},it=["onClick"],ct=["onClick"],dt=["onClick"],ht=["onClick"],ut=["onClick"],pt=["onClick"],ft=["onMousedown"],gt=["onMousedown"],yt=["onMousedown"],_t=["onMousedown"],xt=["onMousedown"],wt=["onMousedown"],kt=["onMousedown"],mt=["onMousedown"],Et={key:2,class:"com-empty"},Mt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(y,A){return y>=0}},itemMinWidth:{type:Number,default:15,validator(y,A){return y>=15}},itemMinHeight:{type:Number,default:15,validator(y,A){return y>=15}},xSpace:{type:Number,default:10,validator(y,A){return y>=0}},ySpace:{type:Number,default:null,validator(y,A){return y>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},showAuxiliary:{type:Boolean,default:!1},groupBtnPosMore:{type:Boolean,default:!1}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop","domStart","domReady"],setup(y,{expose:A,emit:Ge}){const D=Ge,v=y,S=l=>{if(typeof l=="object"&&!t.isVNode(l)&&l!==null&&!(l instanceof Date)){let o=l instanceof Array?[]:{};for(let e in l)o[e]=typeof l[e]=="object"&&!t.isVNode(l[e])&&l[e]!==null&&!(l[e]instanceof Date)?S(l[e]):l[e];return o}else return l},bt=(l,o)=>{let e=l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector;for(;l&&!e.call(l,o);)l=l.parentElement;return l},St=(l,o)=>l.classList?l.classList.contains(o):new RegExp("\\s"+o+"\\s").test(" "+l.className+" "),Te=(l,o)=>{let e=[],r=s=>{s.forEach(i=>{St(i,o)&&e.push(i),i.childNodes&&i.childNodes.length>0&&r(i.childNodes)})};return r(l.childNodes),e},_e=(l,o,e=!1)=>Bt(F(l,o,e),o,e),F=(l,o,e=!1)=>l.filter(r=>r[e?"s_x":"x"]<=o[e?"s_x":"x"]&&r[e?"s_x":"x"]+r[e?"s_width":"width"]>o[e?"s_x":"x"]||r[e?"s_x":"x"]>o[e?"s_x":"x"]&&r[e?"s_x":"x"]<o[e?"s_x":"x"]+o[e?"s_width":"width"]),Bt=(l,o,e=!1)=>l.filter(r=>r[e?"s_y":"y"]<=o[e?"s_y":"y"]&&r[e?"s_y":"y"]+r[e?"s_height":"height"]>o[e?"s_y":"y"]||r[e?"s_y":"y"]>o[e?"s_y":"y"]&&r[e?"s_y":"y"]<o[e?"s_y":"y"]+o[e?"s_height":"height"]),q=(l,o=r=>r,e=!1)=>{const r=S(n.value),s=S(l);s.sort((d,k)=>{const u=d[e?"s_y":"y"],f=k[e?"s_y":"y"];if(u!==f)return u-f;{const a=d[e?"s_x":"x"],x=k[e?"s_x":"x"];return a-x}});const i=d=>{_e(o(r,d),d,e).forEach(u=>{u[e?"s_y":"y"]=d[e?"s_y":"y"]+d[e?"s_height":"height"],i(u)})};s.forEach(d=>i(r.filter(k=>k.id===d.id)[0])),r.forEach(d=>{n.value.filter(k=>k.id===d.id)[0][e?"s_y":"y"]=d[e?"s_y":"y"]})},I=l=>{const o=S(l);return delete o.showPop,delete o.showSet,o.groupData?o.groupData.forEach(e=>{delete e.showPop,delete e.showSet,W(e,o),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):o.inGroupId&&(delete o.showPop,delete o.showSet,W(o,n.value.filter(e=>e.id===o.inGroupId)[0])),delete o.btnPosition,delete o.s_width,delete o.s_height,delete o.s_x,delete o.s_y,o},n=t.ref([]),Oe=()=>{v.insertResizeKeys.forEach(l=>{v.excludeResizeKeys.indexOf(l)===-1&&L.value.push(l)})};t.watch(()=>[v.insertResizeKeys,v.excludeResizeKeys],()=>{Oe()});const L=t.ref([]);Oe();const Ye=()=>{n.value.length>0&&n.value.filter(l=>l.isGroup===!0).forEach(l=>{te(l)})},Ae=()=>{v.xSpace!==null&&v.xSpace!==void 0?G.value=v.xSpace/2:G.value=10/2,v.ySpace!==null&&v.ySpace!==void 0&&v.ySpace>=0?H.value=v.ySpace/2:H.value=G.value,Ye()};t.watch(()=>[v.xSpace,v.ySpace],()=>{Ae()});const G=t.ref(0),H=t.ref(0);Ae();const T=t.ref(null);let ee=null;const ae=l=>{ee=l,D("baseWidthInit",ee)},E=t.ref(1),ie=l=>{E.value=l,D("changeScle",E.value)},te=l=>{l.s_width=l.width*E.value,l.s_height=l.height*E.value;const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--com-item-border-width").trim()),r=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const s=l.s_width-2*G.value*E.value-2*e,i=l.s_height-2*H.value*E.value-2*e-(l.groupTit?r:0);l.groupData.forEach(d=>{d.s_width=s*d.groupW,d.s_height=i*d.groupH,d.s_x=s*d.groupX,d.s_y=i*d.groupY})}},Ct=l=>{l.s_x=l.x*E.value,l.s_y=l.y*E.value},Dt=l=>{l.width=l.s_width/E.value,l.height=l.s_height/E.value;const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const r=l.width,s=l.height-(l.groupTit?e:0);l.groupData.forEach(i=>{i.x=r*i.groupX,i.y=s*i.groupY})}},be=l=>{l.x=l.s_x/E.value,l.y=l.s_y/E.value};let X=null,Le=null;const ce=t.ref(0),de=t.ref(null),he=t.ref(null),ue=t.ref(null),pe=t.ref(null),oe=l=>{const o=S(l);if(!v.showAuxiliary||l===null)de.value=null,he.value=null,ue.value=null,pe.value=null;else{const e=getComputedStyle(T.value),r=parseInt(e.getPropertyValue("--auxiliary-width").trim()),s=n.value.filter(a=>a.id!==o.id).map(a=>a.s_y),i=n.value.filter(a=>a.id!==o.id).map(a=>a.s_y+a.s_height),d=[...s,...i];d.sort(),d.filter(a=>a===o.s_y).length>0?de.value=o.s_y:de.value=null,d.filter(a=>a===o.s_y+o.s_height).length>0?he.value=o.s_y+o.s_height-r:he.value=null;const k=n.value.filter(a=>a.id!==o.id).map(a=>a.s_x),u=n.value.filter(a=>a.id!==o.id).map(a=>a.s_x+a.s_width),f=[...k,...u];f.sort(),f.filter(a=>a===o.s_x).length>0?ue.value=o.s_x:ue.value=null,f.filter(a=>a===o.s_x+o.s_width).length>0?pe.value=o.s_x+o.s_width-r:pe.value=null}};let b=null,He=null,Xe=null;const B=t.ref({});let Se=null;const vt=(l,o)=>{clearTimeout(Se),ge(),b=o,B.value=S(n.value[b]),D("dragStart",I(n.value[b])),n.value[b].move=!0,oe(n.value[b]);const e=bt(l.target,".com-item");He=l.clientX-e.offsetLeft,Xe=l.clientY-e.offsetTop,window.addEventListener("mousemove",$e),window.addEventListener("mouseup",Re)},$e=l=>{clearTimeout(Se);const o=l.clientX-He,e=l.clientY-Xe,r=o<=$("left")?$("left"):o>=$("right")?$("right"):o,s=e<=$("top")?$("top"):e>=$("bottom")?$("bottom"):e,i=r-n.value[b].s_x,d=s-n.value[b].s_y;let k="";d>0?k="bottom":d<0?k="top":i>2?k="right":i<-2&&(k="left"),n.value[b].s_x=r,n.value[b].s_y=s,oe(n.value[b]);let u=_e(S(n.value.filter(f=>f.move!==!0)),n.value[b],!0);if(u.length===0)B.value.s_x=r,B.value.s_y=s;else switch(k){case"top":u=u.filter(c=>c.s_y<B.value.s_y);const f=Math.min(...u.map(c=>c.s_y+c.s_height));u.forEach(c=>{Math.abs(c.s_y+c.s_height-f)<5&&(c.s_y=f-c.s_height)});let a=B.value.s_y-s,x=!0,p=[...u];const M=c=>{F(S(n.value.filter(h=>h.move!==!0&&Math.abs(h.s_y+h.s_height-c.s_y)<=3)),c,!0).forEach(h=>{p.findIndex(g=>g.id===h.id)===-1&&(p.push(h),M(h))})};if(u.forEach(c=>{M(c)}),p.sort((c,w)=>{const h=c.s_y,g=w.s_y;return h-g}),(p.length===0||p.filter(c=>c.s_y===0).length>0)&&(x=!1),x){let c=0;p.filter(h=>h.s_y===p[0].s_y).forEach(h=>{F(S(n.value.filter(C=>C.move!==!0&&C.s_y+C.s_height<h.s_y)),h,!0).forEach(C=>{C.s_y+C.s_height>c&&(c=C.s_y+C.s_height)})}),c=p[0].s_y-c,c<a&&(a=c),p.forEach(h=>{h.s_y-=a,n.value.filter(g=>g.id===h.id)[0].s_y=h.s_y}),B.value.s_x=r,B.value.s_y=n.value.filter(h=>h.id===p[p.length-1].id)[0].s_y+n.value.filter(h=>h.id===p[p.length-1].id)[0].s_height}else{let c=0;u.forEach(g=>{const C=F(n.value.filter(N=>N.move!==!0),g,!0).filter(N=>N.s_y>g.s_y+g.s_height);C.length>0&&(c=Math.min(...C.map(N=>N.s_y)))});const w=c===0?0:c-B.value.s_height-(Math.max(...u.map(g=>g.s_y+g.s_height))-Math.min(...u.map(g=>g.s_y))),h=w===0?s+B.value.s_height-Math.min(...u.map(g=>g.s_y)):c-Math.min(...u.map(g=>g.s_y))-(Math.max(...u.map(g=>g.s_y+g.s_height))-Math.min(...u.map(g=>g.s_y)));(w===0||s<=w)&&(u.filter(g=>g.s_y<B.value.s_y).forEach(g=>{g.s_y+=h,n.value.filter(C=>C.id===g.id)[0].s_y=g.s_y}),B.value.s_x=r,B.value.s_y=s,q(n.value,(g,C)=>g.filter(N=>N.move!==!0&&N.id!==C.id),!0))}break;case"bottom":let P=0;u.forEach(c=>{const w=F(n.value.filter(h=>h.move!==!0),c,!0).filter(h=>h.s_y+h.s_height<c.s_y);w.length>0&&(P=Math.max(...w.map(h=>h.s_y+h.s_height)))});const V=P+(Math.max(...u.map(c=>c.s_height+c.s_y))-Math.min(...u.map(c=>c.s_y))),z=Math.min(...u.map(c=>c.s_y))-P;s>=V&&(u.filter(c=>c.s_y>B.value.s_y).forEach(c=>{c.s_y-=z,n.value.filter(h=>h.id===c.id)[0].s_y=c.s_y;const w=_e(n.value.filter(h=>h.move!==!0&&h.id!==c.id),c,!0);w.length>0&&(c.s_y=Math.max(...w.map(h=>h.s_y+h.s_height)),n.value.filter(h=>h.id===c.id)[0].s_y=c.s_y)}),B.value.s_x=r,B.value.s_y=V,q(n.value,(c,w)=>c.filter(h=>h.move!==!0&&h.id!==w.id),!0));break;case"left":case"right":u.sort((c,w)=>{const h=c.s_y,g=w.s_y;return h-g});let K=!0;for(let c=0;c<u.length;c++){if(K){const w=S(n.value);for(let h=0;h<=c;h++){let g=null;const C=F(w.filter(N=>N.move!==!0&&N.s_y<u[h].s_y),u[h],!0);if(C.length===0?g=0:g=Math.max(...C.map(N=>N.s_y+N.s_height)),h===c){if(u[h].s_y-(u[h].s_y+u[h].s_height-s)<g){K=!1;break}}else if(u[h].s_y-u[c].s_height<g){K=!1;break}else w.filter(N=>N.id===u[h].id)[0].s_y-=u[c].s_height}}if(K){u[c].s_y-=u[c].s_y+u[c].s_height-s,n.value.filter(w=>w.id===u[c].id)[0].s_y=u[c].s_y;for(let w=c;w>0;w--)u[c-1].s_y-=u[c].s_height,n.value.filter(h=>h.id===u[c-1].id)[0].s_y=u[c-1].s_y}else u.filter(w=>w.id===u[c].id).forEach(w=>{w.s_y+=n.value[b].s_y+n.value[b].s_height-w.s_y,n.value.filter(h=>h.id===w.id)[0].s_y=w.s_y,q([w],(h,g)=>h.filter(C=>C.move!==!0&&C.id!==g.id),!0)})}B.value.s_x=r;break}n.value.forEach(f=>{be(f)}),Y(!1),D("dragIng",I(n.value[b]))},Re=()=>{window.removeEventListener("mousemove",$e),window.removeEventListener("mouseup",Re),delete n.value[b].move,n.value[b].s_x=B.value.s_x,n.value[b].s_y=B.value.s_y,oe(null),n.value.forEach(l=>{be(l)}),Y(),D("dragEnd",I(n.value[b])),b=null,Se=setTimeout(()=>{Y()},500)},$=l=>{switch(l){case"top":return 0;case"right":return X-G.value*2*E.value-n.value[b].s_width;case"bottom":return 999999999;case"left":return 0}};let _=null,Be="",xe=0,we=0,U=0,J=0,Q=0,Z=0,le=0,ke=0,se=0,me=0;const R=(l,o,e)=>{ge(),_=o,D("resizeStart",I(_)),Be=e,xe=l.clientX,we=l.clientY,U=o.s_width,J=o.s_height,Q=o.s_y,Z=o.s_x,_.drag=!0,oe(_);const r=n.value.filter(f=>f.static===!0&&(f.s_x<o.s_x?f.s_x+f.s_width>=o.s_x:f.s_x<=o.s_x+o.s_width)),s=n.value.filter(f=>f.static===!0&&(f.s_y<o.s_y?f.s_y+f.s_height>=o.s_y:f.s_y<=o.s_y+o.s_height)),i=r.filter(f=>f.s_y+f.s_height<=o.s_y).map(f=>f.s_y+f.s_height);i.length>0?le=Math.max(...i):le=0;const d=r.filter(f=>f.s_y>=o.s_y+o.s_height).map(f=>f.s_y);d.length>0?ke=Math.min(...d):ke=0;const k=s.filter(f=>f.s_x+f.s_width<=o.s_x).map(f=>f.s_x+f.s_width);k.length>0?se=Math.max(...k):se=0;const u=s.filter(f=>f.s_x>=o.s_x+o.s_width).map(f=>f.s_x);u.length>0?me=Math.min(...u):me=0,window.addEventListener("mousemove",We),window.addEventListener("mouseup",Ke)},We=l=>{const o=U+(l.clientX-xe),e=J+(l.clientY-we),r=U-(l.clientX-xe),s=J-(l.clientY-we),i=Q+(l.clientY-we),d=Z+(l.clientX-xe),k=getComputedStyle(T.value),u=parseInt(k.getPropertyValue("--com-item-border-width").trim()),f=parseInt(k.getPropertyValue("--group-tit-height").trim()),a=()=>{if(_.isGroup===!0){const P=_.s_width-2*G.value*E.value-2*u,V=_.s_height-2*H.value*E.value-2*u-(_.groupTit?f:0);_.groupData.forEach(z=>{z.s_width=P*z.groupW,z.s_height=V*z.groupH,z.s_x=P*z.groupX,z.s_y=V*z.groupY})}},x=(v.itemMinWidth+G.value*2)*E.value,p=(v.itemMinHeight+H.value*2)*E.value;switch(Be){case"top-left":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:i,_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,a();break;case"top":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:i,a();break;case"top-right":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:i,_.s_width=o<x?x:o>m("right")?m("right"):o,a();break;case"left":_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,a();break;case"right":_.s_width=o<x?x:o>m("right")?m("right"):o,a();break;case"bottom-left":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,a();break;case"bottom":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,a();break;case"bottom-right":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,_.s_width=o<x?x:o>m("right")?m("right"):o,a();break}Dt(_),oe(_);let M=_e(S(n.value.filter(P=>P.drag!==!0)),_,!0);if(M.length>0){M.sort((P,V)=>{const z=P.s_y,K=V.s_y;return z-K});for(let P=0;P<M.length;P++)M.filter(V=>V.id===M[P].id).forEach(V=>{V.s_y+=_.s_y+_.s_height-V.s_y,n.value.filter(z=>z.id===V.id)[0].s_y=V.s_y,q([V],(z,K)=>z.filter(c=>c.drag!==!0&&c.id!==K.id),!0)})}n.value.forEach(P=>{be(P)}),Y(!1),D("resizeIng",I(_))},Ke=l=>{delete _.drag,Be="",oe(null),window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Ke),Y(),D("resizeEnd",I(_)),_=null},m=l=>{switch(l){case"top":return Q+J-le;case"left":return Z+U-se;case"right":return(me>0?me:X-G.value*2*E.value)-Z;case"bottom":return ke>0?ke-Q:999999999}},Y=(l=!0)=>{l===!0&&(q(n.value,(e,r)=>e.filter(s=>s.id!==r.id)),Pt(),n.value.forEach(e=>{Ct(e)}),zt());const o=n.value.map(e=>e.y+e.height);o.length>0?ce.value=Math.max(...o):ce.value=0},Pt=()=>{const l=S(n.value).sort((o,e)=>{const r=o.y,s=e.y;return r-s});for(let o=0;o<l.length;o++){const e=F(l,l[o]).filter(r=>r.y+r.height<=l[o].y);e.length>0?l[o].y=Math.max(...e.map(r=>r.y+r.height)):l[o].y=0}l.forEach(o=>{n.value.filter(e=>e.id===o.id)[0].y=o.y})},zt=()=>{const l=n.value.filter(o=>o.isGroup===!0);if(l.length>0){const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--setting-icon-group-width").trim()),r=parseInt(o.getPropertyValue("--setting-icon-group-height").trim());l.forEach(s=>{G.value+s.s_x+s.s_width+e>X?G.value+s.s_x-e<0?v.groupBtnPosMore?H.value+s.s_y-r<0?s.btnPosition="bottom":s.btnPosition="top":s.btnPosition="center":s.btnPosition="left":s.btnPosition="right"})}};t.onMounted(()=>{Fe.observe(T.value)});const Fe=new ResizeObserver(l=>{Vt(X===l[0].borderBoxSize[0].inlineSize?null:l[0].borderBoxSize[0].inlineSize,Le===l[0].borderBoxSize[0].blockSize?null:l[0].borderBoxSize[0].blockSize)}),fe=t.ref("");let Ce=0,De=0,ve=null,Pe=!1;const Nt=(l=[],o=null)=>{clearInterval(ve),fe.value=new Date().getTime()+"",Ce=0,De=0,l.forEach(e=>{Ce+=1,e.isGroup===!0&&(De+=e.groupData.length)}),Ze(),D("domStart"),n.value=S(l),n.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)ye(e.id);else{const r=Me(e.groupData,e);Ee(r)}}),Pe=!0,t.nextTick(()=>{const e=T.value.getBoundingClientRect();o!=null?(ae(o),ie(e.width/o)):(ae(n.value.length>0?e.width:null),ie(1)),n.value.forEach(r=>{te(r)}),Y(),ve=setInterval(()=>{Te(T.value,fe.value+"p").length===Ce&&Te(T.value,fe.value+"c").length===De&&(clearInterval(ve),D("domReady"))},10),setTimeout(()=>{Pe=!1},500)})},It=l=>{l.showSet=!0},ze=l=>{const o=n.value.filter(e=>e.id===l);if(o.length===1)delete o[0].showSet;else try{}catch{}},qe=(l,o,e)=>{const r=o.map(d=>d.y),s=Math.max(...r),i=o.filter(d=>d.y+d.height>s);i.sort((d,k)=>{const u=d.x,f=k.x;return u-f});for(let d=0;d<i.length;d++){if(d===0&&i[d].x>=l.width){l.y=s,l.x=0;break}if(i.length>1&&d!==i.length-1&&i[d].x+i[d].width+l.width<=i[d+1].x){l.y=s,l.x=i[d].x+i[d].width;break}if(d===i.length-1&&i[d].x+i[d].width+l.width<=e){l.y=s,l.x=i[d].x+i[d].width;break}}if(l.y==null){l.x=0;const d=o.map(k=>k.y+k.height);l.y=Math.max(...d)}},re=(l,o=null,e=!1)=>{const r=S(l),s=n.value.filter(i=>i.id===o);if(r.id||(r.id=new Date().getTime()+""),o&&s.length!==1)try{}catch{}finally{return}if(e!==!0&&(delete r.x,delete r.y,o?(s[0].groupData.forEach(i=>{W(i,s[0])}),qe(r,s[0].groupData,s[0].width)):n.value.length===0?(r.x=0,r.y=0):qe(r,n.value,(ee||X)-G.value*2)),o){s[0].groupData.push(r);const i=Me(s[0].groupData,s[0]);Ee(i),q([i],(d,k)=>d.filter(u=>u.id!==k.id))}else n.value.length===0&&ae(X),te(r),n.value.push(r);Y()},Ne=(l,o=null,e=null)=>{let r=null;const s=n.value.filter(i=>i.id===o);if(o?s.length===1&&(r=S(s[0].groupData.filter(i=>i.id===l)[0])):r=S(n.value.filter(i=>i.id===l)[0]),r)return r.id=e||new Date().getTime()+"",o?(W(r,s[0]),re(r,o)):re(r),I(o?n.value.filter(i=>i.id===o)[0].groupData.filter(i=>i.id===r.id)[0]:n.value.filter(i=>i.id===r.id)[0]);try{}catch{}finally{return null}},ne=(l,o=null)=>{let e=-1;const r=n.value.filter(s=>s.id===o);if(o?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===l)):e=n.value.findIndex(s=>s.id===l),e!==-1){if(o)if(r[0].groupData.splice(e,1),r[0].groupData.length===1)ye(o);else{r[0].groupData.forEach(i=>{W(i,r[0])});const s=Me(r[0].groupData,r[0]);Ee(s)}else n.value.splice(e,1),n.value.length===0&&(ae(null),ie(1));Y()}else try{}catch{}},Ee=l=>{if(l.id){const o=S(l);delete o.showPop,delete o.showSet,delete o.btnPosition,o.groupData&&o.groupData.forEach(s=>{delete s.showPop,delete s.showSet});let e=-1;const r=n.value.filter(s=>s.id===o.inGroupId);if(o.inGroupId?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===o.id)):e=n.value.findIndex(s=>s.id===o.id),e!==-1)o.inGroupId?(r[0].groupData[e]=o,te(r[0])):(n.value[e]=o,te(n.value[e])),Y();else try{}catch{}}else try{}catch{}},Vt=(l,o)=>{l!==null&&(X=l,Pe||(ie(ee&&X?l/ee:1),n.value.forEach(e=>{te(e)}),Y())),o!==null&&(Le=o)},Ue=l=>{l.showPop||(n.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(e=>{delete e.showPop})}),D("openSetMenu",I(l)),l.showPop=!0,window.addEventListener("click",ge))},ge=()=>{n.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(o=>{delete o.showPop})}),window.removeEventListener("click",ge)},O=t.ref(!1),Je=l=>{const o=n.value.findIndex(e=>e.id===l);if(o!==-1)n.value[o].checked=!0,n.value[o].checkDis=!0,O.value=!0,D("showGroup",O.value);else try{}catch{}},Ie=()=>{O.value=!1,n.value.forEach(l=>{delete l.checked,delete l.checkDis,l.groupData&&l.groupData.forEach(o=>{delete o.checked,delete o.checkDis})}),D("showGroup",O.value)},Gt=l=>{l.checked=!l.checked,D("updateChecked",n.value.filter(o=>o.checked).length)},Me=(l,o)=>{const e=S(l),r=S(o);e.sort((a,x)=>{const p=a.x,M=x.x;return p-M});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].x>0){const x=e[a].x;for(let p=a;p<e.length;p++)e[p].x-=x}if(e[a+1].x>e[a].x+e[a].width){const x=S(e.slice(0,a+1));if(e[a+1].x>Math.max(...x.map(p=>p.x+p.width))){const p=e[a+1].x-Math.max(...x.map(M=>M.x+M.width));for(let M=a+1;M<e.length;M++)e[M].x-=p}}}e.sort((a,x)=>{const p=a.y,M=x.y;return p-M});for(let a=0;a<e.length-1;a++){if(a===0&&e[a].y>0){const x=e[a].y;for(let p=a;p<e.length;p++)e[p].y-=x}if(e[a+1].y>e[a].y+e[a].height){const x=S(e.slice(0,a+1));if(e[a+1].y>Math.max(...x.map(p=>p.y+p.height))){const p=e[a+1].y-Math.max(...x.map(M=>M.y+M.height));for(let M=a+1;M<e.length;M++)e[M].y-=p}}}const s=e.map(a=>a.x+a.width),i=Math.max(...s),d=e.map(a=>a.y+a.height),k=Math.max(...d);e.forEach(a=>{a.inGroupId||(a.inGroupId=r.id),a.groupW=a.width/i,a.groupH=a.height/k,a.groupX=a.x/i,a.groupY=a.y/k,a.isObstacle=a.x+a.width===i&&a.y===0,delete a.width,delete a.height});const u=getComputedStyle(T.value),f=parseInt(u.getPropertyValue("--group-tit-height").trim());return r.width=i,r.height=k+(r.groupTit?f:0),r.groupData=[...e],r},W=(l,o)=>{const e=getComputedStyle(T.value),r=parseInt(e.getPropertyValue("--group-tit-height").trim());l.width=o.width*l.groupW,l.height=(o.height-(o.groupTit?r:0))*l.groupH},Tt=()=>{t.nextTick(()=>{Ye()})},Ot=()=>{const l=n.value.filter(o=>o.checked);if(l.length>1){const o={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=Me(l,o);return e.groupData.forEach(r=>{ne(r.id)}),re(e),Ie(),I(n.value.filter(r=>r.id===e.id)[0])}else return Ie(),null},Qe=(l,o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){const r=e.groupData.filter(s=>s.id===l)[0];if(r)return e.groupData.length===2?ye(o):(W(r,e),delete r.inGroupId,delete r.groupW,delete r.groupH,delete r.groupX,delete r.groupY,delete r.isObstacle,ne(r.id,e.id),re(r),[I(n.value.filter(s=>s.id===l)[0])]);try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ye=l=>{const o=n.value.filter(e=>e.id===l)[0];if(o){let e=[];o.groupData.forEach(s=>{W(s,o),s.x+=o.x,s.y+=o.y,delete s.inGroupId,delete s.groupW,delete s.groupH,delete s.groupX,delete s.groupY,delete s.isObstacle,e.push(s.id),re(s,null,!0)}),ne(o.id);let r=[];return e.forEach(s=>{r.push(I(n.value.filter(i=>i.id===s)[0]))}),r}else try{}catch{}finally{return[]}},Yt=(l="",o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){if(!e.groupTit||!l){const r=getComputedStyle(T.value),s=parseInt(r.getPropertyValue("--group-tit-height").trim());e.groupTit&&!l&&(e.height-=s,e.s_height-=s*E.value),!e.groupTit&&l&&(e.height+=s,e.s_height+=s*E.value)}e.groupTit=l,q([e],(r,s)=>r.filter(i=>i.id!==s.id)),Y()}else try{}catch{}},Ze=()=>{n.value=[],ae(null),ie(1),ce.value=0},At=()=>new Promise((l,o)=>{n.value.forEach(r=>{delete r.showPop,delete r.showSet,r.groupData&&r.groupData.forEach(s=>{delete s.showPop,delete s.showSet})});const e=S(n.value);e.forEach(r=>{r.isGroup===!0&&r.groupData.forEach(s=>{W(s,r),delete s.s_width,delete s.s_height,delete s.s_x,delete s.s_y}),delete r.btnPosition,delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y}),l({data:e,width:ee})});return t.onBeforeUnmount(()=>{Fe.unobserve(T.value),window.removeEventListener("click",ge)}),A({init:Nt,addItem:re,copyItem:Ne,deleteItem:ne,updateItem:Ee,hideGroupSet:ze,openGroup:Je,closeGroup:Ie,changeGroupBorder:Tt,addGroup:Ot,removeGroupItem:Qe,removeGroup:ye,changeGroupTit:Yt,resetData:Ze,getData:At}),(l,o)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(E),"--com-x-space":t.unref(G)+"px","--com-y-space":t.unref(H)+"px"}),ref_key:"pageRef",ref:T},[t.createElementVNode("div",je,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop||e.isGroup&&e.groupData.filter(s=>s.showPop).length>0?"on-top":"",t.unref(fe)+"p"]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:r},[t.createElementVNode("div",{class:t.normalizeClass(["com-item-inner",y.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?"":"can-drag",y.seeModel?"no-hover":""]),onMousedown:t.withModifiers(s=>y.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?null:vt(s,r),["prevent"]),onMouseenter:s=>y.seeModel||t.unref(O)||t.unref(b)||t.unref(_)||!e.isGroup?null:It(e),onMouseleave:s=>y.seeModel||t.unref(O)||t.unref(b)||t.unref(_)||!e.isGroup?null:ze(e.id)},[t.createElementVNode("div",tt,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,ot)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(s,i)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",s.isObstacle?"is-obstacle":"",t.unref(fe)+"c"]),style:t.normalizeStyle({width:s.s_width+"px",height:s.s_height+"px",top:s.s_y+"px",left:s.s_x+"px"}),key:i},[t.createElementVNode("div",lt,[t.renderSlot(l.$slots,"item",{data:s},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_width*100)/100)+","+t.toDisplayString(Math.round(s.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_x*100)/100)+","+t.toDisplayString(Math.round(s.s_y*100)/100),1)])]),!y.seeModel&&!t.unref(O)&&t.unref(b)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:s.showPop?"flex":"none"}),onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:y.settingIcon,onClick:t.withModifiers(d=>Ue(s),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),s.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.renderSlot(l.$slots,"setPopNormal",{data:I(s)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Qe(s.id,s.inGroupId)},"移出组合",8,st),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Ne(s.id,s.inGroupId)},"复制",8,rt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>ne(s.id,s.inGroupId)},"删除",8,nt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",at,[t.renderSlot(l.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_width*100)/100)+","+t.toDisplayString(Math.round(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_x*100)/100)+","+t.toDisplayString(Math.round(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(O)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:s=>e.checkDis?null:Gt(e)},null,10,it)):t.createCommentVNode("",!0),!y.seeModel&&!t.unref(O)&&t.unref(b)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="top"?"only-g t":e.btnPosition==="bottom"?"only-g b":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:y.settingIcon,onClick:t.withModifiers(s=>Ue(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="top"?"special t":e.btnPosition==="bottom"?"special b":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(l.$slots,"setPopSpecial",{key:0,data:I(e)},()=>[y.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>{ze(e.id),D("showTitPop",e.groupTit,e.id)}}," 设置组合标题",8,ct)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>ye(e.id)},"解除组合",8,dt)]):t.renderSlot(l.$slots,"setPopNormal",{key:1,data:I(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>Je(e.id)},"组合",8,ht)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>Ne(e.id)},"复制",8,ut),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>ne(e.id)},"删除",8,pt)])],34)):t.createCommentVNode("",!0)]),!y.seeModel&&!t.unref(O)&&!e.showPop&&!(e.isGroup&&e.groupData.filter(s=>s.showPop).length>0)&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(L).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(s=>R(s,e,"top-left"),["prevent","stop"])},null,40,ft)):t.createCommentVNode("",!0),t.unref(L).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(s=>R(s,e,"top"),["prevent","stop"])},null,40,gt)):t.createCommentVNode("",!0),t.unref(L).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(s=>R(s,e,"top-right"),["prevent","stop"])},null,40,yt)):t.createCommentVNode("",!0),t.unref(L).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(s=>R(s,e,"left"),["prevent","stop"])},null,40,_t)):t.createCommentVNode("",!0),t.unref(L).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(s=>R(s,e,"right"),["prevent","stop"])},null,40,xt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(s=>R(s,e,"bottom-left"),["prevent","stop"])},null,40,wt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(s=>R(s,e,"bottom"),["prevent","stop"])},null,40,kt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(s=>R(s,e,"bottom-right"),["prevent","stop"])},null,40,mt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],42,et)],6))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.s_width-t.unref(G)*2*t.unref(E)+"px",height:e.s_height-t.unref(H)*2*t.unref(E)+"px",top:e.s_y+t.unref(H)*t.unref(E)+"px",left:e.s_x+t.unref(G)*t.unref(E)+"px"}),key:r},null,6))),128)),t.unref(b)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(B).s_width+"px",height:t.unref(B).s_height+"px",top:t.unref(B).s_y+"px",left:t.unref(B).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ce)>0?+(t.unref(ce)*t.unref(E)+(y.seeModel?y.seeModelMinBg:220)):0)+"px"})},null,4),y.showAuxiliary?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(de)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(de)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(he)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(he)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(ue)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(ue)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(pe)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(pe)+"px"})},null,4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0),t.unref(n).length===0?(t.openBlock(),t.createElementBlock("div",Et,[t.renderSlot(l.$slots,"empty",{},()=>[o[0]||(o[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)])],4))}}],Ve={install(y){Mt.forEach(A=>{y.component("vueDragComponentPlus",A)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(Ve),Ve});
