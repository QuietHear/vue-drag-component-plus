(function(t,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue")):typeof define=="function"&&define.amd?define(["vue"],j):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=j(t.Vue))})(this,function(t){"use strict";const j={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(g){return(Y,Ge)=>{const C=t.resolveComponent("el-icon");return g.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(g.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},g.iconObj.attrs)),null,16)):g.iconObj.type==="el"?(t.openBlock(),t.createBlock(C,t.normalizeProps(t.mergeProps({key:1},g.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(g.iconObj.icon)))]),_:1},16)):g.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+g.iconObj.icon]},g.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:g.iconObj.type},g.iconObj.attrs),t.toDisplayString(g.iconObj.icon),17))}}},Rt="",je={class:"content-box"},et=["onMousedown","onMouseenter","onMouseleave"],tt={class:"com-item-box"},ot=["title"],lt={class:"com-item-box-content"},rt=["onClick"],st=["onClick"],nt=["onClick"],at={key:1,class:"com-item-box-content"},it=["onClick"],ct=["onClick"],dt=["onClick"],ht=["onClick"],ut=["onClick"],ft=["onClick"],pt=["onMousedown"],gt=["onMousedown"],yt=["onMousedown"],_t=["onMousedown"],xt=["onMousedown"],wt=["onMousedown"],kt=["onMousedown"],mt=["onMousedown"],Et={key:2,class:"com-empty"},bt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(g,Y){return g>=0}},itemMinWidth:{type:Number,default:15,validator(g,Y){return g>=15}},itemMinHeight:{type:Number,default:15,validator(g,Y){return g>=15}},xSpace:{type:Number,default:10,validator(g,Y){return g>=0}},ySpace:{type:Number,default:null,validator(g,Y){return g>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},showAuxiliary:{type:Boolean,default:!1},groupBtnPosMore:{type:Boolean,default:!1},beforeAddGroup:{type:Function,default:g=>g},beforeRemoveGroup:{type:Function,default:g=>g}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop","domStart","domReady"],setup(g,{expose:Y,emit:Ge}){const C=Ge,v=g,M=o=>{if(typeof o=="object"&&!t.isVNode(o)&&o!==null&&!(o instanceof Date)){let l=o instanceof Array?[]:{};for(let e in o)l[e]=typeof o[e]=="object"&&!t.isVNode(o[e])&&o[e]!==null&&!(o[e]instanceof Date)?M(o[e]):o[e];return l}else return o},Mt=(o,l)=>{let e=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.msMatchesSelector;for(;o&&!e.call(o,l);)o=o.parentElement;return o},St=(o,l)=>o.classList?o.classList.contains(l):new RegExp("\\s"+l+"\\s").test(" "+o.className+" "),Te=(o,l)=>{let e=[],s=r=>{r.forEach(n=>{St(n,l)&&e.push(n),n.childNodes&&n.childNodes.length>0&&s(n.childNodes)})};return s(o.childNodes),e},_e=(o,l,e=!1)=>Bt(K(o,l,e),l,e),K=(o,l,e=!1)=>o.filter(s=>s[e?"s_x":"x"]<=l[e?"s_x":"x"]&&s[e?"s_x":"x"]+s[e?"s_width":"width"]>l[e?"s_x":"x"]||s[e?"s_x":"x"]>l[e?"s_x":"x"]&&s[e?"s_x":"x"]<l[e?"s_x":"x"]+l[e?"s_width":"width"]),Bt=(o,l,e=!1)=>o.filter(s=>s[e?"s_y":"y"]<=l[e?"s_y":"y"]&&s[e?"s_y":"y"]+s[e?"s_height":"height"]>l[e?"s_y":"y"]||s[e?"s_y":"y"]>l[e?"s_y":"y"]&&s[e?"s_y":"y"]<l[e?"s_y":"y"]+l[e?"s_height":"height"]),q=(o,l=s=>s,e=!1)=>{const s=M(a.value),r=M(o);r.sort((c,y)=>{const h=c[e?"s_y":"y"],p=y[e?"s_y":"y"];if(h!==p)return h-p;{const i=c[e?"s_x":"x"],w=y[e?"s_x":"x"];return i-w}});const n=c=>{_e(l(s,c),c,e).forEach(h=>{h[e?"s_y":"y"]=c[e?"s_y":"y"]+c[e?"s_height":"height"],n(h)})};r.forEach(c=>n(s.filter(y=>y.id===c.id)[0])),s.forEach(c=>{a.value.filter(y=>y.id===c.id)[0][e?"s_y":"y"]=c[e?"s_y":"y"]})},N=o=>{const l=M(o);return delete l.showPop,delete l.showSet,l.groupData?l.groupData.forEach(e=>{delete e.showPop,delete e.showSet,W(e,l),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):l.inGroupId&&(delete l.showPop,delete l.showSet,W(l,a.value.filter(e=>e.id===l.inGroupId)[0])),delete l.btnPosition,delete l.s_width,delete l.s_height,delete l.s_x,delete l.s_y,l},a=t.ref([]),Oe=()=>{v.insertResizeKeys.forEach(o=>{v.excludeResizeKeys.indexOf(o)===-1&&L.value.push(o)})};t.watch(()=>[v.insertResizeKeys,v.excludeResizeKeys],()=>{Oe()});const L=t.ref([]);Oe();const Ae=()=>{a.value.length>0&&a.value.filter(o=>o.isGroup===!0).forEach(o=>{te(o)})},Ye=()=>{v.xSpace!==null&&v.xSpace!==void 0?G.value=v.xSpace/2:G.value=10/2,v.ySpace!==null&&v.ySpace!==void 0&&v.ySpace>=0?R.value=v.ySpace/2:R.value=G.value,Ae()};t.watch(()=>[v.xSpace,v.ySpace],()=>{Ye()});const G=t.ref(0),R=t.ref(0);Ye();const T=t.ref(null);let ee=null;const ae=o=>{ee=o,C("baseWidthInit",ee)},E=t.ref(1),ie=o=>{E.value=o,C("changeScle",E.value)},te=o=>{o.s_width=o.width*E.value,o.s_height=o.height*E.value;const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--com-item-border-width").trim()),s=parseInt(l.getPropertyValue("--group-tit-height").trim());if(o.isGroup===!0){const r=o.s_width-2*G.value*E.value-2*e,n=o.s_height-2*R.value*E.value-2*e-(o.groupTit?s:0);o.groupData.forEach(c=>{c.s_width=r*c.groupW,c.s_height=n*c.groupH,c.s_x=r*c.groupX,c.s_y=n*c.groupY})}},Dt=o=>{o.s_x=o.x*E.value,o.s_y=o.y*E.value},vt=o=>{o.width=o.s_width/E.value,o.height=o.s_height/E.value;const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--group-tit-height").trim());if(o.isGroup===!0){const s=o.width,r=o.height-(o.groupTit?e:0);o.groupData.forEach(n=>{n.x=s*n.groupX,n.y=r*n.groupY})}},Me=o=>{o.x=o.s_x/E.value,o.y=o.s_y/E.value};let H=null,Le=null;const ce=t.ref(0),de=t.ref(null),he=t.ref(null),ue=t.ref(null),fe=t.ref(null),oe=o=>{const l=M(o);if(!v.showAuxiliary||o===null)de.value=null,he.value=null,ue.value=null,fe.value=null;else{const e=getComputedStyle(T.value),s=parseInt(e.getPropertyValue("--auxiliary-width").trim()),r=a.value.filter(i=>i.id!==l.id).map(i=>i.s_y),n=a.value.filter(i=>i.id!==l.id).map(i=>i.s_y+i.s_height),c=[...r,...n];c.sort(),c.filter(i=>i===l.s_y).length>0?de.value=l.s_y:de.value=null,c.filter(i=>i===l.s_y+l.s_height).length>0?he.value=l.s_y+l.s_height-s:he.value=null;const y=a.value.filter(i=>i.id!==l.id).map(i=>i.s_x),h=a.value.filter(i=>i.id!==l.id).map(i=>i.s_x+i.s_width),p=[...y,...h];p.sort(),p.filter(i=>i===l.s_x).length>0?ue.value=l.s_x:ue.value=null,p.filter(i=>i===l.s_x+l.s_width).length>0?fe.value=l.s_x+l.s_width-s:fe.value=null}};let S=null,Re=null,He=null;const B=t.ref({});let Se=null;const Ct=(o,l)=>{clearTimeout(Se),ge(),S=l,B.value=M(a.value[S]),C("dragStart",N(a.value[S])),a.value[S].move=!0,oe(a.value[S]);const e=Mt(o.target,".com-item");Re=o.clientX-e.offsetLeft,He=o.clientY-e.offsetTop,window.addEventListener("mousemove",Xe),window.addEventListener("mouseup",$e)},Xe=o=>{clearTimeout(Se);const l=o.clientX-Re,e=o.clientY-He,s=l<=X("left")?X("left"):l>=X("right")?X("right"):l,r=e<=X("top")?X("top"):e>=X("bottom")?X("bottom"):e,n=s-a.value[S].s_x,c=r-a.value[S].s_y;let y="";c>0?y="bottom":c<0?y="top":n>2?y="right":n<-2&&(y="left"),a.value[S].s_x=s,a.value[S].s_y=r,oe(a.value[S]);let h=_e(M(a.value.filter(p=>p.move!==!0)),a.value[S],!0);if(h.length===0)B.value.s_x=s,B.value.s_y=r;else switch(y){case"top":h=h.filter(d=>d.s_y<B.value.s_y);const p=Math.min(...h.map(d=>d.s_y+d.s_height));h.forEach(d=>{Math.abs(d.s_y+d.s_height-p)<5&&(d.s_y=p-d.s_height)});let i=B.value.s_y-r,w=!0,f=[...h];const b=d=>{K(M(a.value.filter(u=>u.move!==!0&&Math.abs(u.s_y+u.s_height-d.s_y)<=3)),d,!0).forEach(u=>{f.findIndex(_=>_.id===u.id)===-1&&(f.push(u),b(u))})};if(h.forEach(d=>{b(d)}),f.sort((d,k)=>{const u=d.s_y,_=k.s_y;return u-_}),(f.length===0||f.filter(d=>d.s_y===0).length>0)&&(w=!1),w){let d=0;f.filter(u=>u.s_y===f[0].s_y).forEach(u=>{K(M(a.value.filter(D=>D.move!==!0&&D.s_y+D.s_height<u.s_y)),u,!0).forEach(D=>{D.s_y+D.s_height>d&&(d=D.s_y+D.s_height)})}),d=f[0].s_y-d,d<i&&(i=d),f.forEach(u=>{u.s_y-=i,a.value.filter(_=>_.id===u.id)[0].s_y=u.s_y}),B.value.s_x=s,B.value.s_y=a.value.filter(u=>u.id===f[f.length-1].id)[0].s_y+a.value.filter(u=>u.id===f[f.length-1].id)[0].s_height}else{let d=0;h.forEach(_=>{const D=K(a.value.filter(I=>I.move!==!0),_,!0).filter(I=>I.s_y>_.s_y+_.s_height);D.length>0&&(d=Math.min(...D.map(I=>I.s_y)))});const k=d===0?0:d-B.value.s_height-(Math.max(...h.map(_=>_.s_y+_.s_height))-Math.min(...h.map(_=>_.s_y))),u=k===0?r+B.value.s_height-Math.min(...h.map(_=>_.s_y)):d-Math.min(...h.map(_=>_.s_y))-(Math.max(...h.map(_=>_.s_y+_.s_height))-Math.min(...h.map(_=>_.s_y)));(k===0||r<=k)&&(h.filter(_=>_.s_y<B.value.s_y).forEach(_=>{_.s_y+=u,a.value.filter(D=>D.id===_.id)[0].s_y=_.s_y}),B.value.s_x=s,B.value.s_y=r,q(a.value,(_,D)=>_.filter(I=>I.move!==!0&&I.id!==D.id),!0))}break;case"bottom":let P=0;h.forEach(d=>{const k=K(a.value.filter(u=>u.move!==!0),d,!0).filter(u=>u.s_y+u.s_height<d.s_y);k.length>0&&(P=Math.max(...k.map(u=>u.s_y+u.s_height)))});const V=P+(Math.max(...h.map(d=>d.s_height+d.s_y))-Math.min(...h.map(d=>d.s_y))),z=Math.min(...h.map(d=>d.s_y))-P;r>=V&&(h.filter(d=>d.s_y>B.value.s_y).forEach(d=>{d.s_y-=z,a.value.filter(u=>u.id===d.id)[0].s_y=d.s_y;const k=_e(a.value.filter(u=>u.move!==!0&&u.id!==d.id),d,!0);k.length>0&&(d.s_y=Math.max(...k.map(u=>u.s_y+u.s_height)),a.value.filter(u=>u.id===d.id)[0].s_y=d.s_y)}),B.value.s_x=s,B.value.s_y=V,q(a.value,(d,k)=>d.filter(u=>u.move!==!0&&u.id!==k.id),!0));break;case"left":case"right":h.sort((d,k)=>{const u=d.s_y,_=k.s_y;return u-_});let F=!0;for(let d=0;d<h.length;d++){if(F){const k=M(a.value);for(let u=0;u<=d;u++){let _=null;const D=K(k.filter(I=>I.move!==!0&&I.s_y<h[u].s_y),h[u],!0);if(D.length===0?_=0:_=Math.max(...D.map(I=>I.s_y+I.s_height)),u===d){if(h[u].s_y-(h[u].s_y+h[u].s_height-r)<_){F=!1;break}}else if(h[u].s_y-h[d].s_height<_){F=!1;break}else k.filter(I=>I.id===h[u].id)[0].s_y-=h[d].s_height}}if(F){h[d].s_y-=h[d].s_y+h[d].s_height-r,a.value.filter(k=>k.id===h[d].id)[0].s_y=h[d].s_y;for(let k=d;k>0;k--)h[d-1].s_y-=h[d].s_height,a.value.filter(u=>u.id===h[d-1].id)[0].s_y=h[d-1].s_y}else h.filter(k=>k.id===h[d].id).forEach(k=>{k.s_y+=a.value[S].s_y+a.value[S].s_height-k.s_y,a.value.filter(u=>u.id===k.id)[0].s_y=k.s_y,q([k],(u,_)=>u.filter(D=>D.move!==!0&&D.id!==_.id),!0)})}B.value.s_x=s;break}a.value.forEach(p=>{Me(p)}),A(!1),C("dragIng",N(a.value[S]))},$e=()=>{window.removeEventListener("mousemove",Xe),window.removeEventListener("mouseup",$e),delete a.value[S].move,a.value[S].s_x=B.value.s_x,a.value[S].s_y=B.value.s_y,oe(null),a.value.forEach(o=>{Me(o)}),A(),C("dragEnd",N(a.value[S])),S=null,Se=setTimeout(()=>{A()},500)},X=o=>{switch(o){case"top":return 0;case"right":return H-G.value*2*E.value-a.value[S].s_width;case"bottom":return 999999999;case"left":return 0}};let x=null,Be="",xe=0,we=0,U=0,J=0,Q=0,Z=0,le=0,ke=0,re=0,me=0;const $=(o,l,e)=>{ge(),x=l,C("resizeStart",N(x)),Be=e,xe=o.clientX,we=o.clientY,U=l.s_width,J=l.s_height,Q=l.s_y,Z=l.s_x,x.drag=!0,oe(x);const s=a.value.filter(p=>p.static===!0&&(p.s_x<l.s_x?p.s_x+p.s_width>=l.s_x:p.s_x<=l.s_x+l.s_width)),r=a.value.filter(p=>p.static===!0&&(p.s_y<l.s_y?p.s_y+p.s_height>=l.s_y:p.s_y<=l.s_y+l.s_height)),n=s.filter(p=>p.s_y+p.s_height<=l.s_y).map(p=>p.s_y+p.s_height);n.length>0?le=Math.max(...n):le=0;const c=s.filter(p=>p.s_y>=l.s_y+l.s_height).map(p=>p.s_y);c.length>0?ke=Math.min(...c):ke=0;const y=r.filter(p=>p.s_x+p.s_width<=l.s_x).map(p=>p.s_x+p.s_width);y.length>0?re=Math.max(...y):re=0;const h=r.filter(p=>p.s_x>=l.s_x+l.s_width).map(p=>p.s_x);h.length>0?me=Math.min(...h):me=0,window.addEventListener("mousemove",We),window.addEventListener("mouseup",Fe)},We=o=>{const l=U+(o.clientX-xe),e=J+(o.clientY-we),s=U-(o.clientX-xe),r=J-(o.clientY-we),n=Q+(o.clientY-we),c=Z+(o.clientX-xe),y=getComputedStyle(T.value),h=parseInt(y.getPropertyValue("--com-item-border-width").trim()),p=parseInt(y.getPropertyValue("--group-tit-height").trim()),i=()=>{if(x.isGroup===!0){const P=x.s_width-2*G.value*E.value-2*h,V=x.s_height-2*R.value*E.value-2*h-(x.groupTit?p:0);x.groupData.forEach(z=>{z.s_width=P*z.groupW,z.s_height=V*z.groupH,z.s_x=P*z.groupX,z.s_y=V*z.groupY})}},w=(v.itemMinWidth+G.value*2)*E.value,f=(v.itemMinHeight+R.value*2)*E.value;switch(Be){case"top-left":x.s_height=r<f?f:r>m("top")?m("top"):r,x.s_y=r<f?Q+J-f:r>m("top")?le:n,x.s_width=s<w?w:s>m("left")?m("left"):s,x.s_x=s<w?Z+U-w:s>m("left")?re:c,i();break;case"top":x.s_height=r<f?f:r>m("top")?m("top"):r,x.s_y=r<f?Q+J-f:r>m("top")?le:n,i();break;case"top-right":x.s_height=r<f?f:r>m("top")?m("top"):r,x.s_y=r<f?Q+J-f:r>m("top")?le:n,x.s_width=l<w?w:l>m("right")?m("right"):l,i();break;case"left":x.s_width=s<w?w:s>m("left")?m("left"):s,x.s_x=s<w?Z+U-w:s>m("left")?re:c,i();break;case"right":x.s_width=l<w?w:l>m("right")?m("right"):l,i();break;case"bottom-left":x.s_height=e<f?f:e>m("bottom")?m("bottom"):e,x.s_width=s<w?w:s>m("left")?m("left"):s,x.s_x=s<w?Z+U-w:s>m("left")?re:c,i();break;case"bottom":x.s_height=e<f?f:e>m("bottom")?m("bottom"):e,i();break;case"bottom-right":x.s_height=e<f?f:e>m("bottom")?m("bottom"):e,x.s_width=l<w?w:l>m("right")?m("right"):l,i();break}vt(x),oe(x);let b=_e(M(a.value.filter(P=>P.drag!==!0)),x,!0);if(b.length>0){b.sort((P,V)=>{const z=P.s_y,F=V.s_y;return z-F});for(let P=0;P<b.length;P++)b.filter(V=>V.id===b[P].id).forEach(V=>{V.s_y+=x.s_y+x.s_height-V.s_y,a.value.filter(z=>z.id===V.id)[0].s_y=V.s_y,q([V],(z,F)=>z.filter(d=>d.drag!==!0&&d.id!==F.id),!0)})}a.value.forEach(P=>{Me(P)}),A(!1),C("resizeIng",N(x))},Fe=o=>{delete x.drag,Be="",oe(null),window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",Fe),A(),C("resizeEnd",N(x)),x=null},m=o=>{switch(o){case"top":return Q+J-le;case"left":return Z+U-re;case"right":return(me>0?me:H-G.value*2*E.value)-Z;case"bottom":return ke>0?ke-Q:999999999}},A=(o=!0)=>{o===!0&&(q(a.value,(e,s)=>e.filter(r=>r.id!==s.id)),Pt(),a.value.forEach(e=>{Dt(e)}),zt());const l=a.value.map(e=>e.y+e.height);l.length>0?ce.value=Math.max(...l):ce.value=0},Pt=()=>{const o=M(a.value).sort((l,e)=>{const s=l.y,r=e.y;return s-r});for(let l=0;l<o.length;l++){const e=K(o,o[l]).filter(s=>s.y+s.height<=o[l].y);e.length>0?o[l].y=Math.max(...e.map(s=>s.y+s.height)):o[l].y=0}o.forEach(l=>{a.value.filter(e=>e.id===l.id)[0].y=l.y})},zt=()=>{const o=a.value.filter(l=>l.isGroup===!0);if(o.length>0){const l=getComputedStyle(T.value),e=parseInt(l.getPropertyValue("--setting-icon-group-width").trim()),s=parseInt(l.getPropertyValue("--setting-icon-group-height").trim());o.forEach(r=>{G.value+r.s_x+r.s_width+e>H?G.value+r.s_x-e<0?v.groupBtnPosMore?R.value+r.s_y-s<0?r.btnPosition="bottom":r.btnPosition="top":r.btnPosition="center":r.btnPosition="left":r.btnPosition="right"})}};t.onMounted(()=>{Ke.observe(T.value)});const Ke=new ResizeObserver(o=>{Gt(H===o[0].borderBoxSize[0].inlineSize?null:o[0].borderBoxSize[0].inlineSize,Le===o[0].borderBoxSize[0].blockSize?null:o[0].borderBoxSize[0].blockSize)}),pe=t.ref("");let De=0,ve=0,Ce=null,Pe=!1;const It=(o=[],l=null)=>{clearInterval(Ce),pe.value=new Date().getTime()+"",De=0,ve=0,o.forEach(e=>{De+=1,e.isGroup===!0&&(ve+=e.groupData.length)}),Ze(),C("domStart"),a.value=M(o),a.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)ye(e.id);else{const s=be(e.groupData,e);Ee(s)}}),Pe=!0,t.nextTick(()=>{const e=T.value.getBoundingClientRect();l!=null?(ae(l),ie(e.width/l)):(ae(a.value.length>0?e.width:null),ie(1)),a.value.forEach(s=>{te(s)}),A(),Ce=setInterval(()=>{Te(T.value,pe.value+"p").length===De&&Te(T.value,pe.value+"c").length===ve&&(clearInterval(Ce),C("domReady"))},10),setTimeout(()=>{Pe=!1},500)})},Nt=o=>{o.showSet=!0},ze=o=>{const l=a.value.filter(e=>e.id===o);if(l.length===1)delete l[0].showSet;else try{}catch{}},qe=(o,l,e)=>{const s=l.map(c=>c.y),r=Math.max(...s),n=l.filter(c=>c.y+c.height>r);n.sort((c,y)=>{const h=c.x,p=y.x;return h-p});for(let c=0;c<n.length;c++){if(c===0&&n[c].x>=o.width){o.y=r,o.x=0;break}if(n.length>1&&c!==n.length-1&&n[c].x+n[c].width+o.width<=n[c+1].x){o.y=r,o.x=n[c].x+n[c].width;break}if(c===n.length-1&&n[c].x+n[c].width+o.width<=e){o.y=r,o.x=n[c].x+n[c].width;break}}if(o.y==null){o.x=0;const c=l.map(y=>y.y+y.height);o.y=Math.max(...c)}},se=(o,l=null,e=!1)=>{const s=M(o),r=a.value.filter(n=>n.id===l);if(s.id||(s.id=new Date().getTime()+""),l&&r.length!==1)try{}catch{}finally{return}if(e!==!0&&(delete s.x,delete s.y,l?(r[0].groupData.forEach(n=>{W(n,r[0])}),qe(s,r[0].groupData,r[0].width)):a.value.length===0?(s.x=0,s.y=0):qe(s,a.value,(ee||H)-G.value*2)),l){r[0].groupData.push(s);const n=be(r[0].groupData,r[0]);Ee(n),q([n],(c,y)=>c.filter(h=>h.id!==y.id))}else a.value.length===0&&ae(H),te(s),a.value.push(s);A()},Ie=(o,l=null,e=null)=>{let s=null;const r=a.value.filter(n=>n.id===l);if(l?r.length===1&&(s=M(r[0].groupData.filter(n=>n.id===o)[0])):s=M(a.value.filter(n=>n.id===o)[0]),s)return s.id=e||new Date().getTime()+"",l?(W(s,r[0]),se(s,l)):se(s),N(l?a.value.filter(n=>n.id===l)[0].groupData.filter(n=>n.id===s.id)[0]:a.value.filter(n=>n.id===s.id)[0]);try{}catch{}finally{return null}},ne=(o,l=null)=>{let e=-1;const s=a.value.filter(r=>r.id===l);if(l?s.length===1&&(e=s[0].groupData.findIndex(r=>r.id===o)):e=a.value.findIndex(r=>r.id===o),e!==-1){if(l)if(s[0].groupData.splice(e,1),s[0].groupData.length===1)ye(l);else{s[0].groupData.forEach(n=>{W(n,s[0])});const r=be(s[0].groupData,s[0]);Ee(r)}else a.value.splice(e,1),a.value.length===0&&(ae(null),ie(1));A()}else try{}catch{}},Vt=o=>{Ee(o,!1)},Ee=(o,l=!0)=>{if(o.id){const e=M(o);let s=-1;const r=a.value.filter(n=>n.id===e.inGroupId);if(e.inGroupId?r.length===1&&(s=r[0].groupData.findIndex(n=>n.id===e.id)):s=a.value.findIndex(n=>n.id===e.id),s!==-1){if(l&&(delete e.showPop,delete e.showSet,delete e.btnPosition,e.groupData&&e.groupData.forEach(n=>{delete n.showPop,delete n.showSet})),e.inGroupId){if(l)r[0].groupData[s]=e;else try{delete r[0].showPop,delete r[0].showSet,delete r[0].btnPosition,r[0].groupData&&r[0].groupData.forEach(n=>{delete n.showPop,delete n.showSet});for(let n in e){const c=n.split(".");let y=r[0].groupData[s];for(let h=0;h<c.length;h++)if(h===c.length-1)y[c[h]]=e[n];else if(y=y[c[h]],!y)throw new Error(n)}}catch{try{}catch{}}te(r[0])}else{if(l)a.value[s]=e;else try{delete a.value[s].showPop,delete a.value[s].showSet,delete a.value[s].btnPosition,a.value[s].groupData&&a.value[s].groupData.forEach(n=>{delete n.showPop,delete n.showSet});for(let n in e){const c=n.split(".");let y=a.value[s];for(let h=0;h<c.length;h++)if(h===c.length-1)y[c[h]]=e[n];else if(y=y[c[h]],!y)throw new Error(n)}}catch{try{}catch{}}te(a.value[s])}A()}else try{}catch{}}else try{}catch{}},Gt=(o,l)=>{o!==null&&(H=o,Pe||(ie(ee&&H?o/ee:1),a.value.forEach(e=>{te(e)}),A())),l!==null&&(Le=l)},Ue=o=>{o.showPop||(a.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(e=>{delete e.showPop})}),C("openSetMenu",N(o)),o.showPop=!0,window.addEventListener("click",ge))},ge=()=>{a.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(l=>{delete l.showPop})}),window.removeEventListener("click",ge)},O=t.ref(!1),Je=o=>{const l=a.value.findIndex(e=>e.id===o);if(l!==-1)a.value[l].checked=!0,a.value[l].checkDis=!0,O.value=!0,C("showGroup",O.value);else try{}catch{}},Ne=()=>{O.value=!1,a.value.forEach(o=>{delete o.checked,delete o.checkDis,o.groupData&&o.groupData.forEach(l=>{delete l.checked,delete l.checkDis})}),C("showGroup",O.value)},Tt=o=>{o.checked=!o.checked,C("updateChecked",a.value.filter(l=>l.checked).length)},be=(o,l)=>{const e=M(o),s=M(l);e.sort((i,w)=>{const f=i.x,b=w.x;return f-b});for(let i=0;i<e.length-1;i++){if(i===0&&e[i].x>0){const w=e[i].x;for(let f=i;f<e.length;f++)e[f].x-=w}if(e[i+1].x>e[i].x+e[i].width){const w=M(e.slice(0,i+1));if(e[i+1].x>Math.max(...w.map(f=>f.x+f.width))){const f=e[i+1].x-Math.max(...w.map(b=>b.x+b.width));for(let b=i+1;b<e.length;b++)e[b].x-=f}}}e.sort((i,w)=>{const f=i.y,b=w.y;return f-b});for(let i=0;i<e.length-1;i++){if(i===0&&e[i].y>0){const w=e[i].y;for(let f=i;f<e.length;f++)e[f].y-=w}if(e[i+1].y>e[i].y+e[i].height){const w=M(e.slice(0,i+1));if(e[i+1].y>Math.max(...w.map(f=>f.y+f.height))){const f=e[i+1].y-Math.max(...w.map(b=>b.y+b.height));for(let b=i+1;b<e.length;b++)e[b].y-=f}}}const r=e.map(i=>i.x+i.width),n=Math.max(...r),c=e.map(i=>i.y+i.height),y=Math.max(...c);e.forEach(i=>{i.inGroupId||(i.inGroupId=s.id),i.groupW=i.width/n,i.groupH=i.height/y,i.groupX=i.x/n,i.groupY=i.y/y,i.isObstacle=i.x+i.width===n&&i.y===0,delete i.width,delete i.height});const h=getComputedStyle(T.value),p=parseInt(h.getPropertyValue("--group-tit-height").trim());return s.width=n,s.height=y+(s.groupTit?p:0),s.groupData=[...e],s},W=(o,l)=>{const e=getComputedStyle(T.value),s=parseInt(e.getPropertyValue("--group-tit-height").trim());o.width=l.width*o.groupW,o.height=(l.height-(l.groupTit?s:0))*o.groupH},Ot=()=>{t.nextTick(()=>{Ae()})},At=()=>{let o=a.value.filter(l=>l.checked);if(o.length>1)if(o=v.beforeAddGroup(M(o)),typeof o=="object"&&o instanceof Array&&o.length>0&&o.filter(l=>l.id).length===o.length){const l={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=be(o,l);return e.groupData.forEach(s=>{ne(s.id)}),se(e),Ne(),N(a.value.filter(s=>s.id===e.id)[0])}else try{}catch{}finally{return null}else return Ne(),null},Qe=(o,l)=>{const e=a.value.filter(s=>s.id===l)[0];if(e){let s=e.groupData.filter(r=>r.id===o)[0];if(s){if(e.groupData.length===2)return ye(l);if(s=v.beforeRemoveGroup(M([s])),typeof s=="object"&&s instanceof Array&&s.length===1&&s.filter(r=>r.id).length===1)return s=s[0],W(s,e),delete s.inGroupId,delete s.groupW,delete s.groupH,delete s.groupX,delete s.groupY,delete s.isObstacle,ne(s.id,e.id),se(s),[N(a.value.filter(r=>r.id===o)[0])];try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ye=o=>{const l=a.value.filter(e=>e.id===o)[0];if(l){let e=[],s=!0;try{l.groupData.forEach(r=>{if(r=v.beforeRemoveGroup(M([l])),typeof r=="object"&&r instanceof Array&&r.length===1&&r.filter(n=>n.id).length===1)r=r[0];else throw s=!1,new Error})}catch{}if(s){l.groupData.forEach(n=>{W(n,l),n.x+=l.x,n.y+=l.y,delete n.inGroupId,delete n.groupW,delete n.groupH,delete n.groupX,delete n.groupY,delete n.isObstacle,e.push(n.id),se(n,null,!0)}),ne(l.id);let r=[];return e.forEach(n=>{r.push(N(a.value.filter(c=>c.id===n)[0]))}),r}else return[]}else try{}catch{}finally{return[]}},Yt=(o="",l)=>{const e=a.value.filter(s=>s.id===l)[0];if(e){if(!e.groupTit||!o){const s=getComputedStyle(T.value),r=parseInt(s.getPropertyValue("--group-tit-height").trim());e.groupTit&&!o&&(e.height-=r,e.s_height-=r*E.value),!e.groupTit&&o&&(e.height+=r,e.s_height+=r*E.value)}e.groupTit=o,q([e],(s,r)=>s.filter(n=>n.id!==r.id)),A()}else try{}catch{}},Ze=()=>{a.value=[],ae(null),ie(1),ce.value=0},Lt=()=>new Promise((o,l)=>{a.value.forEach(s=>{delete s.showPop,delete s.showSet,s.groupData&&s.groupData.forEach(r=>{delete r.showPop,delete r.showSet})});const e=M(a.value);e.forEach(s=>{s.isGroup===!0&&s.groupData.forEach(r=>{W(r,s),delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y}),delete s.btnPosition,delete s.s_width,delete s.s_height,delete s.s_x,delete s.s_y}),o({data:e,width:ee})});return t.onBeforeUnmount(()=>{Ke.unobserve(T.value),window.removeEventListener("click",ge)}),Y({init:It,addItem:se,copyItem:Ie,deleteItem:ne,updateItem:Vt,hideGroupSet:ze,openGroup:Je,closeGroup:Ne,changeGroupBorder:Ot,addGroup:At,removeGroupItem:Qe,removeGroup:ye,changeGroupTit:Yt,resetData:Ze,getData:Lt}),(o,l)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(E),"--com-x-space":t.unref(G)+"px","--com-y-space":t.unref(R)+"px"}),ref_key:"pageRef",ref:T},[t.createElementVNode("div",je,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(a),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop||e.isGroup&&e.groupData.filter(r=>r.showPop).length>0?"on-top":"",t.unref(pe)+"p"]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:s},[t.createElementVNode("div",{class:t.normalizeClass(["com-item-inner",g.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?"":"can-drag",g.seeModel?"no-hover":""]),onMousedown:t.withModifiers(r=>g.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?null:Ct(r,s),["prevent"]),onMouseenter:r=>g.seeModel||t.unref(O)||t.unref(S)||t.unref(x)||!e.isGroup?null:Nt(e),onMouseleave:r=>g.seeModel||t.unref(O)||t.unref(S)||t.unref(x)||!e.isGroup?null:ze(e.id)},[t.createElementVNode("div",tt,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,ot)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(r,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",r.isObstacle?"is-obstacle":"",t.unref(pe)+"c"]),style:t.normalizeStyle({width:r.s_width+"px",height:r.s_height+"px",top:r.s_y+"px",left:r.s_x+"px"}),key:n},[t.createElementVNode("div",lt,[t.renderSlot(o.$slots,"item",{data:r},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(r.s_width*100)/100)+","+t.toDisplayString(Math.round(r.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(r.s_x*100)/100)+","+t.toDisplayString(Math.round(r.s_y*100)/100),1)])]),!g.seeModel&&!t.unref(O)&&t.unref(S)===null&&t.unref(x)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:r.showPop?"flex":"none"}),onMousedown:t.withModifiers(c=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:g.settingIcon,onClick:t.withModifiers(c=>Ue(r),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),r.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(c=>null,["prevent","stop"])},[t.renderSlot(o.$slots,"setPopNormal",{data:N(r)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:c=>Qe(r.id,r.inGroupId)},"移出组合",8,rt),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:c=>Ie(r.id,r.inGroupId)},"复制",8,st),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:c=>ne(r.id,r.inGroupId)},"删除",8,nt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",at,[t.renderSlot(o.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_width*100)/100)+","+t.toDisplayString(Math.round(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_x*100)/100)+","+t.toDisplayString(Math.round(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(O)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:r=>e.checkDis?null:Tt(e)},null,10,it)):t.createCommentVNode("",!0),!g.seeModel&&!t.unref(O)&&t.unref(S)===null&&t.unref(x)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="top"?"only-g t":e.btnPosition==="bottom"?"only-g b":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:g.settingIcon,onClick:t.withModifiers(r=>Ue(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="top"?"special t":e.btnPosition==="bottom"?"special b":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(r=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(o.$slots,"setPopSpecial",{key:0,data:N(e)},()=>[g.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>{ze(e.id),C("showTitPop",e.groupTit,e.id)}}," 设置组合标题",8,ct)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>ye(e.id)},"解除组合",8,dt)]):t.renderSlot(o.$slots,"setPopNormal",{key:1,data:N(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:r=>Je(e.id)},"组合",8,ht)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>Ie(e.id)},"复制",8,ut),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:r=>ne(e.id)},"删除",8,ft)])],34)):t.createCommentVNode("",!0)]),!g.seeModel&&!t.unref(O)&&!e.showPop&&!(e.isGroup&&e.groupData.filter(r=>r.showPop).length>0)&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(L).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(r=>$(r,e,"top-left"),["prevent","stop"])},null,40,pt)):t.createCommentVNode("",!0),t.unref(L).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(r=>$(r,e,"top"),["prevent","stop"])},null,40,gt)):t.createCommentVNode("",!0),t.unref(L).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(r=>$(r,e,"top-right"),["prevent","stop"])},null,40,yt)):t.createCommentVNode("",!0),t.unref(L).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(r=>$(r,e,"left"),["prevent","stop"])},null,40,_t)):t.createCommentVNode("",!0),t.unref(L).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(r=>$(r,e,"right"),["prevent","stop"])},null,40,xt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(r=>$(r,e,"bottom-left"),["prevent","stop"])},null,40,wt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(r=>$(r,e,"bottom"),["prevent","stop"])},null,40,kt)):t.createCommentVNode("",!0),t.unref(L).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(r=>$(r,e,"bottom-right"),["prevent","stop"])},null,40,mt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],42,et)],6))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(a),(e,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.s_width-t.unref(G)*2*t.unref(E)+"px",height:e.s_height-t.unref(R)*2*t.unref(E)+"px",top:e.s_y+t.unref(R)*t.unref(E)+"px",left:e.s_x+t.unref(G)*t.unref(E)+"px"}),key:s},null,6))),128)),t.unref(S)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(B).s_width+"px",height:t.unref(B).s_height+"px",top:t.unref(B).s_y+"px",left:t.unref(B).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ce)>0?+(t.unref(ce)*t.unref(E)+(g.seeModel?g.seeModelMinBg:220)):0)+"px"})},null,4),g.showAuxiliary?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(de)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(de)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(he)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(he)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(ue)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(ue)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(fe)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(fe)+"px"})},null,4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0),t.unref(a).length===0?(t.openBlock(),t.createElementBlock("div",Et,[t.renderSlot(o.$slots,"empty",{},()=>[l[0]||(l[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)])],4))}}],Ve={install(g){bt.forEach(Y=>{g.component("vueDragComponentPlus",Y)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(Ve),Ve});
