(function(e,A){typeof exports=="object"&&typeof module<"u"?module.exports=A(require("vue")):typeof define=="function"&&define.amd?define(["vue"],A):(e=typeof globalThis<"u"?globalThis:e||self,e.vueDragComponentPlus=A(e.Vue))})(this,function(e){"use strict";const A={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(m){return(W,pe)=>{const G=e.resolveComponent("el-icon");return m.iconObj.type==="custom"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.iconObj.icon),e.normalizeProps(e.mergeProps({key:0},m.iconObj.attrs)),null,16)):m.iconObj.type==="el"?(e.openBlock(),e.createBlock(G,e.normalizeProps(e.mergeProps({key:1},m.iconObj.attrs)),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.iconObj.icon)))]),_:1},16)):m.iconObj.type==="iconfont"?(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:2,class:["icon iconfont","icon-"+m.iconObj.icon]},m.iconObj.attrs),null,16)):(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:3,class:m.iconObj.type},m.iconObj.attrs),e.toDisplayString(m.iconObj.icon),17))}}},at="",Ve=["onMousedown","onMouseenter","onMouseleave"],ze={class:"com-item-box"},Ne=["title"],Oe={class:"com-item-box-content"},Ge=["onClick"],Pe=["onClick"],Ie={key:1,class:"com-item-box-content"},We=["onClick"],He=["onClick"],Te=["onClick"],Ye=["onClick"],ve=["onClick"],Xe=["onMousedown"],Le=["onMousedown"],Re=["onMousedown"],$e=["onMousedown"],Ae=["onMousedown"],_e=["onMousedown"],be=["onMousedown"],Fe=["onMousedown"],Ke={key:2,class:"com-empty"},qe=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},addFirstSpace:{type:Boolean,default:!1},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(m,W){return m>=0}},itemMinWidth:{type:Number,default:15,validator(m,W){return m>=15}},itemMinHeight:{type:Number,default:15,validator(m,W){return m>=15}},ySpace:{type:Number,default:7,validator(m,W){return m>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},hideAuxiliary:{type:Boolean,default:!1},auxiliarySpace:{type:Number,default:15,validator(m,W){return m>=1}}},emits:["dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop"],setup(m,{expose:W,emit:pe}){const G=pe,k=m,B=o=>{if(typeof o=="object"&&!e.isVNode(o)&&o!==null&&!(o instanceof Date)){let r=o instanceof Array?[]:{};for(let t in o)r[t]=typeof o[t]=="object"&&!e.isVNode(o[t])&&o[t]!==null&&!(o[t]instanceof Date)?B(o[t]):o[t];return r}else return o},ue=()=>{k.insertResizeKeys.forEach(o=>{k.excludeResizeKeys.indexOf(o)===-1&&H.value.push(o)})};e.watch(()=>[k.insertResizeKeys,k.excludeResizeKeys],()=>{ue()});const H=e.ref([]);ue();const P=e.ref(null);let T=null,ye=null;const Ue=e.ref(null),q=e.ref(0),U=e.ref(null),J=e.ref(null),Q=e.ref(null),Z=e.ref(null),_=o=>{const r=B(o);if(o===null)U.value=null,J.value=null,Q.value=null,Z.value=null;else{const t=getComputedStyle(P.value),n=parseInt(t.getPropertyValue("--auxiliary-width").trim()),l=d.value.filter(a=>a.id!==r.id).map(a=>a.y),x=d.value.filter(a=>a.id!==r.id).map(a=>a.y+a.height-1),u=[...l,...x];u.sort(),u.filter(a=>a<=r.y&&r.y-k.auxiliarySpace<a||a>=r.y&&r.y+k.auxiliarySpace>a).length>0?U.value=r.y:U.value=null,u.filter(a=>a<=r.y+r.height-1&&r.y+r.height-1-k.auxiliarySpace<a||a>=r.y+r.height-1&&r.y+r.height-1+k.auxiliarySpace>a).length>0?J.value=r.y+r.height-n:J.value=null;const w=d.value.filter(a=>a.id!==r.id).map(a=>a.x),g=d.value.filter(a=>a.id!==r.id).map(a=>a.x+a.width-1),c=[...w,...g];c.sort(),c.filter(a=>a<=r.x&&r.x-k.auxiliarySpace<a||a>=r.x&&r.x+k.auxiliarySpace>a).length>0?Q.value=r.x:Q.value=null,c.filter(a=>a<=r.x+r.width-1&&r.x+r.width-1-k.auxiliarySpace<a||a>=r.x+r.width-1&&r.x+r.width-1+k.auxiliarySpace>a).length>0?Z.value=r.x+r.width-n:Z.value=null}},d=e.ref([]),Je=(o,r)=>{let t=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.msMatchesSelector;for(;o&&!t.call(o,r);)o=o.parentElement;return o};let D=null,fe=null,ge=null;const V=e.ref({}),Qe=(o,r)=>{j(),D=r,V.value=B(d.value[D]),G("dragStart",B(d.value[D])),d.value[D].move=!0,_(d.value[D]);const t=Je(o.target,".com-item");fe=o.clientX-t.offsetLeft,ge=o.clientY-t.offsetTop,window.addEventListener("mousemove",xe),window.addEventListener("mouseup",we)},xe=o=>{const r=o.clientX-fe,t=o.clientY-ge,n=r<=Y("left")?Y("left"):r>=Y("right")?Y("right"):r,l=t<=Y("top")?Y("top"):t>=Y("bottom")?Y("bottom"):t,x=n-d.value[D].x,u=l-d.value[D].y,w=`${x>3?"right":x<-3?"left":""}_${u>0?"bottom":u<0?"top":""}`;d.value[D].x=n,d.value[D].y=l,_(d.value[D]);let g=B(d.value.filter(c=>c.move!==!0).filter(c=>c.x<n&&c.x+c.width>n||c.x===n||c.x>n&&c.x<n+d.value[D].width).filter(c=>c.y<l&&c.y+c.height>l||c.y===l||c.y>l&&c.y<l+d.value[D].height));if(g.length===0)V.value.x=n,V.value.y=l;else{if(w.indexOf("top")!==-1){g=g.filter(i=>i.y<V.value.y);const c=Math.min(...g.map(i=>i.y+i.height));g.forEach(i=>{Math.abs(i.y+i.height-c)<5&&(i.y=c-i.height)});let a=V.value.y-l,y=!0,s=[...g];const p=i=>{B(d.value.filter(h=>h.move!==!0&&h.y+h.height-i.y<=a+3&&h.y+h.height-i.y>=0).filter(h=>h.x<i.x&&h.x+h.width>i.x||h.x>=i.x&&h.x<i.x+i.width)).forEach(h=>{h.y+h.height!==i.y&&(h.y=i.y-h.height),s.findIndex(S=>S.id===h.id)===-1&&(s.push(h),p(h))})};if(g.forEach(i=>{p(i)}),s.sort((i,M)=>{const h=i.y,S=M.y;return h-S}),(s.length===0||s.filter(i=>i.y===0).length>0)&&(y=!1),y){let i=0;s.filter(h=>h.y===s[0].y).forEach(h=>{B(d.value.filter(E=>E.move!==!0&&E.y+E.height<h.y).filter(E=>E.x<h.x&&E.x+E.width>h.x||E.x>=h.x&&E.x<h.x+h.width)).forEach(E=>{E.y+E.height>i&&(i=E.y+E.height)})}),i=s[0].y-i,i<a&&(a=i),s.forEach(h=>{h.y-=a,d.value.filter(S=>S.id===h.id)[0].y=h.y}),V.value.x=n,V.value.y=d.value.filter(h=>h.id===s[s.length-1].id)[0].y+d.value.filter(h=>h.id===s[s.length-1].id)[0].height}else{let i=0;g.forEach(S=>{const E=d.value.filter(N=>N.move!==!0).filter(N=>N.x<S.x&&N.x+N.width>S.x||N.x===S.x||N.x>S.x&&N.x<S.x+S.width).filter(N=>N.y>S.y+S.height);E.length>0&&(i=Math.min(...E.map(N=>N.y)))});const M=i===0?0:i-V.value.height-(Math.max(...g.map(S=>S.y+S.height))-Math.min(...g.map(S=>S.y))),h=M===0?l+V.value.height-Math.min(...g.map(S=>S.y)):i-Math.min(...g.map(S=>S.y))-(Math.max(...g.map(S=>S.y+S.height))-Math.min(...g.map(S=>S.y)));if(M===0||l<=M){g.filter(E=>E.y<V.value.y).forEach(E=>{E.y+=h,d.value.filter(N=>N.id===E.id)[0].y=E.y}),V.value.x=n,V.value.y=l;const S=E=>{d.value.filter(z=>z.move!==!0&&z.id!==E.id).filter(z=>z.x<E.x&&z.x+z.width>E.x||z.x===E.x||z.x>E.x&&z.x<E.x+E.width).filter(z=>z.y<E.y&&z.y+z.height>E.y||z.y===E.y||z.y>E.y&&z.y<E.y+E.height).forEach(z=>{z.y=E.y+E.height,S(z)})};d.value.forEach(E=>S(E))}}g=B(d.value.filter(i=>i.move!==!0).filter(i=>i.x<n&&i.x+i.width>n||i.x===n||i.x>n&&i.x<n+d.value[D].width).filter(i=>i.y<l&&i.y+i.height>l||i.y===l||i.y>l&&i.y<l+d.value[D].height))}if(w.indexOf("bottom")!==-1){let c=0;g.forEach(s=>{const p=d.value.filter(i=>i.move!==!0).filter(i=>i.x<s.x&&i.x+i.width>s.x||i.x===s.x||i.x>s.x&&i.x<s.x+s.width).filter(i=>i.y+i.height<s.y);p.length>0&&(c=Math.max(...p.map(i=>i.y+i.height)))});const a=c+(Math.max(...g.map(s=>s.height+s.y))-Math.min(...g.map(s=>s.y))),y=Math.min(...g.map(s=>s.y))-c;if(l>=a){let s=!0;g.filter(i=>i.y>V.value.y).forEach(i=>{i.y-=y,d.value.filter(h=>h.id===i.id)[0].y=i.y;const M=d.value.filter(h=>h.move!==!0&&h.id!==i.id).filter(h=>h.x<i.x&&h.x+h.width>i.x||h.x===i.x||h.x>i.x&&h.x<i.x+i.width).filter(h=>h.y<i.y&&h.y+h.height>i.y||h.y===i.y||h.y>i.y&&h.y<i.y+i.height);M.length>0&&(i.y=Math.max(...M.map(h=>h.y+h.height)),d.value.filter(h=>h.id===i.id)[0].y=i.y)}),V.value.x=n,s&&(V.value.y=a);const p=i=>{d.value.filter(h=>h.id!==i.id).filter(h=>h.x<i.x&&h.x+h.width>i.x||h.x===i.x||h.x>i.x&&h.x<i.x+i.width).filter(h=>h.y<i.y&&h.y+h.height>i.y||h.y===i.y||h.y>i.y&&h.y<i.y+i.height).forEach(h=>{h.y=i.y+i.height,h.move===!0&&(V.value.y=h.y,s=!1),p(h)})};d.value.forEach(i=>p(i)),g=B(d.value.filter(i=>i.move!==!0).filter(i=>i.x<n&&i.x+i.width>n||i.x===n||i.x>n&&i.x<n+d.value[D].width).filter(i=>i.y<l&&i.y+i.height>l||i.y===l||i.y>l&&i.y<l+d.value[D].height))}}if(((w.indexOf("top")!==-1||w.indexOf("bottom")!==-1)&&(w.indexOf("right")!==-1||w.indexOf("left")!==-1)&&Math.abs(x)>8||w.indexOf("top")===-1&&w.indexOf("bottom")===-1&&(w.indexOf("right")!==-1||w.indexOf("left")!==-1))&&g.length>0){g.sort((a,y)=>{const s=a.y,p=y.y;return s-p});let c=!0;for(let a=0;a<g.length;a++){if(c){const y=B(d.value);for(let s=0;s<=a;s++){let p=null;const i=y.filter(M=>M.move!==!0&&M.y<g[s].y).filter(M=>M.x<g[s].x&&M.x+M.width>g[s].x||M.x===g[s].x||M.x>g[s].x&&M.x<g[s].x+g[s].width);if(i.length===0?p=0:p=Math.max(...i.map(M=>M.y+M.height)),s===a){if(g[s].y-(g[s].y+g[s].height-l)<p){c=!1;break}}else if(g[s].y-g[a].height<p){c=!1;break}else y.filter(M=>M.id===g[s].id)[0].y-=g[a].height}}if(c){g[a].y-=g[a].y+g[a].height-l,d.value.filter(y=>y.id===g[a].id)[0].y=g[a].y;for(let y=a;y>0;y--)g[a-1].y-=g[a].height,d.value.filter(s=>s.id===g[a-1].id)[0].y=g[a-1].y}else g.filter(y=>y.id===g[a].id).forEach(y=>{y.y+=d.value[D].y+d.value[D].height-y.y,d.value.filter(p=>p.id===y.id)[0].y=y.y;const s=p=>{d.value.filter(M=>M.move!==!0&&M.id!==p.id).filter(M=>M.x<p.x&&M.x+M.width>p.x||M.x===p.x||M.x>p.x&&M.x<p.x+p.width).filter(M=>M.y<p.y&&M.y+M.height>p.y||M.y===p.y||M.y>p.y&&M.y<p.y+p.height).forEach(M=>{M.y=p.y+p.height,s(M)})};s(y)})}V.value.x=n}}O(!1),G("dragIng",B(d.value[D]))},we=()=>{window.removeEventListener("mousemove",xe),window.removeEventListener("mouseup",we),delete d.value[D].move,d.value[D].x=V.value.x,d.value[D].y=V.value.y,_(null),O(),G("dragEnd",B(d.value[D])),D=null},Y=o=>{switch(o){case"top":return 0;case"right":return T-d.value[D].width;case"bottom":return 999999999;case"left":return 0}};let f=null,se="",te=0,le=0,X=0,L=0,R=0,$=0,b=0,re=0,F=0,oe=0;const v=(o,r,t)=>{j(),f=r,G("resizeStart",B(f)),se=t,te=o.clientX,le=o.clientY,X=r.width,L=r.height,R=r.y,$=r.x,f.drag=!0,_(f);const n=d.value.filter(c=>c.static===!0&&(c.x<r.x?c.x+c.width>=r.x:c.x<=r.x+r.width)),l=d.value.filter(c=>c.static===!0&&(c.y<r.y?c.y+c.height>=r.y:c.y<=r.y+r.height)),x=n.filter(c=>c.y+c.height<=r.y).map(c=>c.y+c.height);x.length>0?b=Math.max(...x):b=0;const u=n.filter(c=>c.y>=r.y+r.height).map(c=>c.y);u.length>0?re=Math.min(...u):re=0;const w=l.filter(c=>c.x+c.width<=r.x).map(c=>c.x+c.width);w.length>0?F=Math.max(...w):F=0;const g=l.filter(c=>c.x>=r.x+r.width).map(c=>c.x);g.length>0?oe=Math.min(...g):oe=0,window.addEventListener("mousemove",ke),window.addEventListener("mouseup",Me)},ke=o=>{const r=X+(o.clientX-te),t=L+(o.clientY-le),n=X-(o.clientX-te),l=L-(o.clientY-le),x=R+(o.clientY-le),u=$+(o.clientX-te),w=getComputedStyle(P.value),g=parseInt(w.getPropertyValue("--com-item-border-width").trim()),c=parseInt(w.getPropertyValue("--group-tit-height").trim());switch(se){case"top-left":if(f.height=l<k.itemMinHeight?k.itemMinHeight:l>C("top")?C("top"):l,f.y=l<k.itemMinHeight?R+L-k.itemMinHeight:l>C("top")?b:x,f.width=n<k.itemMinWidth?k.itemMinWidth:n>C("left")?C("left"):n,f.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>C("left")?F:u,f.isGroup===!0){const y=f.width-2*g,s=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(p=>{p.width=y*p.groupW,p.x=y*p.groupX,p.height=s*p.groupH,p.y=s*p.groupY})}break;case"top":if(f.height=l<k.itemMinHeight?k.itemMinHeight:l>C("top")?C("top"):l,f.y=l<k.itemMinHeight?R+L-k.itemMinHeight:l>C("top")?b:x,f.isGroup===!0){const y=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(s=>{s.height=y*s.groupH,s.y=y*s.groupY})}break;case"top-right":if(f.height=l<k.itemMinHeight?k.itemMinHeight:l>C("top")?C("top"):l,f.y=l<k.itemMinHeight?R+L-k.itemMinHeight:l>C("top")?b:x,f.width=r<k.itemMinWidth?k.itemMinWidth:r>C("right")?C("right"):r,f.isGroup===!0){const y=f.width-2*g,s=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(p=>{p.width=y*p.groupW,p.x=y*p.groupX,p.height=s*p.groupH,p.y=s*p.groupY})}break;case"left":if(f.width=n<k.itemMinWidth?k.itemMinWidth:n>C("left")?C("left"):n,f.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>C("left")?F:u,f.isGroup===!0){const y=f.width-2*g;f.groupData.forEach(s=>{s.width=y*s.groupW,s.x=y*s.groupX})}break;case"right":if(f.width=r<k.itemMinWidth?k.itemMinWidth:r>C("right")?C("right"):r,f.isGroup===!0){const y=f.width-2*g;f.groupData.forEach(s=>{s.width=y*s.groupW,s.x=y*s.groupX})}break;case"bottom-left":if(f.height=t<k.itemMinHeight?k.itemMinHeight:t>C("bottom")?C("bottom"):t,f.width=n<k.itemMinWidth?k.itemMinWidth:n>C("left")?C("left"):n,f.x=n<k.itemMinWidth?$+X-k.itemMinWidth:n>C("left")?F:u,f.isGroup===!0){const y=f.width-2*g,s=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(p=>{p.width=y*p.groupW,p.x=y*p.groupX,p.height=s*p.groupH,p.y=s*p.groupY})}break;case"bottom":if(f.height=t<k.itemMinHeight?k.itemMinHeight:t>C("bottom")?C("bottom"):t,f.isGroup===!0){const y=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(s=>{s.height=y*s.groupH,s.y=y*s.groupY})}break;case"bottom-right":if(f.height=t<k.itemMinHeight?k.itemMinHeight:t>C("bottom")?C("bottom"):t,f.width=r<k.itemMinWidth?k.itemMinWidth:r>C("right")?C("right"):r,f.isGroup===!0){const y=f.width-2*g,s=f.height-2*g-(f.groupTit?c:0);f.groupData.forEach(p=>{p.width=y*p.groupW,p.x=y*p.groupX,p.height=s*p.groupH,p.y=s*p.groupY})}break}_(f);let a=B(d.value.filter(y=>y.drag!==!0).filter(y=>y.x<f.x&&y.x+y.width>f.x||y.x===f.x||y.x>f.x&&y.x<f.x+f.width).filter(y=>y.y<f.y&&y.y+y.height>f.y||y.y===f.y||y.y>f.y&&y.y<f.y+f.height));if(a.length>0){a.sort((y,s)=>{const p=y.y,i=s.y;return p-i});for(let y=0;y<a.length;y++)a.filter(s=>s.id===a[y].id).forEach(s=>{s.y+=f.y+f.height-s.y,d.value.filter(i=>i.id===s.id)[0].y=s.y;const p=i=>{d.value.filter(h=>h.drag!==!0&&h.id!==i.id).filter(h=>h.x<i.x&&h.x+h.width>i.x||h.x===i.x||h.x>i.x&&h.x<i.x+i.width).filter(h=>h.y<i.y&&h.y+h.height>i.y||h.y===i.y||h.y>i.y&&h.y<i.y+i.height).forEach(h=>{h.y=i.y+i.height,p(h)})};p(s)})}O(!1),G("resizeIng",B(f))},Me=o=>{delete f.drag,se="",_(null),window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Me),O(),G("resizeEnd",B(f)),f=null},C=o=>{switch(o){case"top":return R+L-b;case"left":return $+X-F;case"right":return(oe>0?oe:T)-$;case"bottom":return re>0?re-R:999999999}},O=(o=!0)=>{o===!0&&Ee();const r=d.value.map(t=>t.y+t.height);r.length>0?q.value=Math.max(...r):q.value=0};e.watch(()=>k.ySpace,()=>{k.ySpace>=0&&Ee()});const Ee=()=>{const o=B(d.value).sort((r,t)=>{const n=r.y,l=t.y;return n-l});for(let r=0;r<o.length;r++){if(r===0&&o[r].y>0){const t=o[r].y;for(let n=r;n<o.length;n++)o[n].y-=t,d.value.filter(l=>l.id===o[n].id)[0].y=o[n].y}if(r<o.length-1&&o[r+1].y>o[r].y+o[r].height){const t=B(o.slice(0,r+1));if(o[r+1].y>Math.max(...t.map(n=>n.y+n.height))){const n=o[r+1].y-Math.max(...t.map(l=>l.y+l.height));for(let l=r+1;l<o.length;l++)o[l].y-=n,d.value.filter(x=>x.id===o[l].id)[0].y=o[l].y}}}for(let r=0;r<o.length-1;r++){let t=o.findIndex(n=>n.y===o[r].y+o[r].height);if(t!==-1)for(let n=t;n<o.length;n++)o[n].y+=k.ySpace,d.value.filter(l=>l.id===o[n].id)[0].y=o[n].y}k.addFirstSpace&&d.value.forEach(r=>r.y+=k.ySpace)};e.onMounted(()=>{me.observe(P.value)});const me=new ResizeObserver(o=>{tt(T===o[0].contentRect.width?null:o[0].contentRect.width,ye===o[0].contentRect.height?null:o[0].contentRect.height)});let ce=!1;const Ze=(o=[],r=null)=>{d.value=B(o),d.value.filter(t=>t.isGroup===!0).forEach(t=>{if(t.isGroup===!0)if(t.groupData.length<2)ee(t.id);else{const n=ae(t.groupData,t);ne(n)}}),r!==null?e.nextTick(()=>{const n=P.value.getBoundingClientRect().width/r,l=getComputedStyle(P.value),x=parseInt(l.getPropertyValue("--com-item-border-width").trim()),u=parseInt(l.getPropertyValue("--group-tit-height").trim());d.value.forEach(w=>{if(w.width*=n,w.height*=n,w.x*=n,w.y*=n,w.isGroup===!0){const g=w.width-2*x,c=w.height-2*x-(w.groupTit?u:0);w.groupData.forEach(a=>{a.width=g*a.groupW,a.x=g*a.groupX,a.height=c*a.groupH,a.y=c*a.groupY})}}),O()}):O(),ce=!0,setTimeout(()=>{ce=!1},500)},je=(o,r)=>{r.showSet=!0},et=(o,r)=>{delete r.showSet},Be=(o,r,t)=>{const n=r.map(u=>u.y),l=Math.max(...n),x=r.filter(u=>u.y+u.height>l);x.sort((u,w)=>{const g=u.x,c=w.x;return g-c});for(let u=0;u<x.length;u++){if(u===0&&x[u].x>=o.width){o.y=l,o.x=0;break}if(x.length>1&&u!==x.length-1&&x[u].x+x[u].width+o.width<=x[u+1].x){o.y=l,o.x=x[u].x+x[u].width;break}if(u===x.length-1&&x[u].x+x[u].width+o.width<=t){o.y=l,o.x=x[u].x+x[u].width;break}}if(o.y==null){o.x=0;const u=r.map(w=>w.y+w.height);o.y=Math.max(...u)}},ie=(o,r=null,t=!1)=>{const n=B(o),l=d.value.filter(x=>x.id===r);if(n.id||(n.id=new Date().getTime()+""),r&&l.length!==1){try{}catch{}return}if(t!==!0)if(delete n.x,delete n.y,r){const x=getComputedStyle(P.value),u=parseInt(x.getPropertyValue("--com-item-border-width").trim());Be(n,l[0].groupData,l[0].width-2*u)}else d.value.length===0?(n.x=0,n.y=0):Be(n,d.value,T);if(r){l[0].groupData.push(n);const x=ae(l[0].groupData,l[0]);ne(x);const u=w=>{d.value.filter(c=>c.id!==w.id).filter(c=>c.x<w.x&&c.x+c.width>w.x||c.x===w.x||c.x>w.x&&c.x<w.x+w.width).filter(c=>c.y<w.y&&c.y+c.height>w.y||c.y===w.y||c.y>w.y&&c.y<w.y+w.height).forEach(c=>{c.y=w.y+w.height,u(c)})};u(x)}else d.value.push(n);O()},K=(o,r=null)=>{let t=-1;const n=d.value.filter(l=>l.id===r);if(r?n.length===1&&(t=n[0].groupData.findIndex(l=>l.id===o)):t=d.value.findIndex(l=>l.id===o),t!==-1){if(r)if(n[0].groupData.splice(t,1),n[0].groupData.length===1)ee(r);else{const l=ae(n[0].groupData,n[0]);ne(l)}else d.value.splice(t,1);O()}else try{}catch{}},ne=o=>{if(o.id){const r=B(o);delete r.showPop,delete r.showSet,r.groupData&&r.groupData.forEach(l=>{delete l.showPop,delete l.showSet});let t=-1;const n=d.value.filter(l=>l.id===r.inGroupId);if(r.inGroupId?n.length===1&&(t=n[0].groupData.findIndex(l=>l.id===r.id)):t=d.value.findIndex(l=>l.id===r.id),t!==-1)r.inGroupId?n[0].groupData[t]=r:d.value[t]=r,O();else try{}catch{}}else try{}catch{}},tt=(o,r)=>{if(o!==null){const t=T?o/T:1;T=o;const n=getComputedStyle(P.value),l=parseInt(n.getPropertyValue("--com-item-border-width").trim()),x=parseInt(n.getPropertyValue("--group-tit-height").trim());ce||(d.value.forEach(u=>{if(u.width*=t,u.height*=t,u.x*=t,u.y*=t,u.isGroup===!0){const w=u.width-2*l,g=u.height-2*l-(u.groupTit?x:0);u.groupData.forEach(c=>{c.width=w*c.groupW,c.x=w*c.groupX,c.height=g*c.groupH,c.y=g*c.groupY})}}),O())}r!==null&&(ye=r)},Se=o=>{o.showPop||(d.value.forEach(r=>{delete r.showPop,r.groupData&&r.groupData.forEach(t=>{delete t.showPop})}),G("openSetMenu",B(o)),o.showPop=!0,window.addEventListener("click",j))},j=()=>{d.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(r=>{delete r.showPop})}),window.removeEventListener("click",j)},I=e.ref(!1),De=o=>{const r=d.value.findIndex(t=>t.id===o);if(r!==-1)d.value[r].checked=!0,d.value[r].disabled=!0,I.value=!0,G("showGroup",I.value);else try{}catch{}},he=()=>{I.value=!1,d.value.forEach(o=>{delete o.checked,delete o.disabled,o.groupData&&o.groupData.forEach(r=>{delete r.checked,delete r.disabled})}),G("showGroup",I.value)},lt=o=>{o.checked=!o.checked,G("updateChecked",d.value.filter(r=>r.checked).length)},ae=(o,r)=>{const t=B(o),n=B(r);t.sort((a,y)=>{const s=a.x,p=y.x;return s-p});for(let a=0;a<t.length-1;a++){if(a===0&&t[a].x>0){const y=t[a].x;for(let s=a;s<t.length;s++)t[s].x-=y}if(t[a+1].x>t[a].x+t[a].width){const y=B(t.slice(0,a+1));if(t[a+1].x>Math.max(...y.map(s=>s.x+s.width))){const s=t[a+1].x-Math.max(...y.map(p=>p.x+p.width));for(let p=a+1;p<t.length;p++)t[p].x-=s}}}t.sort((a,y)=>{const s=a.y,p=y.y;return s-p});for(let a=0;a<t.length-1;a++){if(a===0&&t[a].y>0){const y=t[a].y;for(let s=a;s<t.length;s++)t[s].y-=y}if(t[a+1].y>t[a].y+t[a].height){const y=B(t.slice(0,a+1));if(t[a+1].y>Math.max(...y.map(s=>s.y+s.height))){const s=t[a+1].y-Math.max(...y.map(p=>p.y+p.height));for(let p=a+1;p<t.length;p++)t[p].y-=s}}}const l=t.map(a=>a.x+a.width),x=Math.max(...l),u=t.map(a=>a.y+a.height),w=Math.max(...u);t.forEach(a=>{a.inGroupId||(a.inGroupId=n.id),a.groupW=a.width/x,a.groupH=a.height/w,a.groupX=a.x/x,a.groupY=a.y/w,a.isObstacle=a.x+a.width===x&&a.y===0});const g=getComputedStyle(P.value),c=parseInt(g.getPropertyValue("--com-item-border-width").trim());return n.width=x+2*c,n.height=w+2*c,n.groupData=[...t],n},rt=()=>{e.nextTick(()=>{const o=getComputedStyle(P.value),r=parseInt(o.getPropertyValue("--com-item-border-width").trim()),t=parseInt(o.getPropertyValue("--group-tit-height").trim());d.value.filter(n=>n.isGroup===!0).forEach(n=>{const l=n.width-2*r,x=n.height-2*r-(n.groupTit?t:0);n.groupData.forEach(u=>{u.width=l*u.groupW,u.x=l*u.groupX,u.height=x*u.groupH,u.y=x*u.groupY})})})},ot=()=>{const o=d.value.filter(r=>r.checked);if(o.length>1){const r={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},t=ae(o,r);return t.groupData.forEach(n=>{K(n.id)}),ie(t),O(),he(),B(d.value.filter(n=>n.id===t.id)[0])}return he(),null},Ce=(o,r)=>{const t=d.value.filter(n=>n.id===r)[0];if(t){const n=t.groupData.filter(l=>l.id===o)[0];if(n)return t.groupData.length===2?ee(r):(delete n.inGroupId,delete n.groupW,delete n.groupH,delete n.groupX,delete n.groupY,delete n.isObstacle,K(n.id,t.id),ie(n),O(),[B(d.value.filter(l=>l.id===o)[0])]);try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ee=o=>{const r=d.value.filter(t=>t.id===o)[0];if(r){let t=[];r.groupData.forEach(l=>{delete l.inGroupId,delete l.groupW,delete l.groupH,delete r.groupX,delete r.groupY,delete r.isObstacle,l.x+=r.x,l.y+=r.y,t.push(l.id),ie(l,null,!0)}),K(r.id),O();let n=[];return t.forEach(l=>{n.push(B(d.value.filter(x=>x.id===l)[0]))}),n}else try{}catch{}finally{return[]}},it=(o="",r)=>{const t=d.value.filter(n=>n.id===r)[0];if(t){if(!t.groupTit||!o){const l=getComputedStyle(P.value),x=parseInt(l.getPropertyValue("--group-tit-height").trim());t.groupTit&&!o&&(t.height-=x),!t.groupTit&&o&&(t.height+=x)}t.groupTit=o;const n=l=>{d.value.filter(u=>u.id!==l.id).filter(u=>u.x<l.x&&u.x+u.width>l.x||u.x===l.x||u.x>l.x&&u.x<l.x+l.width).filter(u=>u.y<l.y&&u.y+u.height>l.y||u.y===l.y||u.y>l.y&&u.y<l.y+l.height).forEach(u=>{u.y=l.y+l.height,n(u)})};n(t),O()}else try{}catch{}},nt=()=>(d.value.forEach(o=>{delete o.showPop,delete o.showSet,o.groupData&&o.groupData.forEach(r=>{delete r.showPop,delete r.showSet})}),{data:B(d.value),width:T});return e.onBeforeUnmount(()=>{me.unobserve(P.value),window.removeEventListener("click",j)}),W({init:Ze,addItem:ie,deleteItem:K,updateItem:ne,openGroup:De,closeGroup:he,changeGroupBorder:rt,addGroup:ot,removeGroupItem:Ce,removeGroup:ee,changeGroupTit:it,getData:nt}),(o,r)=>(e.openBlock(),e.createElementBlock("div",{class:"vue-drag-component-plus",ref_key:"pageRef",ref:P},[e.createElementVNode("div",{class:"content-box",ref_key:"boxRef",ref:Ue},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["com-item",m.seeModel||e.unref(I)||t.static===!0||t.dragable===!1?"":"can-drag",t.move?"is-move":"",t.drag?"is-drag":"",t.showPop?"on-top":"",m.seeModel?"no-hover":""]),style:e.normalizeStyle({width:t.width+"px",height:t.height+"px",top:t.y+"px",left:t.x+"px"}),key:n,onMousedown:e.withModifiers(l=>m.seeModel||e.unref(I)||t.static===!0||t.dragable===!1?null:Qe(l,n),["prevent"]),onMouseenter:l=>m.seeModel||e.unref(I)||e.unref(D)||e.unref(f)||!t.isGroup?null:je(l,t),onMouseleave:l=>m.seeModel||e.unref(I)||e.unref(D)||e.unref(f)||!t.isGroup?null:et(l,t)},[e.createElementVNode("div",ze,[t.isGroup?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t.groupTit?(e.openBlock(),e.createElementBlock("div",{key:0,class:"group-item-tit",title:t.groupTit},e.toDisplayString(t.groupTit),9,Ne)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["group-item-content",t.groupTit?"":"full"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.groupData,(l,x)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["com-item-box-child",l.isObstacle?"else":""]),style:e.normalizeStyle({width:l.width+"px",height:l.height+"px",top:l.y+"px",left:l.x+"px"}),key:x},[e.createElementVNode("div",Oe,[e.renderSlot(o.$slots,"item",{data:l},()=>[e.createElementVNode("p",null,e.toDisplayString(Math.round(l.width*100)/100)+","+e.toDisplayString(Math.round(l.height*100)/100),1),e.createElementVNode("p",null,e.toDisplayString(Math.round(l.x*100)/100)+","+e.toDisplayString(Math.round(l.y*100)/100),1)])]),!m.seeModel&&!e.unref(I)&&e.unref(D)===null&&e.unref(f)===null?(e.openBlock(),e.createElementBlock("div",{key:0,class:"setting-box",style:e.normalizeStyle({display:l.showPop?"flex":"none"}),onMousedown:e.withModifiers(u=>null,["prevent","stop"])},[e.createVNode(A,{iconObj:m.settingIcon,onClick:e.withModifiers(u=>Se(l),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):e.createCommentVNode("",!0),l.showPop?(e.openBlock(),e.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:e.withModifiers(u=>null,["prevent","stop"])},[e.renderSlot(o.$slots,"setPopNormal",{data:B(l)},()=>[e.createElementVNode("div",{class:"setting-box-pop-item",onClick:u=>Ce(l.id,l.inGroupId)},"移出组合",8,Ge),e.createElementVNode("div",{class:"setting-box-pop-item",onClick:u=>K(l.id,l.inGroupId)},"删除",8,Pe)])],32)):e.createCommentVNode("",!0)],6))),128))],2)],64)):(e.openBlock(),e.createElementBlock("div",Ie,[e.renderSlot(o.$slots,"item",{data:t},()=>[e.createElementVNode("p",null,e.toDisplayString(Math.round(t.width*100)/100)+","+e.toDisplayString(Math.round(t.height*100)/100),1),e.createElementVNode("p",null,e.toDisplayString(Math.round(t.x*100)/100)+","+e.toDisplayString(Math.round(t.y*100)/100),1)])])),!t.isGroup&&t.notGroup!==!0&&e.unref(I)?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["group-checkbox",t.checked?"is-checked":"",t.disabled?"disabled":""]),onClick:l=>t.disabled?null:lt(t)},null,10,We)):e.createCommentVNode("",!0),!m.seeModel&&!e.unref(I)&&e.unref(D)===null&&e.unref(f)===null?(e.openBlock(),e.createElementBlock("div",{key:3,class:e.normalizeClass(["setting-box",t.isGroup===!0?"only-g":""]),style:e.normalizeStyle({display:t.showPop||t.showSet?"flex":"none"}),onMousedown:e.withModifiers(l=>null,["prevent","stop"])},[e.createVNode(A,{iconObj:m.settingIcon,onClick:e.withModifiers(l=>Se(t),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):e.createCommentVNode("",!0),t.showPop?(e.openBlock(),e.createElementBlock("div",{key:4,class:e.normalizeClass(["setting-box-pop",t.isGroup===!0?"special":""]),onMousedown:e.withModifiers(l=>null,["prevent","stop"])},[t.isGroup===!0?e.renderSlot(o.$slots,"setPopSpecial",{key:0,data:B(t)},()=>[m.hideTit?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:l=>G("showTitPop",t.groupTit,t.id)}," 设置组合标题",8,He)),e.createElementVNode("div",{class:"setting-box-pop-item",onClick:l=>ee(t.id)},"解除组合",8,Te)]):e.renderSlot(o.$slots,"setPopNormal",{key:1,data:B(t)},()=>[t.notGroup!==!0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:l=>De(t.id)},"组合",8,Ye)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"setting-box-pop-item",onClick:l=>K(t.id)},"删除",8,ve)])],34)):e.createCommentVNode("",!0)]),!m.seeModel&&!e.unref(I)&&!t.showPop&&!t.move&&t.static!==!0&&t.resizable!==!1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(H).indexOf("topLeft")!==-1?(e.openBlock(),e.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:e.withModifiers(l=>v(l,t,"top-left"),["prevent","stop"])},null,40,Xe)):e.createCommentVNode("",!0),e.unref(H).indexOf("top")!==-1?(e.openBlock(),e.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:e.withModifiers(l=>v(l,t,"top"),["prevent","stop"])},null,40,Le)):e.createCommentVNode("",!0),e.unref(H).indexOf("topRight")!==-1?(e.openBlock(),e.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:e.withModifiers(l=>v(l,t,"top-right"),["prevent","stop"])},null,40,Re)):e.createCommentVNode("",!0),e.unref(H).indexOf("left")!==-1?(e.openBlock(),e.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:e.withModifiers(l=>v(l,t,"left"),["prevent","stop"])},null,40,$e)):e.createCommentVNode("",!0),e.unref(H).indexOf("right")!==-1?(e.openBlock(),e.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:e.withModifiers(l=>v(l,t,"right"),["prevent","stop"])},null,40,Ae)):e.createCommentVNode("",!0),e.unref(H).indexOf("bottomLeft")!==-1?(e.openBlock(),e.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:e.withModifiers(l=>v(l,t,"bottom-left"),["prevent","stop"])},null,40,_e)):e.createCommentVNode("",!0),e.unref(H).indexOf("bottom")!==-1?(e.openBlock(),e.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:e.withModifiers(l=>v(l,t,"bottom"),["prevent","stop"])},null,40,be)):e.createCommentVNode("",!0),e.unref(H).indexOf("bottomRight")!==-1?(e.openBlock(),e.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:e.withModifiers(l=>v(l,t,"bottom-right"),["prevent","stop"])},null,40,Fe)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],46,Ve))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["shadow-bg",t.move?"is-move":""]),style:e.normalizeStyle({width:t.width+"px",height:t.height+"px",top:t.y+"px",left:t.x+"px"}),key:n},null,6))),128)),e.unref(D)!==null?(e.openBlock(),e.createElementBlock("div",{key:0,class:"drag-bg",style:e.normalizeStyle({width:e.unref(V).width+"px",height:e.unref(V).height+"px",top:e.unref(V).y+"px",left:e.unref(V).x+"px"})},null,4)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"height-bg",style:e.normalizeStyle({height:(e.unref(q)>0?+(e.unref(q)+(m.seeModel?m.seeModelMinBg:220)):e.unref(q))+"px"})},null,4),m.hideAuxiliary?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(U)!==null?(e.openBlock(),e.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:e.normalizeStyle({top:e.unref(U)+"px",left:"0px"})},null,4)):e.createCommentVNode("",!0),e.unref(J)!==null?(e.openBlock(),e.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:e.normalizeStyle({top:e.unref(J)+"px",left:"0px"})},null,4)):e.createCommentVNode("",!0),e.unref(Q)!==null?(e.openBlock(),e.createElementBlock("div",{key:2,class:"auxiliary-line",style:e.normalizeStyle({top:"0px",left:e.unref(Q)+"px"})},null,4)):e.createCommentVNode("",!0),e.unref(Z)!==null?(e.openBlock(),e.createElementBlock("div",{key:3,class:"auxiliary-line",style:e.normalizeStyle({top:"0px",left:e.unref(Z)+"px"})},null,4)):e.createCommentVNode("",!0)],64)),e.unref(d).length===0?(e.openBlock(),e.createElementBlock("div",Ke,[e.renderSlot(o.$slots,"empty",{},()=>[r[0]||(r[0]=e.createTextVNode(" 暂无数据 "))])])):e.createCommentVNode("",!0)],512)],512))}}],de={install(m){qe.forEach(W=>{m.component("vueDragComponentPlus",W)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(de),de});
