(function(e,N){typeof exports=="object"&&typeof module<"u"?module.exports=N(require("vue")):typeof define=="function"&&define.amd?define(["vue"],N):(e=typeof globalThis<"u"?globalThis:e||self,e.vueDragComponentPlus=N(e.Vue))})(this,function(e){"use strict";const N={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(p){return(V,q)=>{const I=e.resolveComponent("el-icon");return p.iconObj.type==="custom"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(p.iconObj.icon),e.normalizeProps(e.mergeProps({key:0},p.iconObj.attrs)),null,16)):p.iconObj.type==="el"?(e.openBlock(),e.createBlock(I,e.normalizeProps(e.mergeProps({key:1},p.iconObj.attrs)),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(p.iconObj.icon)))]),_:1},16)):p.iconObj.type==="iconfont"?(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:2,class:["icon iconfont","icon-"+p.iconObj.icon]},p.iconObj.attrs),null,16)):(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:3,class:p.iconObj.type},p.iconObj.attrs),e.toDisplayString(p.iconObj.icon),17))}}},Ie="",ce=["onMousedown"],ae={class:"com-item-content"},de=["onClick"],he=["onClick"],fe=["onClick"],pe=["onClick"],ge=["onClick"],ue=["onClick"],ye=["onMousedown"],me=["onMousedown"],we=["onMousedown"],ke=["onMousedown"],xe=["onMousedown"],Me=["onMousedown"],be=["onMousedown"],Be=["onMousedown"],Ee={key:1,class:"com-empty"},Ce=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},itemMinWidth:{type:Number,default:15,validator(p,V){return p>=15}},itemMinHeight:{type:Number,default:15,validator(p,V){return p>=15}},settingIcon:{type:Object,default:()=>({icon:"设置"})}},emits:["showGroup","updateChecked"],setup(p,{expose:V,emit:q}){const I=q,a=p,k=l=>{let n=l instanceof Array?[]:{};for(let o in l)n[o]=typeof l[o]=="object"?k(l[o]):l[o];return n},U=()=>{a.insertResizeKeys.forEach(l=>{a.excludeResizeKeys.indexOf(l)===-1&&x.value.push(l)})};e.watch(()=>[a.insertResizeKeys,a.excludeResizeKeys],()=>{U()});const x=e.ref([]);U();const S=e.ref(null);let B=null,W=null;const H=e.ref(null),_=e.ref(0),r=e.ref([]);let s=null,J=null,Q=null;const y=e.ref({}),ze=(l,n)=>{R(),s=n,y.value=k(r.value[s]),r.value[s].move=!0,J=l.clientX-l.target.offsetParent.offsetLeft,Q=l.clientY-l.target.offsetParent.offsetTop,window.addEventListener("mousemove",Z),window.addEventListener("mouseup",ee)},Z=l=>{const n=l.clientX-J,o=l.clientY-Q,i=n<=M("left")?M("left"):n>=M("right")?M("right"):n,t=o<=M("top")?M("top"):o>=M("bottom")?M("bottom"):o;t>r.value[s].y&&t>W-r.value[s].height-30&&H.value.scrollBy(0,20),t<r.value[s].y&&t-H.value.scrollTop<30&&H.value.scrollBy(0,-20),r.value[s].x=i,r.value[s].y=t,setTimeout(()=>{r.value.filter(d=>d.static===!0).filter(d=>d.x===i&&d.width===r.value[s].width||d.x>i&&d.x<i+r.value[s].width||d.x+d.width>i&&d.x+d.width<i+r.value[s].width).filter(d=>d.y===t&&d.height===r.value[s].height||d.y>t&&d.y<t+r.value[s].height||d.y+d.height>t&&d.y+d.height<t+r.value[s].height).length===0?(y.value.x=i,y.value.y=t):(r.value.filter(c=>c.static===!0).filter(c=>c.x===i&&c.width===r.value[s].width||c.x>i&&c.x<i+r.value[s].width||c.x+c.width>i&&c.x+c.width<i+r.value[s].width).filter(c=>c.y===r.value[s].y&&c.height===r.value[s].height||c.y>r.value[s].y&&c.y<r.value[s].y+r.value[s].height||c.y+c.height>r.value[s].y&&c.y+c.height<r.value[s].y+r.value[s].height).length===0&&(y.value.x=i),r.value.filter(c=>c.static===!0).filter(c=>c.x===r.value[s].x&&c.width===r.value[s].width||c.x>r.value[s].x&&c.x<r.value[s].x+r.value[s].width||c.x+c.width>r.value[s].x&&c.x+c.width<r.value[s].x+r.value[s].width).filter(c=>c.y===t&&c.height===r.value[s].height||c.y>t&&c.y<t+r.value[s].height||c.y+c.height>t&&c.y+c.height<t+r.value[s].height).length===0&&(y.value.y=t)),m()},30)},ee=()=>{window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",ee),setTimeout(()=>{delete r.value[s].move,r.value[s].x=y.value.x,r.value[s].y=y.value.y,s=null},30)},M=l=>{switch(l){case"top":return 0;case"right":return B-r.value[s].width;case"bottom":return 999999999;case"left":return 0}};let g=null,X="",v=0,L=0,E=0,C=0,z=0,O=0,D=0,$=0,P=0,T=0;const b=(l,n,o)=>{R(),g=n,X=o,v=l.clientX,L=l.clientY,E=n.width,C=n.height,z=n.y,O=n.x,g.drag=!0;const i=r.value.filter(h=>h.static===!0&&(h.x<n.x?h.x+h.width>=n.x:h.x<=n.x+n.width)),t=r.value.filter(h=>h.static===!0&&(h.y<n.y?h.y+h.height>=n.y:h.y<=n.y+n.height)),u=i.filter(h=>h.y+h.height<=n.y).map(h=>h.y+h.height);u.length>0?D=Math.max(...u):D=0;const d=i.filter(h=>h.y>=n.y+n.height).map(h=>h.y);d.length>0?$=Math.min(...d):$=0;const F=t.filter(h=>h.x+h.width<=n.x).map(h=>h.x+h.width);F.length>0?P=Math.max(...F):P=0;const c=t.filter(h=>h.x>=n.x+n.width).map(h=>h.x);c.length>0?T=Math.min(...c):T=0,window.addEventListener("mousemove",te),window.addEventListener("mouseup",oe)},te=l=>{const n=E+(l.clientX-v),o=C+(l.clientY-L),i=E-(l.clientX-v),t=C-(l.clientY-L),u=z+(l.clientY-L),d=O+(l.clientX-v);switch(X){case"top-left":g.height=t<a.itemMinHeight?a.itemMinHeight:t>f("top")?f("top"):t,g.y=t<a.itemMinHeight?z+C-a.itemMinHeight:t>f("top")?D:u,g.width=i<a.itemMinWidth?a.itemMinWidth:i>f("left")?f("left"):i,g.x=i<a.itemMinWidth?O+E-a.itemMinWidth:i>f("left")?P:d;break;case"top":g.height=t<a.itemMinHeight?a.itemMinHeight:t>f("top")?f("top"):t,g.y=t<a.itemMinHeight?z+C-a.itemMinHeight:t>f("top")?D:u;break;case"top-right":g.height=t<a.itemMinHeight?a.itemMinHeight:t>f("top")?f("top"):t,g.y=t<a.itemMinHeight?z+C-a.itemMinHeight:t>f("top")?D:u,g.width=n<a.itemMinWidth?a.itemMinWidth:n>f("right")?f("right"):n;break;case"left":g.width=i<a.itemMinWidth?a.itemMinWidth:i>f("left")?f("left"):i,g.x=i<a.itemMinWidth?O+E-a.itemMinWidth:i>f("left")?P:d;break;case"right":g.width=n<a.itemMinWidth?a.itemMinWidth:n>f("right")?f("right"):n;break;case"bottom-left":g.height=o<a.itemMinHeight?a.itemMinHeight:o>f("bottom")?f("bottom"):o,g.width=i<a.itemMinWidth?a.itemMinWidth:i>f("left")?f("left"):i,g.x=i<a.itemMinWidth?O+E-a.itemMinWidth:i>f("left")?P:d;break;case"bottom":g.height=o<a.itemMinHeight?a.itemMinHeight:o>f("bottom")?f("bottom"):o;break;case"bottom-right":g.height=o<a.itemMinHeight?a.itemMinHeight:o>f("bottom")?f("bottom"):o,g.width=n<a.itemMinWidth?a.itemMinWidth:n>f("right")?f("right"):n;break}m(),H.value.scrollTo(0,_.value-W)},oe=l=>{delete g.drag,X="",g=null,window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",oe)},f=l=>{switch(l){case"top":return z+C-D;case"left":return O+E-P;case"right":return(T>0?T:B)-O;case"bottom":return $>0?$-z:999999999}},m=()=>{const l=r.value.map(n=>n.y+n.height);l.length>0?_.value=Math.max(...l)+50:_.value=0};e.onMounted(()=>{ne.observe(S.value)});const ne=new ResizeObserver(l=>{Ve(B===l[0].contentRect.width?null:l[0].contentRect.width,W===l[0].contentRect.height?null:l[0].contentRect.height)});let Y=!1;const Oe=(l=[],n=null)=>{r.value=k(l),n!==null?e.nextTick(()=>{const i=S.value.getBoundingClientRect().width/n;r.value.forEach(t=>{t.width*=i,t.height*=i,t.x*=i,t.y*=i}),m()}):m(),Y=!0,setTimeout(()=>{Y=!1},500)},A=(l,n=null,o=!1)=>{const i=k(l);if(i.id||(i.id=new Date().getTime()+""),o!==!0&&!n){i.x=0;const t=r.value.map(u=>u.y+u.height);t.length>0?i.y=Math.max(...t):i.y=0}if(n){const t=r.value.filter(u=>u.id===n);if(t.length===1)t[0].groupData.push(i);else try{}catch{}}else r.value.push(i);m()},G=(l,n=null)=>{let o=-1;const i=r.value.filter(t=>t.id===n);if(n?i.length===1&&(o=i[0].groupData.findIndex(t=>t.id===l)):o=r.value.findIndex(t=>t.id===l),o!==-1)n?i[0].groupData.splice(o,1):r.value.splice(o,1),m();else try{}catch{}},Ne=l=>{if(l.id){const n=k(l);let o=-1;const i=r.value.filter(t=>t.id===n.inGroupId);if(n.inGroupId?i.length===1&&(o=i[0].groupData.findIndex(t=>t.id===n.id)):o=r.value.findIndex(t=>t.id===n.id),o!==-1)n.inGroupId?i[0].groupData[o]=n:r.value[o]=n,m();else try{}catch{}}else try{}catch{}},Ve=(l,n)=>{if(l!==null){const o=B?l/B:1;B=l,Y||(r.value.forEach(i=>{i.width*=o,i.height*=o,i.x*=o,i.y*=o}),m())}n!==null&&(W=n)},le=l=>{l.showPop||(r.value.forEach(n=>{delete n.showPop,n.groupData&&n.groupData.forEach(o=>{delete o.showPop})}),l.showPop=!0,window.addEventListener("click",R))},R=()=>{r.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(n=>{delete n.showPop})}),window.removeEventListener("click",R)},w=e.ref(!1),ie=l=>{const n=r.value.findIndex(o=>o.id===l);if(n!==-1)r.value[n].checked=!0,r.value[n].disabled=!0,w.value=!0,I("showGroup",w.value);else try{}catch{}},re=()=>{w.value=!1,r.value.forEach(l=>{delete l.checked,delete l.disabled,l.groupData&&l.groupData.forEach(n=>{delete n.checked,delete n.disabled})}),I("showGroup",w.value)},De=l=>{l.checked=!l.checked,I("updateChecked",r.value.filter(n=>n.checked).length)},Pe=()=>{const l=r.value.filter(n=>n.checked);if(l.length>1){const n={id:new Date().getTime()+"G",isGroup:!0,width:200,height:200,groupData:[]};l.forEach(o=>{G(o.id),o.inGroupId=n.id,n.groupData.push(o)}),A(n),m()}re()},se=(l,n)=>{const o=r.value.filter(i=>i.id===n)[0];if(o){const i=o.groupData.filter(t=>t.id===l)[0];if(i)delete i.inGroupId,A(i),G(i.id,o.id),o.groupData.length<2&&K(n),m();else try{}catch{}}else try{}catch{}},K=l=>{const n=r.value.filter(o=>o.id===l)[0];if(n)G(n.id),n.groupData.forEach(o=>{delete o.inGroupId,A(o,null,!0)}),m();else try{}catch{}},Ge=()=>({data:k(r.value),width:B});return e.onBeforeUnmount(()=>{ne.unobserve(S.value),window.removeEventListener("click",R)}),V({init:Oe,addItem:A,deleteItem:G,updateItem:Ne,openGroup:ie,closeGroup:re,addGroup:Pe,removeGroupItem:se,removeGroup:K,getData:Ge}),(l,n)=>(e.openBlock(),e.createElementBlock("div",{class:"vue-drag-component-plus",ref_key:"pageRef",ref:S},[e.createElementVNode("div",{class:"content-box",ref_key:"boxRef",ref:H},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(o,i)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["com-item",p.seeModel||e.unref(w)||o.static===!0||o.dragable===!1?"":"can-drag",o.move?"is-move":"",o.drag?"is-drag":"",o.showPop?"on-top":""]),style:e.normalizeStyle({width:o.width+"px",height:o.height+"px",top:o.y+"px",left:o.x+"px"}),key:i,onMousedown:e.withModifiers(t=>p.seeModel||e.unref(w)||o.static===!0||o.dragable===!1?null:ze(t,i),["prevent"])},[e.createElementVNode("div",ae,[o.isGroup?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createTextVNode(" 123 "),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.groupData,(t,u)=>(e.openBlock(),e.createElementBlock("div",{class:"com-item-content-child",style:e.normalizeStyle({width:t.width+"px",height:t.height+"px",top:t.y+"px",left:t.x+"px"}),key:u},[e.renderSlot(l.$slots,"item",{data:t},()=>[e.createTextVNode(e.toDisplayString(i),1)]),!p.seeModel&&!e.unref(w)&&e.unref(s)===null&&e.unref(g)===null?(e.openBlock(),e.createElementBlock("div",{key:0,class:"setting-box",style:e.normalizeStyle({display:t.showPop?"flex":"none"}),onMousedown:e.withModifiers(d=>null,["prevent","stop"])},[e.createVNode(N,{iconObj:p.settingIcon,onClick:e.withModifiers(d=>le(t),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):e.createCommentVNode("",!0),t.showPop?(e.openBlock(),e.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:e.withModifiers(d=>null,["prevent","stop"])},[e.renderSlot(l.$slots,"setPopNormal",{data:k(t)},()=>[e.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>se(t.id,t.inGroupId)},"移出组合",8,de),e.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>G(t.id,t.inGroupId)},"删除",8,he)])],32)):e.createCommentVNode("",!0)],4))),128))],64)):e.renderSlot(l.$slots,"item",{key:1,data:o},()=>[e.createTextVNode(e.toDisplayString(i),1)]),!o.isGroup&&o.notGroup!==!0&&e.unref(w)?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["group-checkbox",o.checked?"is-checked":"",o.disabled?"disabled":""]),onClick:t=>o.disabled?null:De(o)},null,10,fe)):e.createCommentVNode("",!0),!p.seeModel&&!e.unref(w)&&e.unref(s)===null&&e.unref(g)===null?(e.openBlock(),e.createElementBlock("div",{key:3,class:"setting-box",style:e.normalizeStyle({display:o.showPop?"flex":"none"}),onMousedown:e.withModifiers(t=>null,["prevent","stop"])},[e.createVNode(N,{iconObj:p.settingIcon,onClick:e.withModifiers(t=>le(o),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):e.createCommentVNode("",!0),o.showPop?(e.openBlock(),e.createElementBlock("div",{key:4,class:"setting-box-pop",onMousedown:e.withModifiers(t=>null,["prevent","stop"])},[o.isGroup===!0?e.renderSlot(l.$slots,"setPopSpecial",{key:0,data:k(o)},()=>[e.createElementVNode("div",{class:"setting-box-pop-item",onClick:t=>K(o.id)},"解除组合",8,pe)]):e.renderSlot(l.$slots,"setPopNormal",{key:1,data:k(o)},()=>[o.notGroup!==!0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:t=>ie(o.id)},"组合",8,ge)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"setting-box-pop-item",onClick:t=>G(o.id)},"删除",8,ue)])],32)):e.createCommentVNode("",!0)]),!p.seeModel&&!e.unref(w)&&!o.move&&o.static!==!0&&o.resizable!==!1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(x).indexOf("topLeft")!==-1?(e.openBlock(),e.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:e.withModifiers(t=>b(t,o,"top-left"),["prevent","stop"])},null,40,ye)):e.createCommentVNode("",!0),e.unref(x).indexOf("top")!==-1?(e.openBlock(),e.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:e.withModifiers(t=>b(t,o,"top"),["prevent","stop"])},null,40,me)):e.createCommentVNode("",!0),e.unref(x).indexOf("topRight")!==-1?(e.openBlock(),e.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:e.withModifiers(t=>b(t,o,"top-right"),["prevent","stop"])},null,40,we)):e.createCommentVNode("",!0),e.unref(x).indexOf("left")!==-1?(e.openBlock(),e.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:e.withModifiers(t=>b(t,o,"left"),["prevent","stop"])},null,40,ke)):e.createCommentVNode("",!0),e.unref(x).indexOf("right")!==-1?(e.openBlock(),e.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:e.withModifiers(t=>b(t,o,"right"),["prevent","stop"])},null,40,xe)):e.createCommentVNode("",!0),e.unref(x).indexOf("bottomLeft")!==-1?(e.openBlock(),e.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:e.withModifiers(t=>b(t,o,"bottom-left"),["prevent","stop"])},null,40,Me)):e.createCommentVNode("",!0),e.unref(x).indexOf("bottom")!==-1?(e.openBlock(),e.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:e.withModifiers(t=>b(t,o,"bottom"),["prevent","stop"])},null,40,be)):e.createCommentVNode("",!0),e.unref(x).indexOf("bottomRight")!==-1?(e.openBlock(),e.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:e.withModifiers(t=>b(t,o,"bottom-right"),["prevent","stop"])},null,40,Be)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)],46,ce))),128)),e.unref(s)!==null?(e.openBlock(),e.createElementBlock("div",{key:0,class:"drag-bg",style:e.normalizeStyle({width:e.unref(y).width+"px",height:e.unref(y).height+"px",top:e.unref(y).y+"px",left:e.unref(y).x+"px"})},null,4)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"height-bg",style:e.normalizeStyle({height:e.unref(_)+"px"})},null,4),e.unref(r).length===0?(e.openBlock(),e.createElementBlock("div",Ee,[e.renderSlot(l.$slots,"empty",{},()=>[e.createTextVNode(" 暂无数据 ")])])):e.createCommentVNode("",!0)],512)],512))}}],j={install(p){Ce.forEach(V=>{p.component("vueDragComponentPlus",V)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(j),j});
