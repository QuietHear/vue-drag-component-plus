(function(t,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("vue")):typeof define=="function"&&define.amd?define(["vue"],j):(t=typeof globalThis<"u"?globalThis:t||self,t.vueDragComponentPlus=j(t.Vue))})(this,function(t){"use strict";const j={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(y){return(A,ze)=>{const V=t.resolveComponent("el-icon");return y.iconObj.type==="custom"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(y.iconObj.icon),t.normalizeProps(t.mergeProps({key:0},y.iconObj.attrs)),null,16)):y.iconObj.type==="el"?(t.openBlock(),t.createBlock(V,t.normalizeProps(t.mergeProps({key:1},y.iconObj.attrs)),{default:t.withCtx(()=>[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(y.iconObj.icon)))]),_:1},16)):y.iconObj.type==="iconfont"?(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:2,class:["icon iconfont","icon-"+y.iconObj.icon]},y.iconObj.attrs),null,16)):(t.openBlock(),t.createElementBlock("i",t.mergeProps({key:3,class:y.iconObj.type},y.iconObj.attrs),t.toDisplayString(y.iconObj.icon),17))}}},Nt="",qe={class:"content-box"},Ue=["onMousedown","onMouseenter","onMouseleave"],Je={class:"com-item-box"},Qe=["title"],Ze={class:"com-item-box-content"},je=["onClick"],et=["onClick"],tt=["onClick"],ot={key:1,class:"com-item-box-content"},lt=["onClick"],st=["onClick"],rt=["onClick"],nt=["onClick"],it=["onClick"],at=["onClick"],ct=["onMousedown"],dt=["onMousedown"],ht=["onMousedown"],ut=["onMousedown"],pt=["onMousedown"],ft=["onMousedown"],gt=["onMousedown"],yt=["onMousedown"],_t={key:2,class:"com-empty"},xt=[{__name:"index",props:{insertResizeKeys:{type:Array,default:()=>["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"]},excludeResizeKeys:{type:Array,default:()=>[]},seeModel:{type:Boolean,default:!1},seeModelMinBg:{type:Number,default:50,validator(y,A){return y>=0}},itemMinWidth:{type:Number,default:15,validator(y,A){return y>=15}},itemMinHeight:{type:Number,default:15,validator(y,A){return y>=15}},xSpace:{type:Number,default:10,validator(y,A){return y>=0}},ySpace:{type:Number,default:null,validator(y,A){return y>=0}},settingIcon:{type:Object,default:()=>({icon:"设置"})},hideTit:{type:Boolean,default:!1},showAuxiliary:{type:Boolean,default:!1},groupBtnPosMore:{type:Boolean,default:!1}},emits:["baseWidthInit","changeScle","dragStart","dragIng","dragEnd","resizeStart","resizeIng","resizeEnd","showGroup","openSetMenu","updateChecked","showTitPop"],setup(y,{expose:A,emit:ze}){const V=ze,D=y,S=l=>{if(typeof l=="object"&&!t.isVNode(l)&&l!==null&&!(l instanceof Date)){let o=l instanceof Array?[]:{};for(let e in l)o[e]=typeof l[e]=="object"&&!t.isVNode(l[e])&&l[e]!==null&&!(l[e]instanceof Date)?S(l[e]):l[e];return o}else return l},ye=(l,o,e=!1)=>wt(F(l,o,e),o,e),F=(l,o,e=!1)=>l.filter(r=>r[e?"s_x":"x"]<=o[e?"s_x":"x"]&&r[e?"s_x":"x"]+r[e?"s_width":"width"]>o[e?"s_x":"x"]||r[e?"s_x":"x"]>o[e?"s_x":"x"]&&r[e?"s_x":"x"]<o[e?"s_x":"x"]+o[e?"s_width":"width"]),wt=(l,o,e=!1)=>l.filter(r=>r[e?"s_y":"y"]<=o[e?"s_y":"y"]&&r[e?"s_y":"y"]+r[e?"s_height":"height"]>o[e?"s_y":"y"]||r[e?"s_y":"y"]>o[e?"s_y":"y"]&&r[e?"s_y":"y"]<o[e?"s_y":"y"]+o[e?"s_height":"height"]),q=(l,o=r=>r,e=!1)=>{const r=S(n.value),s=S(l);s.sort((d,k)=>{const u=d[e?"s_y":"y"],f=k[e?"s_y":"y"];if(u!==f)return u-f;{const i=d[e?"s_x":"x"],x=k[e?"s_x":"x"];return i-x}});const c=d=>{ye(o(r,d),d,e).forEach(u=>{u[e?"s_y":"y"]=d[e?"s_y":"y"]+d[e?"s_height":"height"],c(u)})};s.forEach(d=>c(r.filter(k=>k.id===d.id)[0])),r.forEach(d=>{n.value.filter(k=>k.id===d.id)[0][e?"s_y":"y"]=d[e?"s_y":"y"]})},I=l=>{const o=S(l);return delete o.showPop,delete o.showSet,o.groupData?o.groupData.forEach(e=>{delete e.showPop,delete e.showSet,R(e,o),delete e.s_width,delete e.s_height,delete e.s_x,delete e.s_y}):o.inGroupId&&(delete o.showPop,delete o.showSet,R(o,n.value.filter(e=>e.id===o.inGroupId)[0])),delete o.btnPosition,delete o.s_width,delete o.s_height,delete o.s_x,delete o.s_y,o},n=t.ref([]),Ve=()=>{D.insertResizeKeys.forEach(l=>{D.excludeResizeKeys.indexOf(l)===-1&&H.value.push(l)})};t.watch(()=>[D.insertResizeKeys,D.excludeResizeKeys],()=>{Ve()});const H=t.ref([]);Ve();const Ie=()=>{n.value.length>0&&n.value.filter(l=>l.isGroup===!0).forEach(l=>{te(l)})},Ne=()=>{D.xSpace!==null&&D.xSpace!==void 0?G.value=D.xSpace/2:G.value=10/2,D.ySpace!==null&&D.ySpace!==void 0&&D.ySpace>=0?L.value=D.ySpace/2:L.value=G.value,Ie()};t.watch(()=>[D.xSpace,D.ySpace],()=>{Ne()});const G=t.ref(0),L=t.ref(0);Ne();const T=t.ref(null);let ee=null;const ie=l=>{ee=l,V("baseWidthInit",ee)},E=t.ref(1),ae=l=>{E.value=l,V("changeScle",E.value)},te=l=>{l.s_width=l.width*E.value,l.s_height=l.height*E.value;const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--com-item-border-width").trim()),r=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const s=l.s_width-2*G.value*E.value-2*e,c=l.s_height-2*L.value*E.value-2*e-(l.groupTit?r:0);l.groupData.forEach(d=>{d.s_width=s*d.groupW,d.s_height=c*d.groupH,d.s_x=s*d.groupX,d.s_y=c*d.groupY})}},kt=l=>{l.s_x=l.x*E.value,l.s_y=l.y*E.value},mt=l=>{l.width=l.s_width/E.value,l.height=l.s_height/E.value;const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--group-tit-height").trim());if(l.isGroup===!0){const r=l.width,s=l.height-(l.groupTit?e:0);l.groupData.forEach(c=>{c.x=r*c.groupX,c.y=s*c.groupY})}},Me=l=>{l.x=l.s_x/E.value,l.y=l.s_y/E.value};let X=null,Ge=null;const ce=t.ref(0),de=t.ref(null),he=t.ref(null),ue=t.ref(null),pe=t.ref(null),oe=l=>{const o=S(l);if(!D.showAuxiliary||l===null)de.value=null,he.value=null,ue.value=null,pe.value=null;else{const e=getComputedStyle(T.value),r=parseInt(e.getPropertyValue("--auxiliary-width").trim()),s=n.value.filter(i=>i.id!==o.id).map(i=>i.s_y),c=n.value.filter(i=>i.id!==o.id).map(i=>i.s_y+i.s_height),d=[...s,...c];d.sort(),d.filter(i=>i===o.s_y).length>0?de.value=o.s_y:de.value=null,d.filter(i=>i===o.s_y+o.s_height).length>0?he.value=o.s_y+o.s_height-r:he.value=null;const k=n.value.filter(i=>i.id!==o.id).map(i=>i.s_x),u=n.value.filter(i=>i.id!==o.id).map(i=>i.s_x+i.s_width),f=[...k,...u];f.sort(),f.filter(i=>i===o.s_x).length>0?ue.value=o.s_x:ue.value=null,f.filter(i=>i===o.s_x+o.s_width).length>0?pe.value=o.s_x+o.s_width-r:pe.value=null}},Et=(l,o)=>{let e=l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector;for(;l&&!e.call(l,o);)l=l.parentElement;return l};let b=null,Te=null,Oe=null;const B=t.ref({});let be=null;const Mt=(l,o)=>{clearTimeout(be),fe(),b=o,B.value=S(n.value[b]),V("dragStart",I(n.value[b])),n.value[b].move=!0,oe(n.value[b]);const e=Et(l.target,".com-item");Te=l.clientX-e.offsetLeft,Oe=l.clientY-e.offsetTop,window.addEventListener("mousemove",Ye),window.addEventListener("mouseup",Ae)},Ye=l=>{clearTimeout(be);const o=l.clientX-Te,e=l.clientY-Oe,r=o<=$("left")?$("left"):o>=$("right")?$("right"):o,s=e<=$("top")?$("top"):e>=$("bottom")?$("bottom"):e,c=r-n.value[b].s_x,d=s-n.value[b].s_y;let k="";d>0?k="bottom":d<0?k="top":c>2?k="right":c<-2&&(k="left"),n.value[b].s_x=r,n.value[b].s_y=s,oe(n.value[b]);let u=ye(S(n.value.filter(f=>f.move!==!0)),n.value[b],!0);if(u.length===0)B.value.s_x=r,B.value.s_y=s;else switch(k){case"top":u=u.filter(a=>a.s_y<B.value.s_y);const f=Math.min(...u.map(a=>a.s_y+a.s_height));u.forEach(a=>{Math.abs(a.s_y+a.s_height-f)<5&&(a.s_y=f-a.s_height)});let i=B.value.s_y-s,x=!0,p=[...u];const M=a=>{F(S(n.value.filter(h=>h.move!==!0&&Math.abs(h.s_y+h.s_height-a.s_y)<=3)),a,!0).forEach(h=>{p.findIndex(g=>g.id===h.id)===-1&&(p.push(h),M(h))})};if(u.forEach(a=>{M(a)}),p.sort((a,w)=>{const h=a.s_y,g=w.s_y;return h-g}),(p.length===0||p.filter(a=>a.s_y===0).length>0)&&(x=!1),x){let a=0;p.filter(h=>h.s_y===p[0].s_y).forEach(h=>{F(S(n.value.filter(C=>C.move!==!0&&C.s_y+C.s_height<h.s_y)),h,!0).forEach(C=>{C.s_y+C.s_height>a&&(a=C.s_y+C.s_height)})}),a=p[0].s_y-a,a<i&&(i=a),p.forEach(h=>{h.s_y-=i,n.value.filter(g=>g.id===h.id)[0].s_y=h.s_y}),B.value.s_x=r,B.value.s_y=n.value.filter(h=>h.id===p[p.length-1].id)[0].s_y+n.value.filter(h=>h.id===p[p.length-1].id)[0].s_height}else{let a=0;u.forEach(g=>{const C=F(n.value.filter(z=>z.move!==!0),g,!0).filter(z=>z.s_y>g.s_y+g.s_height);C.length>0&&(a=Math.min(...C.map(z=>z.s_y)))});const w=a===0?0:a-B.value.s_height-(Math.max(...u.map(g=>g.s_y+g.s_height))-Math.min(...u.map(g=>g.s_y))),h=w===0?s+B.value.s_height-Math.min(...u.map(g=>g.s_y)):a-Math.min(...u.map(g=>g.s_y))-(Math.max(...u.map(g=>g.s_y+g.s_height))-Math.min(...u.map(g=>g.s_y)));(w===0||s<=w)&&(u.filter(g=>g.s_y<B.value.s_y).forEach(g=>{g.s_y+=h,n.value.filter(C=>C.id===g.id)[0].s_y=g.s_y}),B.value.s_x=r,B.value.s_y=s,q(n.value,(g,C)=>g.filter(z=>z.move!==!0&&z.id!==C.id),!0))}break;case"bottom":let P=0;u.forEach(a=>{const w=F(n.value.filter(h=>h.move!==!0),a,!0).filter(h=>h.s_y+h.s_height<a.s_y);w.length>0&&(P=Math.max(...w.map(h=>h.s_y+h.s_height)))});const N=P+(Math.max(...u.map(a=>a.s_height+a.s_y))-Math.min(...u.map(a=>a.s_y))),v=Math.min(...u.map(a=>a.s_y))-P;s>=N&&(u.filter(a=>a.s_y>B.value.s_y).forEach(a=>{a.s_y-=v,n.value.filter(h=>h.id===a.id)[0].s_y=a.s_y;const w=ye(n.value.filter(h=>h.move!==!0&&h.id!==a.id),a,!0);w.length>0&&(a.s_y=Math.max(...w.map(h=>h.s_y+h.s_height)),n.value.filter(h=>h.id===a.id)[0].s_y=a.s_y)}),B.value.s_x=r,B.value.s_y=N,q(n.value,(a,w)=>a.filter(h=>h.move!==!0&&h.id!==w.id),!0));break;case"left":case"right":u.sort((a,w)=>{const h=a.s_y,g=w.s_y;return h-g});let K=!0;for(let a=0;a<u.length;a++){if(K){const w=S(n.value);for(let h=0;h<=a;h++){let g=null;const C=F(w.filter(z=>z.move!==!0&&z.s_y<u[h].s_y),u[h],!0);if(C.length===0?g=0:g=Math.max(...C.map(z=>z.s_y+z.s_height)),h===a){if(u[h].s_y-(u[h].s_y+u[h].s_height-s)<g){K=!1;break}}else if(u[h].s_y-u[a].s_height<g){K=!1;break}else w.filter(z=>z.id===u[h].id)[0].s_y-=u[a].s_height}}if(K){u[a].s_y-=u[a].s_y+u[a].s_height-s,n.value.filter(w=>w.id===u[a].id)[0].s_y=u[a].s_y;for(let w=a;w>0;w--)u[a-1].s_y-=u[a].s_height,n.value.filter(h=>h.id===u[a-1].id)[0].s_y=u[a-1].s_y}else u.filter(w=>w.id===u[a].id).forEach(w=>{w.s_y+=n.value[b].s_y+n.value[b].s_height-w.s_y,n.value.filter(h=>h.id===w.id)[0].s_y=w.s_y,q([w],(h,g)=>h.filter(C=>C.move!==!0&&C.id!==g.id),!0)})}B.value.s_x=r;break}n.value.forEach(f=>{Me(f)}),Y(!1),V("dragIng",I(n.value[b]))},Ae=()=>{window.removeEventListener("mousemove",Ye),window.removeEventListener("mouseup",Ae),delete n.value[b].move,n.value[b].s_x=B.value.s_x,n.value[b].s_y=B.value.s_y,oe(null),n.value.forEach(l=>{Me(l)}),Y(),V("dragEnd",I(n.value[b])),b=null,be=setTimeout(()=>{Y()},500)},$=l=>{switch(l){case"top":return 0;case"right":return X-G.value*2*E.value-n.value[b].s_width;case"bottom":return 999999999;case"left":return 0}};let _=null,Se="",_e=0,xe=0,U=0,J=0,Q=0,Z=0,le=0,we=0,se=0,ke=0;const W=(l,o,e)=>{fe(),_=o,V("resizeStart",I(_)),Se=e,_e=l.clientX,xe=l.clientY,U=o.s_width,J=o.s_height,Q=o.s_y,Z=o.s_x,_.drag=!0,oe(_);const r=n.value.filter(f=>f.static===!0&&(f.s_x<o.s_x?f.s_x+f.s_width>=o.s_x:f.s_x<=o.s_x+o.s_width)),s=n.value.filter(f=>f.static===!0&&(f.s_y<o.s_y?f.s_y+f.s_height>=o.s_y:f.s_y<=o.s_y+o.s_height)),c=r.filter(f=>f.s_y+f.s_height<=o.s_y).map(f=>f.s_y+f.s_height);c.length>0?le=Math.max(...c):le=0;const d=r.filter(f=>f.s_y>=o.s_y+o.s_height).map(f=>f.s_y);d.length>0?we=Math.min(...d):we=0;const k=s.filter(f=>f.s_x+f.s_width<=o.s_x).map(f=>f.s_x+f.s_width);k.length>0?se=Math.max(...k):se=0;const u=s.filter(f=>f.s_x>=o.s_x+o.s_width).map(f=>f.s_x);u.length>0?ke=Math.min(...u):ke=0,window.addEventListener("mousemove",He),window.addEventListener("mouseup",Le)},He=l=>{const o=U+(l.clientX-_e),e=J+(l.clientY-xe),r=U-(l.clientX-_e),s=J-(l.clientY-xe),c=Q+(l.clientY-xe),d=Z+(l.clientX-_e),k=getComputedStyle(T.value),u=parseInt(k.getPropertyValue("--com-item-border-width").trim()),f=parseInt(k.getPropertyValue("--group-tit-height").trim()),i=()=>{if(_.isGroup===!0){const P=_.s_width-2*G.value*E.value-2*u,N=_.s_height-2*L.value*E.value-2*u-(_.groupTit?f:0);_.groupData.forEach(v=>{v.s_width=P*v.groupW,v.s_height=N*v.groupH,v.s_x=P*v.groupX,v.s_y=N*v.groupY})}},x=(D.itemMinWidth+G.value*2)*E.value,p=(D.itemMinHeight+L.value*2)*E.value;switch(Se){case"top-left":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:c,_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,i();break;case"top":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:c,i();break;case"top-right":_.s_height=s<p?p:s>m("top")?m("top"):s,_.s_y=s<p?Q+J-p:s>m("top")?le:c,_.s_width=o<x?x:o>m("right")?m("right"):o,i();break;case"left":_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,i();break;case"right":_.s_width=o<x?x:o>m("right")?m("right"):o,i();break;case"bottom-left":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,_.s_width=r<x?x:r>m("left")?m("left"):r,_.s_x=r<x?Z+U-x:r>m("left")?se:d,i();break;case"bottom":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,i();break;case"bottom-right":_.s_height=e<p?p:e>m("bottom")?m("bottom"):e,_.s_width=o<x?x:o>m("right")?m("right"):o,i();break}mt(_),oe(_);let M=ye(S(n.value.filter(P=>P.drag!==!0)),_,!0);if(M.length>0){M.sort((P,N)=>{const v=P.s_y,K=N.s_y;return v-K});for(let P=0;P<M.length;P++)M.filter(N=>N.id===M[P].id).forEach(N=>{N.s_y+=_.s_y+_.s_height-N.s_y,n.value.filter(v=>v.id===N.id)[0].s_y=N.s_y,q([N],(v,K)=>v.filter(a=>a.drag!==!0&&a.id!==K.id),!0)})}n.value.forEach(P=>{Me(P)}),Y(!1),V("resizeIng",I(_))},Le=l=>{delete _.drag,Se="",oe(null),window.removeEventListener("mousemove",He),window.removeEventListener("mouseup",Le),Y(),V("resizeEnd",I(_)),_=null},m=l=>{switch(l){case"top":return Q+J-le;case"left":return Z+U-se;case"right":return(ke>0?ke:X-G.value*2*E.value)-Z;case"bottom":return we>0?we-Q:999999999}},Y=(l=!0)=>{l===!0&&(q(n.value,(e,r)=>e.filter(s=>s.id!==r.id)),bt(),n.value.forEach(e=>{kt(e)}),St());const o=n.value.map(e=>e.y+e.height);o.length>0?ce.value=Math.max(...o):ce.value=0},bt=()=>{const l=S(n.value).sort((o,e)=>{const r=o.y,s=e.y;return r-s});for(let o=0;o<l.length;o++){const e=F(l,l[o]).filter(r=>r.y+r.height<=l[o].y);e.length>0?l[o].y=Math.max(...e.map(r=>r.y+r.height)):l[o].y=0}l.forEach(o=>{n.value.filter(e=>e.id===o.id)[0].y=o.y})},St=()=>{const l=n.value.filter(o=>o.isGroup===!0);if(l.length>0){const o=getComputedStyle(T.value),e=parseInt(o.getPropertyValue("--setting-icon-group-width").trim()),r=parseInt(o.getPropertyValue("--setting-icon-group-height").trim());l.forEach(s=>{G.value+s.s_x+s.s_width+e>X?G.value+s.s_x-e<0?D.groupBtnPosMore?L.value+s.s_y-r<0?s.btnPosition="bottom":s.btnPosition="top":s.btnPosition="center":s.btnPosition="left":s.btnPosition="right"})}};t.onMounted(()=>{Xe.observe(T.value)});const Xe=new ResizeObserver(l=>{Dt(X===l[0].borderBoxSize[0].inlineSize?null:l[0].borderBoxSize[0].inlineSize,Ge===l[0].borderBoxSize[0].blockSize?null:l[0].borderBoxSize[0].blockSize)});let Be=!1;const Bt=(l=[],o=null)=>{Fe(),n.value=S(l),n.value.filter(e=>e.isGroup===!0).forEach(e=>{if(e.groupData.length<2)ge(e.id);else{const r=Ee(e.groupData,e);me(r)}}),Be=!0,t.nextTick(()=>{const e=T.value.getBoundingClientRect();o!=null?(ie(o),ae(e.width/o)):(ie(n.value.length>0?e.width:null),ae(1)),n.value.forEach(r=>{te(r)}),Y(),setTimeout(()=>{Be=!1},500)})},Ct=l=>{l.showSet=!0},Ce=l=>{const o=n.value.filter(e=>e.id===l);if(o.length===1)delete o[0].showSet;else try{}catch{}},$e=(l,o,e)=>{const r=o.map(d=>d.y),s=Math.max(...r),c=o.filter(d=>d.y+d.height>s);c.sort((d,k)=>{const u=d.x,f=k.x;return u-f});for(let d=0;d<c.length;d++){if(d===0&&c[d].x>=l.width){l.y=s,l.x=0;break}if(c.length>1&&d!==c.length-1&&c[d].x+c[d].width+l.width<=c[d+1].x){l.y=s,l.x=c[d].x+c[d].width;break}if(d===c.length-1&&c[d].x+c[d].width+l.width<=e){l.y=s,l.x=c[d].x+c[d].width;break}}if(l.y==null){l.x=0;const d=o.map(k=>k.y+k.height);l.y=Math.max(...d)}},re=(l,o=null,e=!1)=>{const r=S(l),s=n.value.filter(c=>c.id===o);if(r.id||(r.id=new Date().getTime()+""),o&&s.length!==1)try{}catch{}finally{return}if(e!==!0&&(delete r.x,delete r.y,o?(s[0].groupData.forEach(c=>{R(c,s[0])}),$e(r,s[0].groupData,s[0].width)):n.value.length===0?(r.x=0,r.y=0):$e(r,n.value,(ee||X)-G.value*2)),o){s[0].groupData.push(r);const c=Ee(s[0].groupData,s[0]);me(c),q([c],(d,k)=>d.filter(u=>u.id!==k.id))}else n.value.length===0&&ie(X),te(r),n.value.push(r);Y()},De=(l,o=null,e=null)=>{let r=null;const s=n.value.filter(c=>c.id===o);if(o?s.length===1&&(r=S(s[0].groupData.filter(c=>c.id===l)[0])):r=S(n.value.filter(c=>c.id===l)[0]),r)return r.id=e||new Date().getTime()+"",o?(R(r,s[0]),re(r,o)):re(r),I(o?n.value.filter(c=>c.id===o)[0].groupData.filter(c=>c.id===r.id)[0]:n.value.filter(c=>c.id===r.id)[0]);try{}catch{}finally{return null}},ne=(l,o=null)=>{let e=-1;const r=n.value.filter(s=>s.id===o);if(o?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===l)):e=n.value.findIndex(s=>s.id===l),e!==-1){if(o)if(r[0].groupData.splice(e,1),r[0].groupData.length===1)ge(o);else{r[0].groupData.forEach(c=>{R(c,r[0])});const s=Ee(r[0].groupData,r[0]);me(s)}else n.value.splice(e,1),n.value.length===0&&(ie(null),ae(1));Y()}else try{}catch{}},me=l=>{if(l.id){const o=S(l);delete o.showPop,delete o.showSet,delete o.btnPosition,o.groupData&&o.groupData.forEach(s=>{delete s.showPop,delete s.showSet});let e=-1;const r=n.value.filter(s=>s.id===o.inGroupId);if(o.inGroupId?r.length===1&&(e=r[0].groupData.findIndex(s=>s.id===o.id)):e=n.value.findIndex(s=>s.id===o.id),e!==-1)o.inGroupId?(r[0].groupData[e]=o,te(r[0])):(n.value[e]=o,te(n.value[e])),Y();else try{}catch{}}else try{}catch{}},Dt=(l,o)=>{l!==null&&(X=l,Be||(ae(ee&&X?l/ee:1),n.value.forEach(e=>{te(e)}),Y())),o!==null&&(Ge=o)},We=l=>{l.showPop||(n.value.forEach(o=>{delete o.showPop,o.groupData&&o.groupData.forEach(e=>{delete e.showPop})}),V("openSetMenu",I(l)),l.showPop=!0,window.addEventListener("click",fe))},fe=()=>{n.value.forEach(l=>{delete l.showPop,l.groupData&&l.groupData.forEach(o=>{delete o.showPop})}),window.removeEventListener("click",fe)},O=t.ref(!1),Re=l=>{const o=n.value.findIndex(e=>e.id===l);if(o!==-1)n.value[o].checked=!0,n.value[o].checkDis=!0,O.value=!0,V("showGroup",O.value);else try{}catch{}},Pe=()=>{O.value=!1,n.value.forEach(l=>{delete l.checked,delete l.checkDis,l.groupData&&l.groupData.forEach(o=>{delete o.checked,delete o.checkDis})}),V("showGroup",O.value)},Pt=l=>{l.checked=!l.checked,V("updateChecked",n.value.filter(o=>o.checked).length)},Ee=(l,o)=>{const e=S(l),r=S(o);e.sort((i,x)=>{const p=i.x,M=x.x;return p-M});for(let i=0;i<e.length-1;i++){if(i===0&&e[i].x>0){const x=e[i].x;for(let p=i;p<e.length;p++)e[p].x-=x}if(e[i+1].x>e[i].x+e[i].width){const x=S(e.slice(0,i+1));if(e[i+1].x>Math.max(...x.map(p=>p.x+p.width))){const p=e[i+1].x-Math.max(...x.map(M=>M.x+M.width));for(let M=i+1;M<e.length;M++)e[M].x-=p}}}e.sort((i,x)=>{const p=i.y,M=x.y;return p-M});for(let i=0;i<e.length-1;i++){if(i===0&&e[i].y>0){const x=e[i].y;for(let p=i;p<e.length;p++)e[p].y-=x}if(e[i+1].y>e[i].y+e[i].height){const x=S(e.slice(0,i+1));if(e[i+1].y>Math.max(...x.map(p=>p.y+p.height))){const p=e[i+1].y-Math.max(...x.map(M=>M.y+M.height));for(let M=i+1;M<e.length;M++)e[M].y-=p}}}const s=e.map(i=>i.x+i.width),c=Math.max(...s),d=e.map(i=>i.y+i.height),k=Math.max(...d);e.forEach(i=>{i.inGroupId||(i.inGroupId=r.id),i.groupW=i.width/c,i.groupH=i.height/k,i.groupX=i.x/c,i.groupY=i.y/k,i.isObstacle=i.x+i.width===c&&i.y===0,delete i.width,delete i.height});const u=getComputedStyle(T.value),f=parseInt(u.getPropertyValue("--group-tit-height").trim());return r.width=c,r.height=k+(r.groupTit?f:0),r.groupData=[...e],r},R=(l,o)=>{const e=getComputedStyle(T.value),r=parseInt(e.getPropertyValue("--group-tit-height").trim());l.width=o.width*l.groupW,l.height=(o.height-(o.groupTit?r:0))*l.groupH},vt=()=>{t.nextTick(()=>{Ie()})},zt=()=>{const l=n.value.filter(o=>o.checked);if(l.length>1){const o={id:new Date().getTime()+"G",isGroup:!0,groupTit:""},e=Ee(l,o);return e.groupData.forEach(r=>{ne(r.id)}),re(e),Pe(),I(n.value.filter(r=>r.id===e.id)[0])}else return Pe(),null},Ke=(l,o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){const r=e.groupData.filter(s=>s.id===l)[0];if(r)return e.groupData.length===2?ge(o):(R(r,e),delete r.inGroupId,delete r.groupW,delete r.groupH,delete r.groupX,delete r.groupY,delete r.isObstacle,ne(r.id,e.id),re(r),[I(n.value.filter(s=>s.id===l)[0])]);try{}catch{}finally{return[]}}else try{}catch{}finally{return[]}},ge=l=>{const o=n.value.filter(e=>e.id===l)[0];if(o){let e=[];o.groupData.forEach(s=>{R(s,o),s.x+=o.x,s.y+=o.y,delete s.inGroupId,delete s.groupW,delete s.groupH,delete s.groupX,delete s.groupY,delete s.isObstacle,e.push(s.id),re(s,null,!0)}),ne(o.id);let r=[];return e.forEach(s=>{r.push(I(n.value.filter(c=>c.id===s)[0]))}),r}else try{}catch{}finally{return[]}},Vt=(l="",o)=>{const e=n.value.filter(r=>r.id===o)[0];if(e){if(!e.groupTit||!l){const r=getComputedStyle(T.value),s=parseInt(r.getPropertyValue("--group-tit-height").trim());e.groupTit&&!l&&(e.height-=s,e.s_height-=s*E.value),!e.groupTit&&l&&(e.height+=s,e.s_height+=s*E.value)}e.groupTit=l,q([e],(r,s)=>r.filter(c=>c.id!==s.id)),Y()}else try{}catch{}},Fe=()=>{n.value=[],ie(null),ae(1),ce.value=0},It=()=>new Promise((l,o)=>{n.value.forEach(r=>{delete r.showPop,delete r.showSet,r.groupData&&r.groupData.forEach(s=>{delete s.showPop,delete s.showSet})});const e=S(n.value);e.forEach(r=>{r.isGroup===!0&&r.groupData.forEach(s=>{R(s,r),delete s.s_width,delete s.s_height,delete s.s_x,delete s.s_y}),delete r.btnPosition,delete r.s_width,delete r.s_height,delete r.s_x,delete r.s_y}),l({data:e,width:ee})});return t.onBeforeUnmount(()=>{Xe.unobserve(T.value),window.removeEventListener("click",fe)}),A({init:Bt,addItem:re,copyItem:De,deleteItem:ne,updateItem:me,hideGroupSet:Ce,openGroup:Re,closeGroup:Pe,changeGroupBorder:vt,addGroup:zt,removeGroupItem:Ke,removeGroup:ge,changeGroupTit:Vt,resetData:Fe,getData:It}),(l,o)=>(t.openBlock(),t.createElementBlock("div",{class:"vue-drag-component-plus",style:t.normalizeStyle({"--css-scle":t.unref(E),"--com-x-space":t.unref(G)+"px","--com-y-space":t.unref(L)+"px"}),ref_key:"pageRef",ref:T},[t.createElementVNode("div",qe,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item",e.move?"is-move":"",e.drag?"is-drag":"",e.showPop?"on-top":""]),style:t.normalizeStyle({width:e.s_width+"px",height:e.s_height+"px",top:e.s_y+"px",left:e.s_x+"px"}),key:r},[t.createElementVNode("div",{class:t.normalizeClass(["com-item-inner",y.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?"":"can-drag",y.seeModel?"no-hover":""]),onMousedown:t.withModifiers(s=>y.seeModel||t.unref(O)||e.static===!0||e.dragable===!1?null:Mt(s,r),["prevent"]),onMouseenter:s=>y.seeModel||t.unref(O)||t.unref(b)||t.unref(_)||!e.isGroup?null:Ct(e),onMouseleave:s=>y.seeModel||t.unref(O)||t.unref(b)||t.unref(_)||!e.isGroup?null:Ce(e.id)},[t.createElementVNode("div",Je,[e.isGroup?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[e.groupTit?(t.openBlock(),t.createElementBlock("div",{key:0,class:"group-item-tit",title:e.groupTit},t.toDisplayString(e.groupTit),9,Qe)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["group-item-content",e.groupTit?"":"full"])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupData,(s,c)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["com-item-box-child",s.isObstacle?"is-obstacle":""]),style:t.normalizeStyle({width:s.s_width+"px",height:s.s_height+"px",top:s.s_y+"px",left:s.s_x+"px"}),key:c},[t.createElementVNode("div",Ze,[t.renderSlot(l.$slots,"item",{data:s},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_width*100)/100)+","+t.toDisplayString(Math.round(s.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(s.s_x*100)/100)+","+t.toDisplayString(Math.round(s.s_y*100)/100),1)])]),!y.seeModel&&!t.unref(O)&&t.unref(b)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box",style:t.normalizeStyle({display:s.showPop?"flex":"none"}),onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:y.settingIcon,onClick:t.withModifiers(d=>We(s),["prevent","stop"])},null,8,["iconObj","onClick"])],36)):t.createCommentVNode("",!0),s.showPop?(t.openBlock(),t.createElementBlock("div",{key:1,class:"setting-box-pop",onMousedown:t.withModifiers(d=>null,["prevent","stop"])},[t.renderSlot(l.$slots,"setPopNormal",{data:I(s)},()=>[t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>Ke(s.id,s.inGroupId)},"移出组合",8,je),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>De(s.id,s.inGroupId)},"复制",8,et),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:d=>ne(s.id,s.inGroupId)},"删除",8,tt)])],32)):t.createCommentVNode("",!0)],6))),128))],2)],64)):(t.openBlock(),t.createElementBlock("div",ot,[t.renderSlot(l.$slots,"item",{data:e},()=>[t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_width*100)/100)+","+t.toDisplayString(Math.round(e.s_height*100)/100),1),t.createElementVNode("p",null,t.toDisplayString(Math.round(e.s_x*100)/100)+","+t.toDisplayString(Math.round(e.s_y*100)/100),1)])])),!e.isGroup&&e.notGroup!==!0&&t.unref(O)?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["group-checkbox",e.checked?"is-checked":"",e.checkDis?"disabled":""]),onClick:s=>e.checkDis?null:Pt(e)},null,10,lt)):t.createCommentVNode("",!0),!y.seeModel&&!t.unref(O)&&t.unref(b)===null&&t.unref(_)===null?(t.openBlock(),t.createElementBlock("div",{key:3,class:t.normalizeClass(["setting-box",e.isGroup===!0?e.btnPosition==="right"?"only-g":e.btnPosition==="left"?"only-g l":e.btnPosition==="top"?"only-g t":e.btnPosition==="bottom"?"only-g b":e.btnPosition==="center"?"only-g c":"":""]),style:t.normalizeStyle({display:e.showPop||e.showSet?"flex":"none"}),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[t.createVNode(j,{iconObj:y.settingIcon,onClick:t.withModifiers(s=>We(e),["prevent","stop"])},null,8,["iconObj","onClick"])],38)):t.createCommentVNode("",!0),e.showPop?(t.openBlock(),t.createElementBlock("div",{key:4,class:t.normalizeClass(["setting-box-pop",e.isGroup===!0?e.btnPosition==="right"?"special":e.btnPosition==="left"?"special l":e.btnPosition==="top"?"special t":e.btnPosition==="bottom"?"special b":e.btnPosition==="center"?"special c":"":""]),onMousedown:t.withModifiers(s=>null,["prevent","stop"])},[e.isGroup===!0?t.renderSlot(l.$slots,"setPopSpecial",{key:0,data:I(e)},()=>[y.hideTit?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>{Ce(e.id),V("showTitPop",e.groupTit,e.id)}}," 设置组合标题",8,st)),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>ge(e.id)},"解除组合",8,rt)]):t.renderSlot(l.$slots,"setPopNormal",{key:1,data:I(e)},()=>[e.notGroup!==!0?(t.openBlock(),t.createElementBlock("div",{key:0,class:"setting-box-pop-item",onClick:s=>Re(e.id)},"组合",8,nt)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>De(e.id)},"复制",8,it),t.createElementVNode("div",{class:"setting-box-pop-item",onClick:s=>ne(e.id)},"删除",8,at)])],34)):t.createCommentVNode("",!0)]),!y.seeModel&&!t.unref(O)&&!e.showPop&&!e.move&&e.static!==!0&&e.resizable!==!1?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.unref(H).indexOf("topLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:0,class:"resize-line top-left",onMousedown:t.withModifiers(s=>W(s,e,"top-left"),["prevent","stop"])},null,40,ct)):t.createCommentVNode("",!0),t.unref(H).indexOf("top")!==-1?(t.openBlock(),t.createElementBlock("div",{key:1,class:"resize-line top",onMousedown:t.withModifiers(s=>W(s,e,"top"),["prevent","stop"])},null,40,dt)):t.createCommentVNode("",!0),t.unref(H).indexOf("topRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:2,class:"resize-line top-right",onMousedown:t.withModifiers(s=>W(s,e,"top-right"),["prevent","stop"])},null,40,ht)):t.createCommentVNode("",!0),t.unref(H).indexOf("left")!==-1?(t.openBlock(),t.createElementBlock("div",{key:3,class:"resize-line left",onMousedown:t.withModifiers(s=>W(s,e,"left"),["prevent","stop"])},null,40,ut)):t.createCommentVNode("",!0),t.unref(H).indexOf("right")!==-1?(t.openBlock(),t.createElementBlock("div",{key:4,class:"resize-line right",onMousedown:t.withModifiers(s=>W(s,e,"right"),["prevent","stop"])},null,40,pt)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottomLeft")!==-1?(t.openBlock(),t.createElementBlock("div",{key:5,class:"resize-line bottom-left",onMousedown:t.withModifiers(s=>W(s,e,"bottom-left"),["prevent","stop"])},null,40,ft)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottom")!==-1?(t.openBlock(),t.createElementBlock("div",{key:6,class:"resize-line bottom",onMousedown:t.withModifiers(s=>W(s,e,"bottom"),["prevent","stop"])},null,40,gt)):t.createCommentVNode("",!0),t.unref(H).indexOf("bottomRight")!==-1?(t.openBlock(),t.createElementBlock("div",{key:7,class:"resize-line bottom-right",onMousedown:t.withModifiers(s=>W(s,e,"bottom-right"),["prevent","stop"])},null,40,yt)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0)],42,Ue)],6))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["shadow-bg",e.move?"is-move":""]),style:t.normalizeStyle({width:e.s_width-t.unref(G)*2*t.unref(E)+"px",height:e.s_height-t.unref(L)*2*t.unref(E)+"px",top:e.s_y+t.unref(L)*t.unref(E)+"px",left:e.s_x+t.unref(G)*t.unref(E)+"px"}),key:r},null,6))),128)),t.unref(b)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"drag-bg",style:t.normalizeStyle({width:t.unref(B).s_width+"px",height:t.unref(B).s_height+"px",top:t.unref(B).s_y+"px",left:t.unref(B).s_x+"px"})},null,4)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"height-bg",style:t.normalizeStyle({height:(t.unref(ce)>0?+(t.unref(ce)*t.unref(E)+(y.seeModel?y.seeModelMinBg:220)):0)+"px"})},null,4),y.showAuxiliary?(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.unref(de)!==null?(t.openBlock(),t.createElementBlock("div",{key:0,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(de)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(he)!==null?(t.openBlock(),t.createElementBlock("div",{key:1,class:"auxiliary-line hor",style:t.normalizeStyle({top:t.unref(he)+"px",left:"0px"})},null,4)):t.createCommentVNode("",!0),t.unref(ue)!==null?(t.openBlock(),t.createElementBlock("div",{key:2,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(ue)+"px"})},null,4)):t.createCommentVNode("",!0),t.unref(pe)!==null?(t.openBlock(),t.createElementBlock("div",{key:3,class:"auxiliary-line",style:t.normalizeStyle({top:"0px",left:t.unref(pe)+"px"})},null,4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0),t.unref(n).length===0?(t.openBlock(),t.createElementBlock("div",_t,[t.renderSlot(l.$slots,"empty",{},()=>[o[0]||(o[0]=t.createTextVNode(" 暂无数据 "))])])):t.createCommentVNode("",!0)])],4))}}],ve={install(y){xt.forEach(A=>{y.component("vueDragComponentPlus",A)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(ve),ve});
